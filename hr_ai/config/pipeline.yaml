version: "2.0-industrial"
description: "Промышленный HR-AI пайплайн с полной маршрутизацией агентов, логированием и трассировкой"

globals:
  logging_level: INFO
  retry_policy:
    max_attempts: 3
    backoff: exponential
  timeout_per_stage: 120s
  encryption: AES-256
  observability:
    trace: true
    metrics: true
    audit_logs: true
  context_injection: true
  fail_fast: false

stages:
  - id: parse_cv
    name: "Извлечение резюме"
    module: intake.cv_parser
    input: raw_cv_data
    output: structured_cv
    agents: [cv_parser_ai]
    failover: fallback_cv_parser

  - id: semantic_match
    name: "Семантическое сопоставление"
    module: intake.semantic_matcher
    input: structured_cv
    output: matched_profiles
    agents: [semantic_matcher_ai, ethics_filter_ai]
    validation: true

  - id: skills_match
    name: "Сопоставление по навыкам"
    module: intake.skill_matcher
    input: matched_profiles
    output: skill_aligned_profiles
    agents: [skill_match_ai]
    augment: true

  - id: performance_prediction
    name: "Прогноз продуктивности"
    module: prediction.performance_model
    input: skill_aligned_profiles
    output: predictions
    agents: [performance_ai]
    monitoring: true

  - id: feature_engineering
    name: "Формирование признаков"
    module: prediction.feature_engineering
    input: predictions
    output: enriched_features
    agents: [feature_engineer_ai]
    optimize_for: explainability

  - id: explain_decision
    name: "Объяснение выбора"
    module: governance.decision_explainer
    input: enriched_features
    output: decision_package
    agents: [xai_agent]
    compliance: ISO-27001

  - id: ethics_check
    name: "Этическая проверка"
    module: comms.ethics_filter
    input: decision_package
    output: ethics_passed
    agents: [ethics_ai]
    constraints:
      - fairness
      - privacy
      - neutrality

  - id: team_fit_analysis
    name: "Совместимость с командой"
    module: governance.team_fit_analyzer
    input: ethics_passed
    output: team_fitted_profiles
    agents: [team_ai]

  - id: anomaly_scan
    name: "Проверка на аномалии"
    module: audit.anomaly_guard
    input: team_fitted_profiles
    output: verified_profiles
    agents: [security_ai]

  - id: final_output
    name: "Финальный результат"
    module: dashboard.dashboard
    input: verified_profiles
    output: selection_output
    publish: true
    channels:
      - web_dashboard
      - audit.logs.db
    traceability: full

alerts:
  on_failure:
    - notify: devops@hrai.local
    - retry_stage: previous
    - fallback: "manual_review"

scheduling:
  trigger: event_driven
  cron_fallback: "0 * * * *"
  throttle: 100 candidates/hour

security:
  access_control: strict
  audit_trail: enabled
  rbac_roles:
    - admin
    - reviewer
    - auditor
