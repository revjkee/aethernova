<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ ‚Äî TeslaAI Vault</title>
  <link rel="stylesheet" href="/static/css/main.css" />
</head>
<body>
  <main class="error-container">
    <div class="error-box">
      <h1 id="error-code">–û—à–∏–±–∫–∞</h1>
      <p id="error-message">–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫.</p>

      <div class="actions">
        <a href="/index.html" class="btn">üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
        <a href="javascript:void(0)" onclick="reportIssue()" class="btn-outline">üì° –°–æ–æ–±—â–∏—Ç—å –æ–± –æ—à–∏–±–∫–µ</a>
      </div>

      <small class="trace-info" id="trace-id">ID: –ó–∞–≥—Ä—É–∑–∫–∞...</small>
    </div>
  </main>

  <script src="/static/js/utils.js"></script>
  <script src="/static/js/auth.js"></script>
  <script>
    const params = new URLSearchParams(window.location.search);
    const code = params.get("code") || "500";
    const messages = {
      "403": "–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω. –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã.",
      "404": "–°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –í–æ–∑–º–æ–∂–Ω–æ, —Å—Å—ã–ª–∫–∞ —É—Å—Ç–∞—Ä–µ–ª–∞ –∏–ª–∏ –±—ã–ª–∞ —É–¥–∞–ª–µ–Ω–∞.",
      "500": "–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞. –ú—ã —É–∂–µ —Ä–∞—Å—Å–ª–µ–¥—É–µ–º.",
      "503": "–°–µ—Ä–≤–∏—Å –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.",
      "default": "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.",
    };

    document.getElementById("error-code").textContent = `–û—à–∏–±–∫–∞ ${code}`;
    document.getElementById("error-message").textContent = messages[code] || messages["default"];
    const traceId = generateTraceId();
    document.getElementById("trace-id").textContent = `ID –æ—à–∏–±–∫–∏: ${traceId}`;
    logErrorEvent(traceId, code);

    function reportIssue() {
      alert(`–°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ\nID: ${traceId}`);
    }

    function generateTraceId() {
      return 'ERR-' + Date.now().toString(36) + '-' + Math.random().toString(36).substring(2, 8).toUpperCase();
    }

    function logErrorEvent(traceId, code) {
      try {
        fetch("/api/audit/error", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            ...attachAuthHeader().headers
          },
          body: JSON.stringify({
            trace_id: traceId,
            error_code: code,
            timestamp: new Date().toISOString(),
            path: window.location.pathname
          })
        });
      } catch (e) {
        console.warn("–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫—É –≤ –ª–æ–≥");
      }
    }
  </script>
</body>
</html>
