Руководство для разработчиков (dev_guide.md)
Введение
Этот документ описывает основные принципы разработки, структуру проекта и рекомендации по работе с кодовой базой Telegram Mini App для записи клиентов.

Структура проекта
bash
Копировать
Редактировать
backend/
├── api/
│   └── v1/                  # REST API версии 1
├── models/                  # ORM модели (Tortoise ORM)
├── services/                # Сервисы с бизнес-логикой
├── database/                # Миграции Alembic
├── deps.py                  # Зависимости для FastAPI
bot/
├── handlers/                # Обработчики сообщений и команд бота
├── middlewares/             # Middleware (например, throttling)
├── keyboards/               # Inline и reply клавиатуры
├── router.py                # Основной роутер бота
core/
├── settings.py              # Конфигурация проекта (через pydantic)
├── db.py                    # Инициализация базы данных
├── message_queue.py         # Работа с очередью сообщений (Redis)
entrypoints/
├── run_api.py               # Запуск FastAPI API
├── run_bot.py               # Запуск Telegram бота
├── run_worker.py            # Запуск фонового воркера
utils/
├── scheduler.py             # Планировщик задач
Общие требования к коду
Использовать Python 3.13+

Соблюдать PEP8 и писать чистый, читаемый код.

Асинхронность — использовать async/await для всех операций ввода-вывода.

Использовать типизацию для всех функций и методов.

Все файлы должны содержать комментарии и краткие пояснения функций.

Проверять код минимум 5 раз перед отправкой.

Настройка окружения
Создать виртуальное окружение:

bash
Копировать
Редактировать
python -m venv venv
source venv/bin/activate
Установить зависимости:

bash
Копировать
Редактировать
pip install -r requirements.txt
Создать .env файл с необходимыми переменными (пример в .env.example):

TELEGRAM_TOKEN

DATABASE_URL

REDIS_URL

API_HOST, API_PORT

Работа с базой данных
Используем PostgreSQL с асинхронным доступом через Tortoise ORM.

Миграции осуществляются через Alembic.

Для инициализации БД и миграций использовать команды:

bash
Копировать
Редактировать
aerich init -t backend.config.TORTOISE_ORM
aerich migrate
aerich upgrade
Все операции с БД должны проходить через сервисы (services/).

Запуск и разработка
Для запуска API сервера:

bash
Копировать
Редактировать
python entrypoints/run_api.py
Для запуска Telegram бота:

bash
Копировать
Редактировать
python entrypoints/run_bot.py
Для запуска фонового воркера (например, уведомления):

bash
Копировать
Редактировать
python entrypoints/run_worker.py
Логирование и мониторинг
Используется стандартный модуль logging с уровнем INFO.

Все ключевые действия логируются.

При расширении функционала следует добавлять логирование ошибок и важных событий.

Работа с Telegram ботом
Используем aiogram 3.x.

Хранение состояний в Redis.

Ограничение частоты команд реализуется через middleware throttling.

Обработчики структурированы по функционалу в bot/handlers.

Качество и тестирование
Писать юнит и интеграционные тесты для ключевых модулей.

Использовать pytest для тестирования.

Проверять асинхронный код с помощью pytest-asyncio.

В тестах использовать мок объекты для внешних сервисов.

Рекомендации по развитию
Разделять бизнес-логику и взаимодействие с API/ботом.

Добавлять новые сервисы в папку services/.

Для новых эндпоинтов создавать отдельные роутеры.

Следить за производительностью — использовать профилирование.

Полезные команды
Миграции:

bash
Копировать
Редактировать
alembic revision --autogenerate -m "описание"
alembic upgrade head
Проверка стиля:

bash
Копировать
Редактировать
flake8 backend/ bot/ core/
Запуск тестов:

bash
Копировать
Редактировать
pytest tests/
Контакты и помощь
Для вопросов по архитектуре и коду обращаться к Владиславу (Влад).

В репозитории использовать issues и pull requests для контроля изменений.

Документ служит для быстрого старта и поддержания высокого качества разработки.