# message-brokers/config/broker_settings.yaml

version: "1.0"
environment: "production"

global:
  retry_policy: "alerting_pipeline"
  timeout_sec: 15
  max_retries: 5
  ack_strategy: "quorum"
  compression: "lz4"
  metrics_enabled: true
  observability_tags:
    - "broker"
    - "secure"
    - "ai-trace"

security:
  allowed_roles:
    - "admin"
    - "ai-core"
    - "secure-agent"
  trusted_sources:
    - "genesis-gateway"
    - "ai-platform-core"
    - "observability-engine"
  encryption:
    hmac_enabled: true
    gpg_required: true
  rate_limit:
    per_second: 500
    per_source: 100
  zero_trust_enforcement: true
  ttl_policy_sec: 120
  max_payload_kb: 512

kafka:
  bootstrap_servers:
    - "kafka1.internal.genesis:9092"
    - "kafka2.internal.genesis:9092"
  client_id: "genesis-mesh"
  topic_defaults:
    replication_factor: 3
    partitions: 12
    cleanup_policy: "delete"
    retention_ms: 604800000 # 7 days
  topics:
    telemetry.core:
      partitions: 6
      retention_ms: 86400000
      priority: "low"
      encrypted: true
    alerts.critical:
      partitions: 3
      retention_ms: 259200000
      priority: "high"
      encrypted: true
    audit.trail:
      partitions: 4
      retention_ms: 1209600000
      priority: "critical"
      encrypted: true
    ai.commands:
      partitions: 2
      retention_ms: 3600000
      priority: "medium"
      encrypted: false

redis:
  host: "redis-broker.genesis"
  port: 6379
  db: 0
  channel_prefix: "genesis:"
  ttl_sec: 900
  enable_ack: false
  secure_channel_only: true
  allowed_channels:
    - "genesis:alerts"
    - "genesis:queue:ai"
    - "genesis:metrics:stream"

rabbitmq:
  host: "mq-broker.genesis"
  port: 5672
  user: "secure"
  password: "${RABBIT_PASS}"
  virtual_host: "/core"
  queues:
    autopwn.exploits:
      durable: true
      priority: "critical"
      retry_policy: "rabbitmq_channel"
    core.telemetry:
      durable: false
      priority: "low"
    ai.control:
      durable: true
      priority: "high"
      timeout_sec: 8

fallback:
  failover_mode: "degraded"
  notify_on_failover: true
  fallback_broker: "redis"
  trigger_conditions:
    - type: "kafka_down"
    - type: "high_latency"
    - type: "signature_mismatch"
