# ============================================
# backend/requirements.txt
# Асинхронный FastAPI-бэкенд (промышленный профиль)
# Совместимые мажорно-минорные диапазоны для стабильных билдов.
# ============================================

########## Core Web ##########
fastapi~=0.111
uvicorn[standard]~=0.30
gunicorn~=22.0
httpx~=0.27
orjson~=3.10
ujson~=5.10
uvloop~=0.20 ; sys_platform != "win32"

########## Config & Validation ##########
pydantic~=2.7
pydantic-settings~=2.3
pydantic-extra-types~=2.10
email-validator~=2.2
python-multipart~=0.0.9

########## Database & Migrations (Async) ##########
SQLAlchemy[asyncio]~=2.0
asyncpg~=0.29
alembic~=1.13

########## Caching, Queues, Messaging ##########
redis~=5.0
fastapi-cache2~=0.2
aio-pika~=9.4
aiormq~=6.8

########## Security & Auth ##########
python-jose[cryptography]~=3.3
passlib[bcrypt]~=1.7
bcrypt~=4.2
cryptography~=43.0

########## Observability (Metrics, Tracing, Logs) ##########
prometheus-fastapi-instrumentator~=6.1
opentelemetry-api~=1.25
opentelemetry-sdk~=1.25
opentelemetry-instrumentation~=0.46b0
opentelemetry-instrumentation-fastapi~=0.46b0
opentelemetry-exporter-otlp~=1.25
structlog~=24.4
tenacity~=8.5

########## Rate Limiting ##########
fastapi-limiter~=0.1

########## Optional: File Storage / S3-compatible ##########
boto3~=1.34

########## Optional: Compression ##########
brotli~=1.1

# ============================================
# TEST/DEV зависимость via environment markers:
# Устанавливается автоматически только в dev/test окружениях,
# если переменная окружения не используется — можно управлять
# установкой через отдельный requirements-dev.txt при желании.
# Здесь оставлено для удобства из коробки.
# ============================================

# Тестирование
pytest~=8.3 ; extra == "dev"
pytest-asyncio~=0.23 ; extra == "dev"
pytest-cov~=5.0 ; extra == "dev"
respx~=0.21 ; extra == "dev"

# Статический анализ / стиль
ruff~=0.6 ; extra == "dev"
mypy~=1.11 ; extra == "dev"
types-requests~=2.32 ; extra == "dev"
