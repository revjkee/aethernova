$schema: "https://json-schema.org/draft/2020-12/schema"
$title: "Calibration Rule Schema"
$description: "Strict schema definition for calibration rules in TeslaAI Genesis"
type: object
required:
  - id
  - name
  - version
  - parameters
properties:
  id:
    type: string
    description: "Уникальный идентификатор правила"
    pattern: "^[a-zA-Z0-9\\-_]{3,64}$"

  name:
    type: string
    description: "Человеко-читаемое имя правила"
    minLength: 3
    maxLength: 128

  description:
    type: string
    description: "Описание назначения правила"
    maxLength: 512

  version:
    type: string
    description: "Семантическая версия правила"
    pattern: "^\\d+\\.\\d+\\.\\d+$"

  metadata:
    type: object
    description: "Дополнительные метаданные, включая RBAC-метки"
    properties:
      created_by:
        type: string
      tags:
        type: array
        items:
          type: string
      rbac_roles:
        type: array
        items:
          type: string
      scope:
        type: string
        enum: [global, local, private, experimental]

  parameters:
    type: array
    minItems: 1
    items:
      type: object
      required: [name, type, value]
      properties:
        name:
          type: string
          pattern: "^[a-zA-Z_][a-zA-Z0-9_]{2,32}$"
        type:
          type: string
          enum: [int, float, str, bool, list, dict]
        value:
          description: "Конкретное значение параметра (тип зависит от 'type')"
        min:
          type: number
        max:
          type: number
        choices:
          type: array
          items:
            type: [string, number, boolean]
        description:
          type: string
          maxLength: 256
        deprecated:
          type: boolean
        required:
          type: boolean
        readOnly:
          type: boolean
        depends_on:
          type: array
          items:
            type: string
        constraints:
          type: object
          additionalProperties: true
