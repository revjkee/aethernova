# airdrop_manager/foundry.toml

[profile.default]
# Стандартная структура проекта
src         = "src"
out         = "out"
libs        = ["lib", "libs"]
test        = "test"
cache_path  = "cache"

# Детеминизм и согласованность компиляции
# (закрепляем версию solc и целевую EVM)
solc        = "0.8.26"
evm_version = "cancun"

# Качество байткода и верифицируемость
optimizer        = true
optimizer_runs   = 10000
via_ir           = true
# Метадата в байткоде: IPFS-хеш (совместимо с верификацией)
bytecode_hash    = "ipfs"

# Для инструментария (аналитика хранилища, апгрейды и т. п.)
# Включаем выдачу layout'а хранилища и build-info/AST
build_info       = true
ast              = true
extra_output     = ["storageLayout"]

# Ремаппинги обнаружаются автоматически из ./lib
auto_detect_remappings = true

# Безопасность: FFI по умолчанию отключён
ffi = false

# Отчёты по газу
gas_reports = ["*"]

# Разрешения на доступ к файловой системе для скриптов/тестов
# По умолчанию Foundry блокирует FS-доступ, поэтому явно указываем нужные пути
fs_permissions = [
  { access = "read",        path = "./out" },
  { access = "read",        path = "./broadcast" },
  { access = "read",        path = "./reports" },
  { access = "read-write",  path = "./tmp" }
]

# RPC-эндпоинты через переменные окружения
[rpc_endpoints]
mainnet   = "${RPC_MAINNET}"
sepolia   = "${RPC_SEPOLIA}"
base      = "${RPC_BASE}"
arbitrum  = "${RPC_ARBITRUM}"
optimism  = "${RPC_OPTIMISM}"
polygon   = "${RPC_POLYGON}"

# Etherscan API v2 (единый ключ для семейства сканеров)
etherscan_api_key = "${ETHERSCAN_API_KEY}"
[etherscan]
mainnet = { key = "${ETHERSCAN_API_KEY}" }
sepolia = { key = "${ETHERSCAN_API_KEY}" }

# Глобальные настройки для fuzz/invariant-тестов
[fuzz]
runs = 1024
seed = 1

[invariant]
runs             = 256
depth            = 32
fail_on_revert   = true
shrink_sequence  = true

# Форматтер кода
[fmt]
quote_style       = "double"
number_underscore = "thousands"

# Профиль для CI: более строгие параметры и развёрнутая трассировка
[profile.ci]
verbosity       = 4
optimizer       = true
optimizer_runs  = 20000
via_ir          = true
bytecode_hash   = "ipfs"
ffi             = false

[profile.ci.fuzz]
runs = 4096

[profile.ci.invariant]
runs  = 512
depth = 64
fail_on_revert = true
