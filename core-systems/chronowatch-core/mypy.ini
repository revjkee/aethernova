# chronowatch-core/mypy.ini
# Industrial-strength MyPy configuration for NeuroCity / TeslaAI Genesis
# Covers: strict type checking, async support, plugin extensibility,
# CI/CD compatibility, and incremental build optimization.

[mypy]
# === CORE CHECKS ===
python_version = 3.11
platform = linux
warn_return_any = True
warn_unused_configs = True
disallow_untyped_calls = True
disallow_untyped_defs = True
disallow_incomplete_defs = True
check_untyped_defs = True
disallow_untyped_decorators = True
disallow_any_unimported = True
disallow_any_expr = True
disallow_any_decorated = True
disallow_any_explicit = True
disallow_any_generics = True
warn_unused_ignores = True
warn_no_return = True
warn_unreachable = True
warn_redundant_casts = True
warn_incomplete_stub = True
show_error_context = True
show_column_numbers = True
pretty = True
color_output = True
error_summary = True
strict_optional = True
implicit_reexport = False

# === PERFORMANCE ===
incremental = True
cache_dir = .mypy_cache
sqlite_cache = True
plugins = 
    pydantic.mypy
    sqlalchemy.ext.mypy.plugin

# === STRICTNESS ===
strict_equality = True
local_partial_types = True
no_implicit_optional = True
allow_redefinition = False
strict_concatenate = True

# === REPORTING ===
html_report = reports/mypy_html
txt_report = reports/mypy_txt
linecount_report = reports/mypy_linecount
xml_report = reports/mypy_xml

# === CI/CD OPTIMIZATION ===
# Fails build on any typing error
error_code = True
show_error_codes = True
pretty = True

# === MODULE-SPECIFIC RULES ===

# Allow untyped tests but still track
[mypy-tests.*]
disallow_untyped_defs = False
check_untyped_defs = True
ignore_missing_imports = True

# Database migration scripts (Alembic often untyped)
[mypy-migrations.*]
ignore_missing_imports = True
disallow_untyped_defs = False

# Third-party libraries without stubs
[mypy-*.stubs]
ignore_missing_imports = True

# Experimental modules can relax some rules
[mypy-experimental.*]
warn_return_any = False
disallow_untyped_defs = False

# === ASYNCIO & CONCURRENCY ===
[mypy-asyncio.*]
disallow_untyped_defs = True
warn_unreachable = True

[mypy-concurrent.*]
disallow_untyped_defs = True

# === SECURITY-CORE ===
# Forces strict typing for security-critical modules
[mypy-platform_security_core.*]
disallow_untyped_defs = True
disallow_incomplete_defs = True
warn_return_any = True

# === GENIUS-CORE ===
# Extra strictness to prevent logic conflicts
[mypy-genius_core.*]
disallow_untyped_defs = True
disallow_incomplete_defs = True
check_untyped_defs = True
warn_unreachable = True

# === LOGGING ===
[mypy-logging.*]
disallow_untyped_defs = True
warn_unreachable = True
