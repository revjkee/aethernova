# =============================================================================
# physical-integration-core — .env.example
# ВНИМАНИЕ: это пример. Замените значения, отмеченные changeme, перед запуском.
# Формат: KEY=VALUE, без кавычек. Строки с пробелами экранируйте или заключайте в кавычки.
# =============================================================================

# -----------------------------------------------------------------------------
# Приложение и среда
# -----------------------------------------------------------------------------
APP_NAME=physical-integration-core
APP_ENV=production               # production, staging, development, test
APP_VERSION=1.0.0
TZ=UTC
LANG=C.UTF-8
# Жесткое завершение через SIGTERM и ожидание graceful shutdown
GRACEFUL_TIMEOUT_SECONDS=30
SHUTDOWN_WAIT_SECONDS=5

# -----------------------------------------------------------------------------
# Сетевые интерфейсы API
# -----------------------------------------------------------------------------
HTTP_HOST=0.0.0.0
HTTP_PORT=8080
HTTP_ROOT_PATH=/                 # для reverse proxy подпрефикса
HTTP_WORKERS=4                   # gunicorn/uvicorn workers
HTTP_KEEPALIVE=75
HTTP_REQUEST_TIMEOUT=120
HTTP_PROXY_HEADERS=true          # доверять X-Forwarded-*
CORS_ENABLED=true
CORS_ALLOW_ORIGINS=https://example.com,https://admin.example.com
CORS_ALLOW_CREDENTIALS=true
ALLOWED_HOSTS=example.com,api.example.com
CSRF_TRUSTED_ORIGINS=https://example.com
# TLS на уровне приложения, если нет терминации на балансировщике
TLS_ENABLED=false
TLS_CERT_FILE=/etc/tls/tls.crt
TLS_KEY_FILE=/etc/tls/tls.key

# gRPC сервер (если используется)
GRPC_ENABLED=false
GRPC_HOST=0.0.0.0
GRPC_PORT=9090
GRPC_MAX_MESSAGE_MB=16

# -----------------------------------------------------------------------------
# База данных PostgreSQL или TimescaleDB
# -----------------------------------------------------------------------------
PGHOST=localhost
PGPORT=5432
PGDATABASE=physical_core
PGUSER=physical_core
PGPASSWORD=changeme
# Альтернативно единая строка подключения
DATABASE_URL=postgresql+psycopg://physical_core:changeme@localhost:5432/physical_core
DB_POOL_SIZE=10
DB_MAX_OVERFLOW=5
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE_SECONDS=1800
DB_STATEMENT_TIMEOUT_MS=60000
DB_SSL_MODE=prefer               # disable, require, verify-ca, verify-full
DB_MIGRATIONS_AUTO_APPLY=false   # true для автопрогона миграций при старте

# -----------------------------------------------------------------------------
# Кэш и брокеры
# -----------------------------------------------------------------------------
# Redis для кэша, rate limit, очередей задач
REDIS_URL=redis://localhost:6379/0
REDIS_PASSWORD=
REDIS_TLS=false

# Kafka как основной брокер телеметрии и событий
KAFKA_ENABLED=true
KAFKA_BOOTSTRAP_SERVERS=localhost:9092
KAFKA_CLIENT_ID=physical-core
KAFKA_SECURITY_PROTOCOL=PLAINTEXT  # SASL_PLAINTEXT, SASL_SSL
KAFKA_SASL_MECHANISM=
KAFKA_SASL_USERNAME=
KAFKA_SASL_PASSWORD=
KAFKA_SSL_CA_LOCATION=
KAFKA_ACKS=all
KAFKA_COMPRESSION_TYPE=snappy

# RabbitMQ как альтернативный брокер
RABBITMQ_ENABLED=false
RABBITMQ_URL=amqp://guest:guest@localhost:5672/%2F
RABBITMQ_PREFETCH=32

# Очередь задач
TASK_QUEUE=redis                  # redis, rabbitmq, kafka
TASK_CONCURRENCY=4
TASK_SOFT_TIME_LIMIT=90
TASK_HARD_TIME_LIMIT=120
TASK_SCHEDULE_ENABLED=true

# -----------------------------------------------------------------------------
# Хранилище объектов S3 совместимое
# -----------------------------------------------------------------------------
S3_ENABLED=true
S3_ENDPOINT=https://s3.example.com
S3_REGION=us-east-1
S3_BUCKET=physical-core
S3_ACCESS_KEY_ID=changeme
S3_SECRET_ACCESS_KEY=changeme
S3_FORCE_PATH_STYLE=true
S3_SIGNING_V4=true
S3_TLS_VERIFY=true

# Локальные пути
DATA_DIR=/var/lib/physical-core/data
RUNTIME_DIR=/var/run/physical-core
TMP_DIR=/tmp

# -----------------------------------------------------------------------------
# Аутентификация и авторизация
# -----------------------------------------------------------------------------
AUTH_MODE=jwt                     # jwt, oidc, hybrid
JWT_ALG=HS256                     # HS256, RS256
JWT_SECRET=changeme_supersecret_min32chars
JWT_ISSUER=https://auth.example.com/
JWT_AUDIENCE=physical-core
# Для RS256 укажите пути к ключам
JWT_PRIVATE_KEY_PATH=/etc/physical-core/jwt_private.pem
JWT_PUBLIC_KEY_PATH=/etc/physical-core/jwt_public.pem
JWT_DEFAULT_TTL_SECONDS=3600
JWT_LEEWAY_SECONDS=30

# OIDC провайдер
OIDC_ENABLED=false
OIDC_ISSUER=https://id.example.com/
OIDC_CLIENT_ID=changeme
OIDC_CLIENT_SECRET=changeme
OIDC_SCOPES=openid,profile,email
OIDC_JWKS_URL=https://id.example.com/.well-known/jwks.json

# -----------------------------------------------------------------------------
# Безопасность и лимиты
# -----------------------------------------------------------------------------
SECURE_HEADERS=true
CONTENT_SECURITY_POLICY=default-src 'none'; connect-src 'self'; img-src 'self' data:; script-src 'self'; style-src 'self'
REFERRER_POLICY=no-referrer
HSTS_ENABLED=true
HSTS_MAX_AGE=31536000
XFRAME_DENY=true

RATE_LIMIT_ENABLED=true
RATE_LIMIT_BACKEND=redis
RATE_LIMIT_DEFAULT=100r/m
RATE_LIMIT_BURST=50
IP_WHITELIST=
IP_BLACKLIST=

# Idempotency
IDEMPOTENCY_ENABLED=true
IDEMPOTENCY_TTL_SECONDS=600

# Подпись вебхуков
WEBHOOK_SIGNING_ALG=hmac-sha256
WEBHOOK_SIGNING_SECRET=changeme_webhook_secret

# Локальное шифрование при отсутствии KMS
ENCRYPTION_ALG=fernet
ENCRYPTION_KEY_BASE64=changeme_base64_32bytes_key

# Интеграция с KMS
KMS_ENABLED=false
KMS_PROVIDER=aws
KMS_KEY_ID=alias/physical-core
KMS_REGION=us-east-1

# -----------------------------------------------------------------------------
# Наблюдаемость и логирование
# -----------------------------------------------------------------------------
LOG_LEVEL=INFO                   # DEBUG, INFO, WARNING, ERROR
LOG_FORMAT=json                  # json, console
STRUCTURED_LOGGING=true
REQUEST_LOGGING=true
REQUEST_LOG_BODY_LIMIT=2048

# Prometheus
METRICS_ENABLED=true
METRICS_HOST=0.0.0.0
METRICS_PORT=9091
METRICS_PATH=/metrics

# OpenTelemetry
OTEL_SDK_DISABLED=false
OTEL_SERVICE_NAME=physical-integration-core
OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4318
OTEL_EXPORTER_OTLP_PROTOCOL=http
OTEL_TRACES_SAMPLER=parentbased_traceidratio
OTEL_TRACES_SAMPLER_ARG=0.1
OTEL_RESOURCE_ATTRIBUTES=deployment.environment=production

# Sentry
SENTRY_DSN=
SENTRY_ENVIRONMENT=production
SENTRY_TRACES_SAMPLE_RATE=0.1
SENTRY_PROFILES_SAMPLE_RATE=0.0

# -----------------------------------------------------------------------------
# Почта и уведомления
# -----------------------------------------------------------------------------
SMTP_ENABLED=false
SMTP_HOST=localhost
SMTP_PORT=587
SMTP_USERNAME=
SMTP_PASSWORD=
SMTP_USE_TLS=true
SMTP_FROM=noreply@example.com

# -----------------------------------------------------------------------------
# Интеграции с промышленными протоколами
# -----------------------------------------------------------------------------
# MQTT
MQTT_ENABLED=true
MQTT_BROKER_URL=tcp://localhost:1883
MQTT_CLIENT_ID=physical-core-agent
MQTT_USERNAME=
MQTT_PASSWORD=
MQTT_TLS_ENABLED=false
MQTT_TLS_CA_FILE=
MQTT_KEEPALIVE_SECONDS=60
MQTT_CLEAN_SESSION=true
MQTT_QOS_DEFAULT=1
MQTT_TOPIC_PREFIX=physical/core

# OPC UA
OPCUA_ENABLED=false
OPCUA_ENDPOINTS=opc.tcp://localhost:4840
OPCUA_SECURITY_MODE=None         # None, Sign, SignAndEncrypt
OPCUA_SECURITY_POLICY=None       # None, Basic256Sha256, Aes256_Sha256_RsaPss
OPCUA_USERNAME=
OPCUA_PASSWORD=
OPCUA_SESSION_TIMEOUT_MS=60000
OPCUA_SUBSCRIPTION_PUBLISH_MS=500

# Modbus TCP
MODBUS_ENABLED=false
MODBUS_HOSTS=localhost
MODBUS_PORT=502
MODBUS_UNIT_IDS=1
MODBUS_TIMEOUT_MS=2000
MODBUS_RETRY_COUNT=3
MODBUS_BACKOFF_MS=250

# Serial RS-485 пример
SERIAL_ENABLED=false
SERIAL_PORTS=/dev/ttyUSB0
SERIAL_BAUDRATE=9600
SERIAL_PARITY=N                 # N, E, O
SERIAL_STOPBITS=1
SERIAL_BYTESIZE=8
SERIAL_TIMEOUT_MS=1000

# -----------------------------------------------------------------------------
# Обработка данных и политика приватности
# -----------------------------------------------------------------------------
DP_ENABLED=false
DP_MODE=zcdp                     # zcdp, epsilon_delta
DP_EPSILON_BUDGET=2.0
DP_DELTA=1e-6
DP_ACCOUNTANT_POLICY_FILE=/etc/physical-core/dp_policy.json

# -----------------------------------------------------------------------------
# Таймсерии и аналитика
# -----------------------------------------------------------------------------
TIMESERIES_ENABLED=false
INFLUXDB_URL=http://localhost:8086
INFLUXDB_TOKEN=changeme
INFLUXDB_ORG=example
INFLUXDB_BUCKET=physical

# или Timescale поверх PostgreSQL
TIMESCALE_HYPERTABLE=true

# -----------------------------------------------------------------------------
# Параметры загрузки больших файлов и буферов
# -----------------------------------------------------------------------------
MAX_UPLOAD_MB=100
STREAM_CHUNK_BYTES=65536
BACKPRESSURE_HIGH_WATERMARK=10485760

# -----------------------------------------------------------------------------
# Флаги функций и совместимость
# -----------------------------------------------------------------------------
FEATURE_FLAGS=
COMPAT_MODE=auto

# -----------------------------------------------------------------------------
# Kubernetes и облачная среда
# -----------------------------------------------------------------------------
K8S_NAMESPACE=default
K8S_POD_NAME=
K8S_NODE_NAME=
K8S_CLUSTER_NAME=
POD_IP=

# -----------------------------------------------------------------------------
# Тестирование и режим разработки
# -----------------------------------------------------------------------------
MOCK_DEVICES=false
SEED=42
DEBUG_SQL=false
TRACE_PROTOCOL=false
