{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "App: python -m physical_integration_core",
      "type": "python",
      "request": "launch",
      "module": "physical_integration_core",
      "console": "integratedTerminal",
      "justMyCode": false,
      "redirectOutput": true,
      "subProcess": true,
      "envFile": "${workspaceFolder}/.env",
      "env": {
        "PYTHONUNBUFFERED": "1",
        "PYTHONHASHSEED": "0",
        "LOG_LEVEL": "INFO"
      }
    },
    {
      "name": "App (main.py)",
      "type": "python",
      "request": "launch",
      "program": "${workspaceFolder}/main.py",
      "console": "integratedTerminal",
      "justMyCode": false,
      "redirectOutput": true,
      "subProcess": true,
      "envFile": "${workspaceFolder}/.env.local",
      "env": {
        "PYTHONUNBUFFERED": "1",
        "LOG_LEVEL": "DEBUG"
      }
    },
    {
      "name": "API: FastAPI via uvicorn",
      "type": "python",
      "request": "launch",
      "module": "uvicorn",
      "args": [
        "physical_integration_core.api:app",
        "--host",
        "0.0.0.0",
        "--port",
        "8080",
        "--reload"
      ],
      "jinja": true,
      "console": "integratedTerminal",
      "justMyCode": false,
      "subProcess": true,
      "envFile": "${workspaceFolder}/.env",
      "env": {
        "LOG_LEVEL": "DEBUG",
        "UVICORN_RELOAD": "1"
      }
    },
    {
      "name": "CLI: tools/<entry>.py",
      "type": "python",
      "request": "launch",
      "program": "${workspaceFolder}/cli/tools/<entry>.py",
      "args": [],
      "console": "integratedTerminal",
      "justMyCode": false,
      "envFile": "${workspaceFolder}/.env"
    },
    {
      "name": "Tests: pytest (unit)",
      "type": "python",
      "request": "launch",
      "module": "pytest",
      "args": [
        "-q",
        "tests/unit"
      ],
      "console": "integratedTerminal",
      "justMyCode": false,
      "envFile": "${workspaceFolder}/.env",
      "env": {
        "PYTEST_ADDOPTS": "-ra"
      }
    },
    {
      "name": "Tests: pytest (integration, markers)",
      "type": "python",
      "request": "launch",
      "module": "pytest",
      "args": [
        "-q",
        "tests/integration",
        "-m",
        "integration"
      ],
      "console": "integratedTerminal",
      "justMyCode": false,
      "envFile": "${workspaceFolder}/.env"
    },
    {
      "name": "Attach: Local debugpy (localhost:5678)",
      "type": "python",
      "request": "attach",
      "connect": {
        "host": "127.0.0.1",
        "port": 5678
      },
      "justMyCode": false,
      "pathMappings": [
        {
          "localRoot": "${workspaceFolder}",
          "remoteRoot": "${workspaceFolder}"
        }
      ]
    },
    {
      "name": "Attach: Docker container (debugpy)",
      "type": "python",
      "request": "attach",
      "connect": {
        "host": "127.0.0.1",
        "port": 5678
      },
      "justMyCode": false,
      "pathMappings": [
        {
          "localRoot": "${workspaceFolder}",
          "remoteRoot": "/app"
        }
      ]
    },
    {
      "name": "Attach: Remote host (debugpy)",
      "type": "python",
      "request": "attach",
      "connect": {
        "host": "${input:remoteHost}",
        "port": 5678
      },
      "justMyCode": false,
      "pathMappings": [
        {
          "localRoot": "${workspaceFolder}",
          "remoteRoot": "/srv/physical-integration-core"
        }
      ]
    },
    {
      "name": "Profile: cProfile app main",
      "type": "python",
      "request": "launch",
      "module": "cProfile",
      "args": [
        "-o",
        "${workspaceFolder}/.artifacts/profile-main.prof",
        "${workspaceFolder}/main.py"
      ],
      "console": "integratedTerminal",
      "justMyCode": false,
      "envFile": "${workspaceFolder}/.env"
    }
  ],
  "compounds": [
    {
      "name": "API + Attach (hot reload)",
      "configurations": [
        "API: FastAPI via uvicorn",
        "Attach: Local debugpy (localhost:5678)"
      ],
      "stopAll": true
    },
    {
      "name": "Run app + unit tests",
      "configurations": [
        "App: python -m physical_integration_core",
        "Tests: pytest (unit)"
      ],
      "stopAll": true
    }
  ],
  "inputs": [
    {
      "id": "remoteHost",
      "type": "promptString",
      "description": "Укажите хост для удалённого attach",
      "default": "10.0.0.10"
    }
  ]
}
