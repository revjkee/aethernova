apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: pic-api-pdb
  labels:
    app.kubernetes.io/name: physical-integration-core
    app.kubernetes.io/part-of: physical-integration-core
    app.kubernetes.io/component: api
    app.kubernetes.io/managed-by: kustomize
spec:
  # Поддерживает масштаб: при N репликах минимум ceil(0.60*N) должен оставаться доступным.
  # При 1 реплике выселение будет запрещено.
  minAvailable: 60%
  selector:
    matchLabels:
      app.kubernetes.io/name: physical-integration-core
      app.kubernetes.io/component: api
---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: pic-worker-pdb
  labels:
    app.kubernetes.io/name: physical-integration-core
    app.kubernetes.io/part-of: physical-integration-core
    app.kubernetes.io/component: worker
    app.kubernetes.io/managed-by: kustomize
spec:
  # Позволяем выселить не более одного воркера одновременно для плавной деградации.
  # Для больших парков можно переопределить в оверлее на долю (например, "25%").
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: physical-integration-core
      app.kubernetes.io/component: worker
