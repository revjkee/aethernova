# Changelog — datafabric-core

Формат основан на [Keep a Changelog](https://keepachangelog.com/ru/1.1.0/) и версионировании [SemVer 2.0.0](https://semver.org/lang/ru/).

Все заметные изменения в этом проекте будут документироваться в этом файле. Даты указаны в формате YYYY-MM-DD. Для каждой версии приводятся ссылки сравнения с предыдущими релизами. Ломающие изменения отмечаются пометкой **BREAKING** и сопровождаются разделом «Миграция».

> Соглашение по разделам: Added, Changed, Fixed, Security, Deprecated, Removed, Performance, Docs, Build, CI.

---

## [Unreleased]

### Changed
- Обновить этот раздел при подготовке следующего релиза.

### Fixed
- Исправить описания при объединении PR.

### Security
- При наличии закрытых исправлений безопасности дать краткое резюме и ссылку на патч.

### Миграция
- Добавьте инструкции миграции, если планируются ломающие изменения.

---

## [1.2.0] — 2025-08-13

### Added
- Пакет `datafabric.runtime` с модулем оркестрации потоков данных и управлением сессиями выполнения.
- Конфигурационный ключ `engine.jobs.max_concurrency` с поддержкой динамической перегрузки на лету.
- Метрики прометея для операторов источников и приёмников: `df_source_lag_seconds`, `df_sink_throughput_total`.
- CLI-команда `dfctl inspect topology` для интроспекции графа задач.

### Changed
- Поведение обработчика ретраев: введён экспоненциальный backoff с джиттером по умолчанию.
- Стандарт формата снепшотов состояния сменён на v2 (совместим назад на чтение).
- Обновлён минимальный Python до 3.10.

### Fixed
- Устранён дедлок при конкурентной чекпойнтинговой записи состояния.
- Исправлено некорректное закрытие дескрипторов при отмене задач.

### Performance
- Снижена латентность чекпойнтов примерно на 20–30% за счёт пакетной синхронизации.

### Docs
- Обновлён раздел «Deployment» с примерами конфигурации systemd и контейнеров.

### Миграция
1. Обновите минимальную версию Python до 3.10.
2. Проверьте конфигурацию: при отсутствии явного значения `engine.jobs.max_concurrency` применяется значение по умолчанию 4.
3. При использовании пользовательских сериализаторов состояний убедитесь, что они поддерживают формат снепшотов v2 (чтение формата v1 поддерживается автоматически).
4. Пересоберите образы с обновлёнными зависимостями.

---

## [1.1.0] — 2025-07-22

### Added
- Поддержка транзакций для приёмников Kafka с idempotent producer.
- Новый оператор `WindowAggregate` (tumbling, hopping).

### Changed
- Значение по умолчанию для `checkpoint.interval` изменено с 60s на 30s.

### Fixed
- Исправлен рассинхрон меток времени при восстановлении после сбоя.

### Deprecated
- Конфигурационный ключ `engine.retry.linear_backoff_ms` объявлен устаревшим, используйте `engine.retry.exponential_backoff`.

### Миграция
- Если ранее использовался `engine.retry.linear_backoff_ms`, перенесите настройки в `engine.retry.exponential_backoff`.
- Проверьте нагрузку после изменения `checkpoint.interval` на 30s.

---

## [1.0.0] — 2025-06-30

### Added
- Базовая версия datafabric-core: модель операторов, граф исполнения, чекпойнты, источники/приёмники файловой системы и HTTP.
- Библиотека типов событий и контрактов.
- Набор e2e‑тестов производительности и корректности.

### Security
- Включён режим валидации входных схем и ограничение размера полезной нагрузки.

---

## Политика версионирования

- MAJOR (x.0.0): ломающие изменения в API, протоколах состояния, форматах артефактов.
- MINOR (0.x.0): обратно совместимые возможности и улучшения.
- PATCH (0.0.x): исправления ошибок и незначительные улучшения без изменения API.

## Матрица поддержки

- Активная поддержка: последняя MINOR ветка (получает исправления багов и безопасности).
- Расширенная безопасность: предыдущая MINOR ветка в течение 90 дней после нового MINOR релиза.
- EOL: версии без поддержки, патчи не выпускаются.

| Версия | Статус              | Дата EOL    |
|-------:|---------------------|-------------|
| 1.2.x  | Active              | TBD         |
| 1.1.x  | Security-only       | 2025-10-20  |
| 1.0.x  | EOL                 | 2025-07-22  |

## Правила внесения изменений

1. Каждое изменение попадает в раздел [Unreleased] в соответствующую категорию.
2. При релизе:
   - Обновите дату версии.
   - Перенесите записи из [Unreleased] в новый раздел версии.
   - Проверьте наличие раздела «Миграция» при ломающих изменениях.
3. Все записи должны быть осмысленными и проверяемыми, без внутренних жаргонов.

## Процесс релиза

1. Обновить версии модулей и зависимостей.
2. Прогнать тесты (unit, integration, e2e), статический анализ и линтеры.
3. Сформировать релизные артефакты.
4. Обновить этот файл и теги.
5. Опубликовать релиз с бинарями, суммами и ссылками на изменения.

## Ссылки сравнения

- [Unreleased]: <REPO_URL>/compare/v1.2.0...HEAD
- [1.2.0]: <REPO_URL>/compare/v1.1.0...v1.2.0
- [1.1.0]: <REPO_URL>/compare/v1.0.0...v1.1.0
- [1.0.0]: <REPO_URL>/releases/tag/v1.0.0
