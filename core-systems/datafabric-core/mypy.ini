# datafabric-core / mypy.ini

[mypy]
python_version = 3.10

# --- Диагностика/формат ---
show_error_codes = True
pretty = True
color_output = True
error_summary = True

# --- Строгость по умолчанию (прод-код) ---
warn_redundant_casts = True
warn_unused_ignores = True
warn_return_any = True
warn_unreachable = True
no_implicit_optional = True
strict_equality = True
check_untyped_defs = True
disallow_any_generics = True
disallow_subclassing_any = True
disallow_untyped_calls = True
disallow_untyped_defs = True
disallow_incomplete_defs = True
disallow_untyped_decorated_calls = True
implicit_reexport = False
allow_redefinition = False
local_partial_types = True

# --- Импорты и неймспейсы ---
follow_imports = silent
namespace_packages = True
explicit_package_bases = True
mypy_path = stubs

# --- Инкрементальность/кэш ---
incremental = True
cache_dir = .mypy_cache
sqlite_cache = True

# --- Исключения путей (regex, (?x) — многострочный) ---
exclude = (?x)(
    ^\.venv/|
    ^build/|
    ^dist/|
    ^\.mypy_cache/|
    ^\.pytest_cache/|
    ^telemetry/|
    ^deploy/|
    ^.*_pb2\.py$|
    ^.*_pb2_grpc\.py$
)

# --- Плагины (раскомментируйте соответствующие, если используются) ---
# plugins = pydantic.mypy, sqlalchemy.ext.mypy.plugin, attrs_mypy_plugin

#######################################################################
#                            ПЕР-РАЗДЕЛЫ                              #
#######################################################################

# Прод-код движка: максимально строгий
[mypy-engine.*]
warn_return_any = True
disallow_any_generics = True
disallow_untyped_defs = True
disallow_incomplete_defs = True
check_untyped_defs = True

# Адаптеры интеграций: допускаем незадокументированные внешние типы, но не функции без типов
[mypy-engine.adapters.*]
disallow_untyped_calls = True
disallow_untyped_defs = True
disallow_any_generics = True

# Телеметрия/профили: строгий режим, но позволяем reexport (для удобства публичных API)
[mypy-engine.telemetry.*]
implicit_reexport = True

# CLI/скрипты: допускаем больше динамики при сохранении базовых гарантий
[mypy-engine.cli.*]
disallow_untyped_defs = True
check_untyped_defs = True
warn_return_any = True

# Тесты: послабления для скорости и читаемости
[mypy-engine.tests.*]
disallow_untyped_defs = False
check_untyped_defs = False
warn_return_any = False
allow_redefinition = True

[mypy-engine.tests.unit.*]
disallow_untyped_defs = False
warn_return_any = False

[mypy-engine.tests.integration.*]
disallow_untyped_defs = False
warn_return_any = False

[mypy-engine.tests.conformance.*]
disallow_untyped_defs = False
warn_return_any = False

[mypy-engine.tests.chaos.*]
disallow_untyped_defs = False
warn_return_any = False

[mypy-engine.tests.bench.*]
disallow_untyped_defs = False
warn_return_any = False

# Моки/генераторы — игнорируем ошибки типов
[mypy-engine.mocks.*]
ignore_errors = True

# Примеры/скрипты — мягкий режим
[mypy-examples.*]
disallow_untyped_defs = False
warn_return_any = False

# Скрипты верхнего уровня репозитория
[mypy-scripts.*]
disallow_untyped_defs = False
warn_return_any = False

#######################################################################
#                  ТРЕТЬИ СТОРОНЫ: ГРАНУЛЯРНЫЕ ПРАВИЛА               #
#######################################################################

[mypy-numpy.*]
ignore_missing_imports = True

[mypy-pandas.*]
ignore_missing_imports = True

[mypy-httpx.*]
ignore_missing_imports = True

[mypy-websockets.*]
ignore_missing_imports = True

[mypy-redis.*]
ignore_missing_imports = True

[mypy-pytest.*]
ignore_missing_imports = True

[mypy-pydantic.*]
ignore_missing_imports = True

[mypy-sqlalchemy.*]
ignore_missing_imports = True

[mypy-esper.*]
ignore_missing_imports = True

[mypy-psutil.*]
ignore_missing_imports = True

[mypy-matplotlib.*]
ignore_missing_imports = True

[mypy-prometheus_client.*]
ignore_missing_imports = True

[mypy-opentelemetry.*]
ignore_missing_imports = True

#######################################################################
#                    СПЕЦИАЛЬНЫЕ ФАЙЛЫ И МАСКИ                        #
#######################################################################

# Автогенерат protobuf/grpc (на всякий случай, если попал в репозиторий)
[mypy-*_pb2]
ignore_errors = True

[mypy-*_pb2_grpc]
ignore_errors = True
