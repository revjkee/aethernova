apiVersion: v2
name: datafabric-core
description: |
  DataFabric Core — ядро конвейеров обработки данных: API, оркестрация задач,
  источники/приемники, состояние и метрики. Чарт разворачивает приложение и,
  опционально, инфраструктурные зависимости для окружений dev/staging/prod.

type: application

# SemVer чарт‑версия (меняется при любых изменениях чарта)
version: 1.2.0

# Версия приложения (может ссылаться на тег образа)
appVersion: "1.2.0"

# Минимально поддерживаемая версия кластера
kubeVersion: ">=1.25.0-0"

home: https://example.org/datafabric-core
sources:
  - https://github.com/your-org/datafabric-core
  - https://docs.example.org/datafabric
icon: https://example.org/assets/datafabric-core-icon.png
keywords:
  - data
  - stream
  - pipeline
  - orchestration
  - kafka
  - postgres
  - s3
  - minio

maintainers:
  - name: platform-team
    email: platform@example.org
    url: https://example.org/teams/platform
  - name: data-engineering
    email: data-eng@example.org

# Для OCI‑регистров
annotations:
  artifacthub.io/category: data-processing
  artifacthub.io/license: Apache-2.0
  artifacthub.io/prerelease: "false"
  artifacthub.io/links: |
    - name: Documentation
      url: https://docs.example.org/datafabric
    - name: Source
      url: https://github.com/your-org/datafabric-core
  artifacthub.io/images: |
    - name: datafabric-core
      image: ghcr.io/your-org/datafabric-core:1.2.0
      platforms:
        - linux/amd64
        - linux/arm64
    - name: sidecar-metrics
      image: ghcr.io/your-org/datafabric-metrics-exporter:1.2.0
      platforms:
        - linux/amd64
        - linux/arm64
  artifacthub.io/changes: |
    - kind: added
      description: "Новый экспорт метрик Prometheus и readiness-зонд"
    - kind: changed
      description: "Обновлён минимальный kubeVersion до 1.25"
    - kind: fixed
      description: "Исправлено условие включения MinIO подProd"
  artifacthub.io/crds: |
    - kind: PrometheusRule
      version: monitoring.coreos.com/v1
      name: prometheusrules.monitoring.coreos.com
    - kind: ServiceMonitor
      version: monitoring.coreos.com/v1
      name: servicemonitors.monitoring.coreos.com
  # Стандартные метки чартов (k8s‑recommended labels)
  app.kubernetes.io/name: datafabric-core
  app.kubernetes.io/part-of: datafabric
  app.kubernetes.io/component: api

# Зависимости как опциональные под‑чарты.
# Их включение управляется значениями в values.yaml (true/false).
dependencies:
  - name: postgresql
    version: 15.5.17
    repository: https://charts.bitnami.com/bitnami
    condition: postgresql.enabled
    tags: ["db", "postgres", "infrastructure"]
  - name: redis
    version: 19.5.5
    repository: https://charts.bitnami.com/bitnami
    condition: redis.enabled
    tags: ["cache", "redis", "infrastructure"]
  - name: kafka
    version: 26.7.3
    repository: https://charts.bitnami.com/bitnami
    condition: kafka.enabled
    tags: ["kafka", "broker", "infrastructure"]
  - name: minio
    version: 14.8.12
    repository: https://charts.bitnami.com/bitnami
    condition: minio.enabled
    tags: ["object-store", "s3", "minio", "infrastructure"]

# Дополнительные сведения о совместимости/поддержке
deprecated: false
