# omnimind-core/mypy.ini
# Промышленный профиль mypy для строгой типизации асинхронного Python-проекта.

[mypy]
python_version = 3.11
strict = True

# Дополнительные усиления качества
warn_unused_configs = True
warn_redundant_casts = True
warn_unused_ignores = True
warn_return_any = True
warn_unreachable = True
no_implicit_optional = True
implicit_reexport = False
strict_equality = True
allow_redefinition = False

# Работа с неполными/нетипизированными участками
check_untyped_defs = True
disallow_incomplete_defs = True
disallow_untyped_calls = True
disallow_untyped_defs = True
disallow_untyped_decorated_calls = True
disallow_subclassing_any = True
disallow_any_generics = True
disallow_any_unimported = True

# Импорты и поиск тайпингов
follow_imports = normal
ignore_missing_imports = False
mypy_path = stubs

# Производительность/стабильность анализа
cache_dir = .mypy_cache
show_error_codes = True
show_column_numbers = True
pretty = True
error_summary = True
color_output = True

# Плагины доменной модели
plugins =
    pydantic.mypy,
    sqlalchemy.ext.mypy.plugin

# Настройки плагина Pydantic v2
[pydantic-mypy]
init_typed = True
warn_required_dynamic_aliases = True
warn_untyped_fields = True
# Генерация тайпингов для полей BaseModel
# (в v2 плагин автоматически выводит типы, но оставляем опции явными)
plugin_enabled = True

# --- Папки с ослабленным профилем ---

# Тесты: допускаем нестрогие определения и упрощаем контроль Any.
[mypy-tests.*]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_any_unimported = False
disallow_any_generics = False
warn_unused_ignores = True
ignore_errors = False

# Скрипты/утилиты (например, миграции, одноразовые конверторы)
[mypy-scripts.*]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_any_unimported = False
disallow_any_generics = False

# --- Точечные игноры для сторонних пакетов без stubs ---
# (Оставляйте список минимальным и актуализируйте по мере появления stubs)

[mypy-aiogram.*]
ignore_missing_imports = True

[mypy-fastapi.*]
ignore_missing_imports = True

[mypy-uvicorn.*]
ignore_missing_imports = True

[mypy-starlette.*]
ignore_missing_imports = True

[mypy-httptools.*]
ignore_missing_imports = True

[mypy-orjson.*]
ignore_missing_imports = True

[mypy-ujson.*]
ignore_missing_imports = True

[mypy-psycopg.*]
ignore_missing_imports = True

[mypy-psycopg2.*]
ignore_missing_imports = True

[mypy-redis.*]
ignore_missing_imports = True

[mypy-aioredis.*]
ignore_missing_imports = True

[mypy-tenacity.*]
ignore_missing_imports = True

[mypy-opentelemetry.*]
ignore_missing_imports = True

[mypy-prometheus_client.*]
ignore_missing_imports = True

[mypy-pythonjsonlogger.*]
ignore_missing_imports = True

[mypy-loguru.*]
ignore_missing_imports = True

[mypy-pytest.*]
ignore_missing_imports = True

[mypy-hypothesis.*]
ignore_missing_imports = True

[mypy-black.*]
ignore_missing_imports = True

[mypy-isort.*]
ignore_missing_imports = True

[mypy-ruff.*]
ignore_missing_imports = True

# --- SQLAlchemy: допускаем динамику там, где это необходимо ---

# Иногда алкеми-модели используют динамические атрибуты, которые плагин не всегда выводит.
# Здесь выключаем самые строгие проверки на уровне ORM-слоя, если потребуется:
[mypy-omnimind_core.db.*]
disallow_any_generics = False
disallow_subclassing_any = False
disallow_untyped_defs = False

# --- Конфиги/entrypoints: обычно много окружения и динамики ---

[mypy-omnimind_core.config.*]
disallow_untyped_defs = False
disallow_untyped_calls = False

[mypy-omnimind_core.main]
disallow_untyped_defs = False
disallow_untyped_calls = False

# --- Интеграции с внешними API/SDK: могут отсутствовать stubs ---

[mypy-omnimind_core.integrations.*]
ignore_missing_imports = True
disallow_any_unimported = False
disallow_untyped_defs = False

# --- Генерируемый код (protobuf/openapi/clients): исключаем из строгого анализа ---

[mypy-omnimind_core.generated.*]
ignore_errors = True

# --- Экспериментальные/резервные модули (опционально) ---

[mypy-omnimind_core.experimental.*]
warn_unused_ignores = True
disallow_untyped_defs = False
disallow_untyped_calls = False
