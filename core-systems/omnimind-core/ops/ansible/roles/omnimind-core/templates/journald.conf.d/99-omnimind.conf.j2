# =====================================================================
# Managed by Ansible
# File: /etc/systemd/journald.conf.d/99-omnimind.conf
# Purpose: OmniMind Core journald hardening & quotas (drop-in)
# Do not edit manually — use Ansible inventory (logging.journald.*)
# =====================================================================

[Journal]

# ---------------------------
# Storage / Compression / Seal
# ---------------------------
# Storage: auto|persistent|volatile|none
Storage={{ logging.journald.storage | default('auto') }}
# Compress large journal files to reduce disk usage (yes|no)
Compress={{ logging.journald.compress | default('yes') }}
# Seal journal files with Forward Secure Sealing (yes|no)
Seal={{ logging.journald.seal | default('yes') }}

# ---------------------------
# Rate limits (DoS protection)
# ---------------------------
# Interval and burst define how many identical messages are accepted per interval.
RateLimitIntervalSec={{ logging.journald.rate_limit_interval | default('30s') }}
RateLimitBurst={{ logging.journald.rate_limit_burst | default(1000) }}

# ---------------------------
# Retention / Size quotas
# Значения могут задаваться в байтах или с суффиксами K,M,G,T
# ---------------------------
{% if logging.journald.system_max_use is defined %}
SystemMaxUse={{ logging.journald.system_max_use }}
{% endif %}
{% if logging.journald.runtime_max_use is defined %}
RuntimeMaxUse={{ logging.journald.runtime_max_use }}
{% endif %}
{% if logging.journald.system_keep_free is defined %}
SystemKeepFree={{ logging.journald.system_keep_free }}
{% endif %}
{% if logging.journald.max_retention_sec is defined %}
MaxRetentionSec={{ logging.journald.max_retention_sec }}
{% endif %}
{% if logging.journald.max_file_sec is defined %}
MaxFileSec={{ logging.journald.max_file_sec }}
{% endif %}

# ---------------------------
# Sync and Split
# ---------------------------
# Синхронизация метаданных на диск — баланс между надёжностью и I/O.
SyncIntervalSec={{ logging.journald.sync_interval_sec | default('5m') }}
# Разделение журналов по пользователям (uid|none)
SplitMode={{ logging.journald.split_mode | default('uid') }}

# ---------------------------
# Forwarding (optional)
# ---------------------------
# Пересылка в системный syslog/консоль/ядро — по умолчанию отключена.
ForwardToSyslog={{ logging.journald.forward_to_syslog | default('no') }}
ForwardToConsole={{ logging.journald.forward_to_console | default('no') }}
ForwardToKMsg={{ logging.journald.forward_to_kmsg | default('no') }}
# Ограничение уровней при форвардинге/хранении (emerg..debug). Переопределяйте при необходимости.
{% if logging.journald.max_level_store is defined %}
MaxLevelStore={{ logging.journald.max_level_store }}
{% endif %}
{% if logging.journald.max_level_syslog is defined %}
MaxLevelSyslog={{ logging.journald.max_level_syslog }}
{% endif %}
{% if logging.journald.max_level_console is defined %}
MaxLevelConsole={{ logging.journald.max_level_console }}
{% endif %}
{% if logging.journald.max_level_kmsg is defined %}
MaxLevelKMsg={{ logging.journald.max_level_kmsg }}
{% endif %}

# ---------------------------
# Audit trail hints
# ---------------------------
# Для повышенной надёжности аудита оставьте Compression=+Seal=enabled,
# используйте persistent Storage и задайте разумные квоты SystemMaxUse/SystemKeepFree.

# EOF
