{
  "name": "OmniMind Core Dev",
  "dockerComposeFile": "docker-compose.dev.yml",
  "service": "app",
  "workspaceFolder": "/workspace",

  "settings": {
    "terminal.integrated.defaultProfile.linux": "bash",
    "editor.formatOnSave": true,
    "python.analysis.typeCheckingMode": "strict",
    "python.linting.enabled": true,
    "python.linting.mypyEnabled": true,
    "python.linting.ruffEnabled": true,
    "python.formatting.provider": "black"
  },

  "extensions": [
    "ms-python.python",
    "ms-python.vscode-pylance",
    "ms-python.black-formatter",
    "charliermarsh.ruff",
    "batisteo.vscode-django",
    "ms-azuretools.vscode-docker",
    "mhutchie.git-graph",
    "eamodio.gitlens",
    "EditorConfig.EditorConfig",
    "ms-vscode-remote.remote-containers"
  ],

  "postCreateCommand": "bash .devcontainer/post_create.sh",

  "remoteUser": "vscode",

  "features": {
    "ghcr.io/devcontainers/features/python:1": {
      "version": "3.11",
      "installTools": true
    },
    "ghcr.io/devcontainers/features/docker-in-docker:2": {
      "version": "20.10",
      "moby": true
    },
    "ghcr.io/devcontainers/features/common-utils:2": {
      "username": "vscode",
      "nonFreePackages": true,
      "upgradePackages": true
    }
  },

  "mounts": [
    "source=${localWorkspaceFolder}/.venv,target=/workspace/.venv,type=bind,consistency=cached",
    "source=/var/run/docker.sock,target=/var/run/docker.sock,type=bind"
  ],

  "containerEnv": {
    "PYTHONUNBUFFERED": "1",
    "PYTHONPATH": "/workspace",
    "PIP_CACHE_DIR": "/workspace/.pip-cache",
    "PIP_NO_CACHE_DIR": "false"
  },

  "forwardPorts": [
    8000,
    5432,
    6379,
    9229
  ],

  "portsAttributes": {
    "8000": { "label": "FastAPI App", "onAutoForward": "notify" },
    "5432": { "label": "Postgres DB", "onAutoForward": "silent" },
    "6379": { "label": "Redis", "onAutoForward": "silent" },
    "9229": { "label": "Debugger", "onAutoForward": "silent" }
  },

  "runServices": [
    "app",
    "db",
    "redis"
  ],

  "shutdownAction": "stopCompose"
}
