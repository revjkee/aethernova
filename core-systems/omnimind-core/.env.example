# omnimind-core/.env.example
# ВНИМАНИЕ: это пример. Не храните реальные секреты в репозитории.
# Все значения CHANGE_ME/OPTIONAL замените в реальных окружениях (dev/stage/prod).

#######################################################################
# 0) БАЗОВАЯ ИДЕНТИФИКАЦИЯ И РЕЖИМЫ
#######################################################################
APP_NAME=omnimind-core
APP_ENV=development               # development|staging|production
APP_VERSION=0.1.0
TZ=Europe/Stockholm
LOCALE=ru_RU.UTF-8

# Коммуникации HTTP
HOST=0.0.0.0
PORT=8000
WORKERS=4                         # gunicorn/uvicorn workers
GRACEFUL_TIMEOUT_SEC=30

# Безопасные дефолты
DEBUG=false
ALLOWED_HOSTS=localhost,127.0.0.1
CORS_ALLOW_ORIGINS=https://CHANGE_ME_DOMAIN
CORS_ALLOW_CREDENTIALS=false
CORS_ALLOW_METHODS=GET,POST,PUT,DELETE,OPTIONS
CORS_ALLOW_HEADERS=Authorization,Content-Type,X-Request-Id

#######################################################################
# 1) ЛОГИРОВАНИЕ, МЕТРИКИ, ТРЕЙСИНГ, SENTRY
#######################################################################
LOG_LEVEL=INFO                    # DEBUG|INFO|WARNING|ERROR
LOG_FORMAT=json                   # json|text
LOG_SAMPLING_RATE=1.0             # 0..1
REQUEST_ID_HEADER=X-Request-Id
ACCESS_LOG=true
STRUCTURED_LOGS=true

PROMETHEUS_ENABLED=true
PROMETHEUS_ENDPOINT=/metrics

OTEL_ENABLED=false
OTEL_TRACES_EXPORTER=otlp
OTEL_METRICS_EXPORTER=otlp
OTEL_LOGS_EXPORTER=none
OTEL_EXPORTER_OTLP_ENDPOINT=http://otel-collector:4317
OTEL_SERVICE_NAME=omnimind-core
OTEL_TRACES_SAMPLER=parentbased_traceidratio
OTEL_TRACES_SAMPLER_ARG=0.1

SENTRY_ENABLED=false
SENTRY_DSN=
SENTRY_TRACES_SAMPLE_RATE=0.05
SENTRY_PROFILES_SAMPLE_RATE=0.0
SENTRY_ENVIRONMENT=${APP_ENV}

#######################################################################
# 2) БАЗА ДАННЫХ (ASYNC-ONLY, PostgreSQL/asyncpg)
#######################################################################
# Формат: postgresql+asyncpg://USER:PASSWORD@HOST:PORT/DBNAME
DATABASE_URL=postgresql+asyncpg://omni_user:CHANGE_ME@postgres:5432/omnimind
DB_POOL_MIN_SIZE=5
DB_POOL_MAX_SIZE=30
DB_STATEMENTS_TIMEOUT_MS=15000
DB_CONN_TIMEOUT_MS=5000
DB_ECHO=false
DB_MIGRATIONS_ON_START=true

#######################################################################
# 3) КЭШ/РЕЙТ-ЛИМИТЫ/СЕССИИ (Redis)
#######################################################################
REDIS_URL=redis://redis:6379/0
REDIS_TLS=false
CACHE_DEFAULT_TTL_SEC=300
CACHE_MAX_KEYS=100000

RATE_LIMIT_ENABLED=true
RATE_LIMIT_DEFAULT=100r/m
RATE_LIMIT_BURST=50
RATE_LIMIT_REDIS_PREFIX=ratelimit:omnimind

SESSION_ENABLED=false
SESSION_REDIS_URL=${REDIS_URL}
SESSION_TTL_SEC=3600

#######################################################################
# 4) ОЧЕРЕДИ/ФОН (Celery/RQ/Kafka)
#######################################################################
TASKS_ENABLED=true
TASKS_BACKEND=celery               # celery|rq|none
CELERY_BROKER_URL=redis://redis:6379/1
CELERY_RESULT_BACKEND=redis://redis:6379/2
CELERY_CONCURRENCY=8
CELERY_PREFETCH_MULT=4
CELERY_TASK_SOFT_TIME_LIMIT_SEC=60
CELERY_TASK_HARD_TIME_LIMIT_SEC=90
CELERY_TASK_ACKS_LATE=true
CELERY_WORKER_MAX_TASKS_PER_CHILD=1000

# Kafka (опционально)
KAFKA_ENABLED=false
KAFKA_BROKERS=kafka:9092
KAFKA_CLIENT_ID=omnimind-core
KAFKA_SECURITY_PROTOCOL=PLAINTEXT  # SASL_SSL|SSL|PLAINTEXT
KAFKA_SASL_MECHANISM=
KAFKA_SASL_USERNAME=
KAFKA_SASL_PASSWORD=

#######################################################################
# 5) БЕЗОПАСНОСТЬ, АУТЕНТИФИКАЦИЯ, RBAC
#######################################################################
# JWT/Access
JWT_ISSUER=omnimind
JWT_AUDIENCE=omnimind-clients
JWT_ALG=RS256
JWT_ACCESS_TTL_MIN=30
JWT_REFRESH_TTL_HR=720
# Вариант 1: пути к ключам (предпочтительно через Secret Manager / монтирование)
JWT_PRIVATE_KEY_PATH=/run/secrets/jwt/private.pem
JWT_PUBLIC_KEY_PATH=/run/secrets/jwt/public.pem
# Вариант 2: inline (не рекомендуем)
JWT_PRIVATE_KEY_PEM=
JWT_PUBLIC_KEY_PEM=

# Куки (если нужны)
COOKIE_SECURE=true
COOKIE_SAMESITE=Lax

# RBAC / Политики
RBAC_DEFAULT_ROLE=user
RBAC_ADMIN_ROLE=admin
RBAC_BOOTSTRAP_ADMIN_EMAIL=admin@CHANGE_ME
RBAC_BOOTSTRAP_ADMIN_PASSWORD=CHANGE_ME_STRONG
PASSWORD_POLICY_MIN_LENGTH=12
PASSWORD_POLICY_REQUIRE_SYMBOL=true
PASSWORD_POLICY_REQUIRE_DIGIT=true
PASSWORD_POLICY_REQUIRE_MIXED_CASE=true

# Вебхуки
WEBHOOK_SECRET=CHANGE_ME

#######################################################################
# 6) ВНЕШНИЕ ПРОВАЙДЕРЫ LLM / ВЕКТОРНЫЕ БАЗЫ / EMBEDDINGS
#######################################################################
# Роутинг по умолчанию
LLM_PROVIDER=local                 # local|openai|anthropic|gemini|cohere|azureopenai
LLM_MODEL_DEFAULT=llama-3-8b-instruct
LLM_MAX_TOKENS=2048
LLM_TEMPERATURE=0.2
LLM_TOP_P=0.95
LLM_TIMEOUT_SEC=60
LLM_SSE_ENABLED=true
LLM_SEED=42

# OpenAI/Azure
OPENAI_API_KEY=
OPENAI_BASE_URL=https://api.openai.com/v1
AZURE_OPENAI_ENDPOINT=
AZURE_OPENAI_API_KEY=
AZURE_OPENAI_DEPLOYMENT=

# Anthropic
ANTHROPIC_API_KEY=
ANTHROPIC_BASE_URL=https://api.anthropic.com

# Google Gemini
GEMINI_API_KEY=
GEMINI_BASE_URL=https://generativelanguage.googleapis.com

# Cohere
COHERE_API_KEY=

# Локальные рантаймы
OLLAMA_ENABLED=false
OLLAMA_BASE_URL=http://ollama:11434

VLLM_ENABLED=false
VLLM_BASE_URL=http://vllm:8000

# Embeddings
EMBED_PROVIDER=openai               # openai|hf|local
EMBED_MODEL=text-embedding-3-small
HF_TOKEN=

# Векторные БД
VSTORE_PROVIDER=pgvector            # pgvector|qdrant|milvus|chroma
PGVECTOR_SEARCH_SCHEMA=public
PGVECTOR_INDEX_TABLE=embeddings

QDRANT_URL=http://qdrant:6333
QDRANT_API_KEY=

MILVUS_URI=http://milvus:19530
MILVUS_USER=
MILVUS_PASSWORD=

#######################################################################
# 7) ФАЙЛЫ/ОБЪЕКТНОЕ ХРАНИЛИЩЕ (S3/MinIO)
#######################################################################
S3_ENABLED=true
S3_ENDPOINT=http://minio:9000
S3_REGION=us-east-1
S3_ACCESS_KEY_ID=CHANGE_ME
S3_SECRET_ACCESS_KEY=CHANGE_ME
S3_BUCKET=omnimind-data
S3_FORCE_PATH_STYLE=true

#######################################################################
# 8) СЕКРЕТ-МЕНЕДЖМЕНТ / KMS / ШИФРОВАНИЕ
#######################################################################
SECRET_MANAGER=env                 # env|vault|aws|gcp|azure
VAULT_ADDR=http://vault:8200
VAULT_TOKEN=
VAULT_NAMESPACE=
KMS_PROVIDER=none                  # none|aws|gcp|azure
FERNET_KEY=CHANGE_ME_32BYTES_BASE64
DATA_ENCRYPTION_ENABLED=true

#######################################################################
# 9) ПОЧТА/УВЕДОМЛЕНИЯ
#######################################################################
SMTP_ENABLED=false
SMTP_HOST=smtp
SMTP_PORT=587
SMTP_USER=no-reply@CHANGE_ME
SMTP_PASSWORD=CHANGE_ME
SMTP_TLS=true
EMAIL_FROM=no-reply@CHANGE_ME

#######################################################################
# 10) API ГРАНИЦЫ, ЗДОРОВЬЕ, BACKPRESSURE
#######################################################################
READINESS_LAG_SEC=5
LIVENESS_PATH=/healthz
READINESS_PATH=/readyz
STARTUP_PATH=/startup

# Лимиты бэкенда
MAX_REQUEST_BODY_MB=20
CONNECTION_LIMIT=1000
BACKPRESSURE_ENABLED=true
CIRCUIT_BREAKER_ENABLED=true
CIRCUIT_BREAKER_FAILURE_RATE=0.2
CIRCUIT_BREAKER_MIN_CALLS=50
CIRCUIT_BREAKER_OPEN_SEC=20

#######################################################################
# 11) ФИЧ-ФЛАГИ OMINIMD CORE
#######################################################################
FEATURE_CHAT=true
FEATURE_TOOLS=true
FEATURE_FUNCTION_CALLS=true
FEATURE_VISION=false
FEATURE_SPEECH=false
FEATURE_AGENTIC_WORKFLOWS=true
FEATURE_AUDIT_LOGS=true

#######################################################################
# 12) АУДИТ/СООТВЕТСТВИЕ/RETENTION
#######################################################################
AUDIT_ENABLED=true
AUDIT_SINK=db                     # db|s3|stdout
AUDIT_RETENTION_DAYS=90
PII_REDACTION_ENABLED=true
PII_REDACTION_MODE=strict         # strict|balanced|off
COMPLIANCE_GDPR=true
COMPLIANCE_CCPA=false

#######################################################################
# 13) СЕТЬ/ПРОКСИ/SECURITY HEADERS
#######################################################################
TRUSTED_PROXY=10.0.0.0/8,172.16.0.0/12,192.168.0.0/16
SECURITY_HEADERS=true
HSTS_ENABLED=true
HSTS_MAX_AGE=31536000
CONTENT_SECURITY_POLICY=default-src 'self'

#######################################################################
# 14) ВНУТРЕННИЕ СЕРВИСЫ/ШИНЫ
#######################################################################
INTERNAL_GATEWAY_URL=http://gateway:8080
OBSERVABILITY_URL=http://observability:3000
SECURITY_CORE_URL=http://platform-security-core:7000

#######################################################################
# 15) ДАННЫЕ/КАТАЛОГИ
#######################################################################
DATA_DIR=/var/lib/omnimind/data
TMP_DIR=/tmp/omnimind
MODELS_DIR=/var/lib/omnimind/models
LOG_DIR=/var/log/omnimind

#######################################################################
# 16) GPU/NUMA/BLAS ТЮНИНГ (ОПЦИОНАЛЬНО)
#######################################################################
CUDA_VISIBLE_DEVICES=0
OMP_NUM_THREADS=8
MKL_NUM_THREADS=8
INFERENCE_BATCH_SIZE=1
INFERENCE_MAX_CONCURRENCY=2

#######################################################################
# 17) ТЕСТЫ/ВААЛ
#######################################################################
E2E_TEST_USER_EMAIL=tester@CHANGE_ME
E2E_TEST_USER_PASSWORD=CHANGE_ME
SMOKE_TESTS_ENABLED=false
