# =============================================================================
# neuroforge-core :: .env.example
# =============================================================================
# ВНИМАНИЕ:
# 1) Не храните реальные секреты в VCS. Этот файл — только пример.
# 2) Для production установите ENVIRONMENT=production и заполните все CHANGEME_*.
# 3) Не используйте пробелы вокруг "=". Комментарии начинаются с "#".
# 4) Любые списки задавайте через запятую без пробелов, либо JSON-строкой.
# =============================================================================

# -----------------------------------------------------------------------------
# 0. Базовая идентичность и режим работы приложения
# -----------------------------------------------------------------------------
ENVIRONMENT=development            # development | staging | production
APP_NAME=neuroforge-core
APP_VERSION=0.1.0
APP_INSTANCE_ID=local-1           # уникальный идентификатор инстанса (для логов/трассировок)
TZ=UTC                            # системная тайм-зона процесса
PYTHONHASHSEED=0                  # для воспроизводимости в dev; уберите в prod или задайте случайно

# -----------------------------------------------------------------------------
# 1. HTTP/API сервер
# -----------------------------------------------------------------------------
HTTP_HOST=0.0.0.0
HTTP_PORT=8080
HTTP_WORKERS=4                    # uvicorn/gunicorn воркеры
HTTP_KEEPALIVE=75
HTTP_ACCESS_LOG=true
HTTP_REQUEST_TIMEOUT_SEC=120
HTTP_PROXY_HEADERS=false
CORS_ENABLED=true
CORS_ALLOWED_ORIGINS=http://localhost:3000,https://admin.example.com
CORS_ALLOWED_METHODS=GET,POST,PUT,PATCH,DELETE,OPTIONS
CORS_ALLOWED_HEADERS=Authorization,Content-Type,X-Request-Id
CORS_ALLOW_CREDENTIALS=false
RATE_LIMIT_ENABLED=true
RATE_LIMIT_REDIS_DSN=redis://localhost:6379/2
RATE_LIMIT_DEFAULT=100r/m         # 100 запросов в минуту по умолчанию

# -----------------------------------------------------------------------------
# 2. Аутентификация и авторизация
# -----------------------------------------------------------------------------
AUTH_MODE=jwt                     # jwt | oauth2 | mixed
JWT_ISSUER=https://auth.example.com
JWT_AUDIENCE=neuroforge
JWT_ALG=RS256
JWT_PUBLIC_KEY_PEM_B64=CHANGEME_BASE64_PEM   # base64 от публичного ключа (prod)
JWT_PRIVATE_KEY_PEM_B64=CHANGEME_BASE64_PEM  # base64 от приватного ключа (только если требуется подпись)
JWT_ACCESS_TTL_MIN=15
JWT_REFRESH_TTL_DAYS=30

# OAuth2 (опционально)
OAUTH_GOOGLE_CLIENT_ID=CHANGEME_GOOGLE_ID
OAUTH_GOOGLE_CLIENT_SECRET=CHANGEME_GOOGLE_SECRET
OAUTH_REDIRECT_URI=https://api.example.com/oauth/callback

# -----------------------------------------------------------------------------
# 3. Хранилище данных: PostgreSQL
# -----------------------------------------------------------------------------
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=neuroforge
POSTGRES_USER=neuroforge
POSTGRES_PASSWORD=CHANGEME_DB_PASSWORD
POSTGRES_SSLMODE=prefer          # disable | prefer | require | verify-ca | verify-full
POSTGRES_CONN_MAX_AGE_SEC=300
POSTGRES_POOL_MIN=5
POSTGRES_POOL_MAX=50
POSTGRES_STATEMENT_TIMEOUT_MS=60000
POSTGRES_DSN=postgresql://neuroforge:CHANGEME_DB_PASSWORD@localhost:5432/neuroforge?sslmode=prefer

# Опционально: pgvector / векторный поиск
PGVECTOR_ENABLED=false
PGVECTOR_EXT_SCHEMA=public

# -----------------------------------------------------------------------------
# 4. Кэш и фоновые блокировки: Redis
# -----------------------------------------------------------------------------
REDIS_DSN=redis://localhost:6379/1
REDIS_SSL=false
REDIS_PASSWORD=
REDIS_SOCKET_TIMEOUT_SEC=5
REDIS_POOL_MAXSIZE=200

# -----------------------------------------------------------------------------
# 5. Очереди задач и планировщики
# -----------------------------------------------------------------------------
QUEUE_BACKEND=celery              # celery | rq | none
CELERY_BROKER_URL=redis://localhost:6379/3
CELERY_RESULT_BACKEND=redis://localhost:6379/4
CELERY_TASK_SOFT_TIME_LIMIT_SEC=300
CELERY_TASK_TIME_LIMIT_SEC=360
CELERY_WORKERS=4
SCHEDULE_ENABLED=true
SCHEDULE_TZ=UTC

# -----------------------------------------------------------------------------
# 6. Объектные хранилища (артефакты, датасеты, модели)
# -----------------------------------------------------------------------------
# 6.1 S3-совместимое хранилище
S3_ENABLED=true
S3_ENDPOINT=https://s3.amazonaws.com
S3_REGION=us-east-1
S3_ACCESS_KEY_ID=CHANGEME_S3_KEY
S3_SECRET_ACCESS_KEY=CHANGEME_S3_SECRET
S3_BUCKET_ARTIFACTS=neuroforge-artifacts
S3_BUCKET_DATASETS=neuroforge-datasets
S3_BUCKET_MODELS=neuroforge-models
S3_SSE=aws:kms                     # пусто | AES256 | aws:kms
S3_KMS_KEY_ID=CHANGEME_KMS_KEYID   # требуется если S3_SSE=aws:kms

# 6.2 GCS / BigQuery (опционально)
GCP_PROJECT_ID=your-gcp-project
GCS_BUCKET_MODELS=neuroforge-models
GCS_BUCKET_ARTIFACTS=neuroforge-artifacts
GOOGLE_APPLICATION_CREDENTIALS=/secrets/gcp.json
BQ_PROJECT_ID=your-gcp-project
BQ_DATASET=neuroforge
BQ_LOCATION=EU
BQ_USE_CMEK=false
BQ_KMS_KEY_NAME=
BQ_REQUIRE_PARTITION_FILTER=true

# -----------------------------------------------------------------------------
# 7. Логи и наблюдаемость
# -----------------------------------------------------------------------------
LOG_LEVEL=INFO                    # DEBUG | INFO | WARNING | ERROR
LOG_FORMAT=json                   # json | text
LOG_SAMPLING_ENABLED=true
LOG_SAMPLING_RATE=0.1             # 0..1

# OpenTelemetry
OTEL_ENABLED=true
OTEL_SERVICE_NAME=neuroforge-core
OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4318
OTEL_EXPORTER_OTLP_PROTOCOL=http/protobuf
OTEL_RESOURCE_ATTRIBUTES=deployment.environment=${ENVIRONMENT},service.version=${APP_VERSION}
OTEL_TRACES_SAMPLER=parentbased_traceidratio
OTEL_TRACES_SAMPLER_ARG=0.10

# Sentry (опционально)
SENTRY_DSN=
SENTRY_ENV=${ENVIRONMENT}
SENTRY_TRACES_SAMPLE_RATE=0.1

# Prometheus (если есть экспортер)
PROMETHEUS_ENABLED=true
PROMETHEUS_SCRAPE_PATH=/metrics

# -----------------------------------------------------------------------------
# 8. Почта и уведомления
# -----------------------------------------------------------------------------
SMTP_ENABLED=false
SMTP_HOST=smtp.example.com
SMTP_PORT=587
SMTP_USERNAME=CHANGEME_SMTP_USER
SMTP_PASSWORD=CHANGEME_SMTP_PASS
SMTP_STARTTLS=true
NOTIFY_EMAIL_FROM=noreply@example.com

# -----------------------------------------------------------------------------
# 9. Безопасность и политика платформы
# -----------------------------------------------------------------------------
SECURITY_HEADERS_ENABLED=true
ALLOW_EMBED=false
CSP_DEFAULT_SRC='self'
CSRF_ENABLED=true
CSRF_SECRET=CHANGEME_CSRF_SECRET
SESSION_COOKIE_SECURE=true
SESSION_COOKIE_SAMESITE=Strict

# API ключи (если используются)
API_KEYS_HMAC_SECRET=CHANGEME_HMAC_SECRET
API_KEYS_ROTATION_DAYS=90

# -----------------------------------------------------------------------------
# 10. Комплаенс и аудит
# -----------------------------------------------------------------------------
COMPLIANCE_MODE=gdpr              # none | gdpr | hipaa | sox
DATA_RETENTION_DAYS=365
DATA_RETENTION_MAX_TTL_DAYS=730
LEGAL_HOLD_FEATURE=true

# Аудит (совместимо с oblivionvault-подходом, при наличии интеграции)
AUDIT_ENABLED=true
AUDIT_TO_BQ=false
AUDIT_STATE_PATH=/var/lib/neuroforge/audit_state.json
AUDIT_HMAC_KEY_ID=
AUDIT_HMAC_KEY_B64=               # base64 ключа для HMAC
AUDIT_DATASET=neuroforge
AUDIT_TABLE=audit_events

# Evidence bundles (если необходимо собирать доказательства процессов)
EVIDENCE_ENABLE=true
EVIDENCE_BASE_DIR=/var/lib/neuroforge/evidence

# -----------------------------------------------------------------------------
# 11. ML/инференс и хранение моделей
# -----------------------------------------------------------------------------
MODEL_STORE_BACKEND=s3            # s3 | gcs | local
MODEL_STORE_LOCAL_DIR=./var/models
MODEL_CACHE_DIR=./var/model-cache
ALLOW_MODEL_AUTOLOAD=true
MAX_CONCURRENT_INFER=4
INFER_REQUEST_TIMEOUT_SEC=120

# Torch/Accelerators
TORCH_NUM_THREADS=4
CUDA_VISIBLE_DEVICES=0            # пусто для CPU
PYTORCH_ENABLE_MPS_FALLBACK=false

# HuggingFace/Transformers
HF_HOME=./var/hf
TRANSFORMERS_CACHE=./var/hf/transformers
HF_TOKEN=CHANGEME_HF_TOKEN

# -----------------------------------------------------------------------------
# 12. Векторные БД / поиск (опционально)
# -----------------------------------------------------------------------------
VECTOR_BACKEND=none               # none | qdrant | milvus | pgvector
QDRANT_URL=http://localhost:6333
QDRANT_API_KEY=CHANGEME_QDRANT
MILVUS_URI=http://localhost:19530
MILVUS_USER=
MILVUS_PASSWORD=

# -----------------------------------------------------------------------------
# 13. Сообщения/стриминг (опционально)
# -----------------------------------------------------------------------------
KAFKA_ENABLED=false
KAFKA_BROKERS=localhost:9092
KAFKA_SECURITY_PROTOCOL=PLAINTEXT  # SASL_SSL | SSL | PLAINTEXT
KAFKA_SASL_MECHANISM=
KAFKA_SASL_USERNAME=
KAFKA_SASL_PASSWORD=
KAFKA_CLIENT_ID=neuroforge-core
KAFKA_TOPIC_EVENTS=neuroforge.events

# -----------------------------------------------------------------------------
# 14. Функции разработки (не включайте в production)
# -----------------------------------------------------------------------------
DEBUG_TOOLBAR=false
AUTO_MIGRATE_DB=false
SEED_DEMO_DATA=false
ALLOW_OPEN_API_DOCS=true          # выключите в production, если требуется
MOCK_EXTERNAL_INTEGRATIONS=false

# -----------------------------------------------------------------------------
# 15. Секреты для локальной разработки (заполните значениями или используйте .env.local)
# -----------------------------------------------------------------------------
DEV_ADMIN_EMAIL=dev-admin@example.com
DEV_ADMIN_PASSWORD=CHANGEME_DEV_PASS

# -----------------------------------------------------------------------------
# 16. Резервные пути и директории
# -----------------------------------------------------------------------------
VAR_DIR=./var
TMP_DIR=./var/tmp
LOG_DIR=./var/log
RUN_DIR=./var/run
