apiVersion: monitoring.coreos.com/v1
kind: Prometheus
metadata:
  name: teslaai-prometheus
  namespace: monitoring
  labels:
    app.kubernetes.io/name: prometheus
    app.kubernetes.io/part-of: teslaai
    zero-trust: enforced
    version: v20x-industrial
spec:
  replicas: 2
  serviceAccountName: prometheus-sa
  serviceMonitorSelector:
    matchExpressions:
      - key: monitoring.teslaai.io/enabled
        operator: In
        values:
          - "true"
  podMonitorSelector:
    matchLabels:
      monitoring: enabled
  resources:
    requests:
      memory: 1Gi
      cpu: 500m
    limits:
      memory: 4Gi
      cpu: 2000m
  enableAdminAPI: false
  securityContext:
    runAsNonRoot: true
    runAsUser: 65534
    fsGroup: 65534
  retention: 30d
  storage:
    volumeClaimTemplate:
      spec:
        accessModes: ["ReadWriteOnce"]
        resources:
          requests:
            storage: 100Gi
  alerting:
    alertmanagers:
      - namespace: monitoring
        name: alertmanager-main
        port: web
  externalLabels:
    cluster: teslaai-genesis
    env: production
  additionalScrapeConfigs:
    name: prometheus-additional-scrape
    key: prometheus-additional.yaml
