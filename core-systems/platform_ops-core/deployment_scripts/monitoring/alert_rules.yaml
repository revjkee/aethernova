groups:
  - name: general.rules
    rules:
      - alert: InstanceDown
        expr: up == 0
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "Инстанс {{ $labels.instance }} недоступен"
          description: "Проблема с инстансом {{ $labels.instance }} в течение последних 5 минут."

      - alert: HighCPUUsage
        expr: rate(process_cpu_seconds_total[1m]) > 0.85
        for: 3m
        labels:
          severity: warning
        annotations:
          summary: "Высокая загрузка CPU на {{ $labels.instance }}"
          description: "CPU загружен более 85% за последние 3 минуты."

      - alert: HighMemoryUsage
        expr: process_resident_memory_bytes > 500 * 1024 * 1024
        for: 3m
        labels:
          severity: warning
        annotations:
          summary: "Высокое потребление памяти на {{ $labels.instance }}"
          description: "Память превышает 500 МБ более 3 минут."

      - alert: KubePodCrashLooping
        expr: rate(kube_pod_container_status_restarts_total[5m]) > 0
        for: 10m
        labels:
          severity: critical
        annotations:
          summary: "Pod {{ $labels.pod }} в namespace {{ $labels.namespace }} в цикле перезапуска"
          description: "Под перезапускается более 0 раз за 10 минут."

      - alert: NodeDiskRunningOut
        expr: (node_filesystem_avail_bytes{mountpoint="/"} / node_filesystem_size_bytes{mountpoint="/"}) < 0.1
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "Недостаточно свободного места на диске на узле {{ $labels.instance }}"
          description: "Свободное место на корневом разделе менее 10%."

      - alert: PrometheusTargetDown
        expr: up{job="prometheus"} == 0
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "Prometheus не может достучаться до таргета"
          description: "Проблемы с мониторингом, таргет недоступен."

