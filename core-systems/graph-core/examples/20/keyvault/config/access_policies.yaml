# === TeslaAI Access Policy Matrix v2.8 ===
# Combines RBAC + ABAC + Contextual Intents + MetaConstraints
# Validated by Evolver, Architectus, Guardian and 20 AI Agents

roles:
  - id: superadmin
    description: Полный доступ ко всем ключам, конфигурациям, журналам
    permissions:
      - "*"
    constraints:
      - "context.zone in ['core', 'secure']"
      - "intent.validated == true"
      - "entropy_score >= 0.85"
      - "threat_score < 0.3"

  - id: vault_admin
    description: Управление хранилищем ключей и провайдерами
    permissions:
      - "key:create"
      - "key:delete"
      - "key:rotate"
      - "provider:reload"
    constraints:
      - "context.device_trusted == true"
      - "intent.category in ['maintenance', 'rotation']"

  - id: analyst_readonly
    description: Только чтение ключей и логов аудита
    permissions:
      - "key:read"
      - "audit:read"
    constraints:
      - "user.level >= 3"
      - "intent.purpose == 'investigation'"
      - "context.ip_reputation == 'clean'"

  - id: service_agent
    description: Агентская роль с автоматическим получением временных ключей
    permissions:
      - "key:read"
    constraints:
      - "agent.identity_verified == true"
      - "context.time < '23:00'"
      - "intent.verified == true"

  - id: external_auditor
    description: Внешняя аудит-роль (по ZK или сессии)
    permissions:
      - "audit:read"
    constraints:
      - "zk_proof.verified == true"
      - "intent.category == 'audit'"
      - "context.hash_signed == true"

attributes:
  - key: user.level
    type: integer
    description: Уровень доверия пользователя (1–5)

  - key: context.zone
    type: enum
    values: [core, edge, secure, external]

  - key: context.device_trusted
    type: boolean

  - key: intent.category
    type: enum
    values: [read, rotate, audit, maintenance]

  - key: intent.purpose
    type: string

  - key: context.ip_reputation
    type: enum
    values: [clean, suspicious, unknown]

  - key: threat_score
    type: float
    range: [0.0, 1.0]

  - key: entropy_score
    type: float
    range: [0.0, 1.0]

  - key: zk_proof.verified
    type: boolean

meta:
  enforcement_engine: "agent_intent_verifier + context_fingerprint + zk_proof"
  fallback_mode: "read-only with quorum approval"
  policy_version: "2.8.0"
  reviewed_by: ["MetaGeneral:Architectus", "Guardian", "Evolver"]
