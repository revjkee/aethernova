# fail_injection.yaml
# Описание сценариев симуляции сбоев для тестирования DR-процедур

metadata:
  version: 1.0
  author: TeslaAI Genesis Recovery Core
  description: >
    Набор заранее определённых катастроф и условий отказа,
    предназначенных для симуляции и верификации плана восстановления.

scenarios:

  - id: disk_corruption
    description: Искажение данных в файловой системе PostgreSQL
    affected_components:
      - postgres
    inject:
      type: file_corruption
      target: /var/lib/postgresql/data
      pattern: ".*\\.db"
    expected_response:
      - trigger: integrity_verifier
      - reaction: alert + auto_restore
      - fallback: switch_to_replica

  - id: redis_crash_loop
    description: Redis уходит в цикл рестартов из-за неправильной конфигурации
    affected_components:
      - redis
    inject:
      type: config_tamper
      file: redis.conf
      tamper: "maxmemory 0"
    expected_response:
      - trigger: ai_healthcheck
      - reaction: notify_ops + revert_config
      - fallback: spin_backup_instance

  - id: graph_runtime_halt
    description: Заморозка ядра графовой БД из-за утечки памяти
    affected_components:
      - graph_core
    inject:
      type: resource_overload
      cpu: 90
      memory: 95
    expected_response:
      - trigger: ai_state_log_monitor
      - reaction: isolate_node + soft_restart
      - fallback: notify_genesis_flag

  - id: ai_agent_loop
    description: Один из агентов зациклился и блокирует очередь
    affected_components:
      - ai-platform
    inject:
      type: infinite_loop
      agent: strategy_executor.py
    expected_response:
      - trigger: inhibitors_checkpoint
      - reaction: auto_throttle + warn_admin

notes:
  - Все сценарии валидируются через `integrity_verifier.py`
  - Использовать только в безопасной среде (airgap или test-net)
  - Каждый сценарий привязан к конкретной метрике восстановления

