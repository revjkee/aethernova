# ci/chaos-testing/fault_injection_v2.yaml

apiVersion: litmuschaos.io/v1alpha1
kind: ChaosEngine
metadata:
  name: teslaai-fault-injection
  namespace: chaos-testing
spec:
  annotationCheck: "false"
  engineState: "active"
  appinfo:
    appns: "default"
    applabel: "app=teslaai-core"
    appkind: "deployment"
  chaosServiceAccount: litmus-admin
  monitoring: true
  jobCleanUpPolicy: retain
  experiments:
    - name: pod-network-loss
      spec:
        components:
          env:
            - name: TOTAL_CHAOS_DURATION
              value: "60"
            - name: NETWORK_INTERFACE
              value: "eth0"
            - name: PERCENTAGE_PACKET_LOSS
              value: "100"

    - name: pod-cpu-hog
      spec:
        components:
          env:
            - name: CPU_CORES
              value: "2"
            - name: TOTAL_CHAOS_DURATION
              value: "90"

    - name: pod-memory-hog
      spec:
        components:
          env:
            - name: MEMORY_CONSUMPTION
              value: "500Mi"
            - name: TOTAL_CHAOS_DURATION
              value: "120"

    - name: container-kill
      spec:
        components:
          env:
            - name: TARGET_CONTAINER
              value: "teslaai-api"
            - name: TOTAL_CHAOS_DURATION
              value: "60"

    - name: pod-delete
      spec:
        components:
          env:
            - name: FORCE
              value: "true"
            - name: CHAOS_INTERVAL
              value: "60"
            - name: PODS_AFFECTED_PERC
              value: "50"

    - name: disk-fill
      spec:
        components:
          env:
            - name: FILL_PATH
              value: "/tmp"
            - name: STORAGE_CONSUMPTION
              value: "1Gi"
            - name: TOTAL_CHAOS_DURATION
              value: "120"

    - name: pod-io-stress
      spec:
        components:
          env:
            - name: TOTAL_CHAOS_DURATION
              value: "90"
            - name: FILESYSTEM_UTILIZATION_PERCENTAGE
              value: "80"

    - name: network-latency
      spec:
        components:
          env:
            - name: LATENCY
              value: "3000"
            - name: TOTAL_CHAOS_DURATION
              value: "60"
            - name: NETWORK_INTERFACE
              value: "eth0"
            - name: DESTINATION_IPS
              value: "8.8.8.8"

    - name: node-drain
      spec:
        components:
          env:
            - name: NODE_LABEL
              value: "chaos=true"
            - name: TOTAL_CHAOS_DURATION
              value: "60"

    - name: node-cpu-hog
      spec:
        components:
          env:
            - name: CPU_CORES
              value: "4"
            - name: TOTAL_CHAOS_DURATION
              value: "60"

    - name: node-memory-hog
      spec:
        components:
          env:
            - name: MEMORY_CONSUMPTION
              value: "1Gi"
            - name: TOTAL_CHAOS_DURATION
              value: "60"

    - name: time-skew
      spec:
        components:
          env:
            - name: SKEW_TIME
              value: "120"
            - name: TOTAL_CHAOS_DURATION
              value: "60"

    - name: stress-ng
      spec:
        components:
          env:
            - name: STRESSORS
              value: "cpu:2,vm:2,hdd:1"
            - name: STRESS_DURATION
              value: "120"
