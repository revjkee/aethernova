# llmops/monitoring/alerting_rules.yaml

groups:
  - name: llmops_alerts
    rules:
      # Триггер при увеличении средней задержки ответа LLM выше порога 500ms за последние 5 минут
      - alert: HighLLMLatency
        expr: avg_over_time(llmops_latency_seconds[5m]) > 0.5
        for: 5m
        labels:
          severity: critical
          team: llmops
        annotations:
          summary: "Высокая задержка ответа LLM"
          description: "Средняя задержка за последние 5 минут превышает 500 миллисекунд."

      # Триггер при резком росте ошибок в логах (больше 10 ошибок за 5 минут)
      - alert: SpikeInErrorLogs
        expr: increase(llmops_error_logs_total[5m]) > 10
        for: 2m
        labels:
          severity: high
          team: llmops
        annotations:
          summary: "Резкий рост ошибок в логах"
          description: "За последние 5 минут количество ошибок превысило 10."

      # Триггер при превышении использования токенов (больше 90% лимита)
      - alert: HighTokenUsage
        expr: (llmops_token_usage_total / llmops_token_limit) > 0.9
        for: 10m
        labels:
          severity: warning
          team: llmops
        annotations:
          summary: "Высокое использование токенов"
          description: "Использование токенов превысило 90% от лимита за последние 10 минут."

      # Триггер на падение доступности сервиса ниже 99.5% за 30 минут
      - alert: ServiceAvailabilityDrop
        expr: avg_over_time(llmops_service_availability[30m]) < 0.995
        for: 10m
        labels:
          severity: critical
          team: llmops
        annotations:
          summary: "Падение доступности сервиса"
          description: "Доступность сервиса упала ниже 99.5% за последние 30 минут."

      # Триггер на увеличение количества галлюцинаций модели (больше 5 за 10 минут)
      - alert: IncreasedHallucinations
        expr: increase(llmops_hallucinations_total[10m]) > 5
        for: 5m
        labels:
          severity: high
          team: llmops
        annotations:
          summary: "Увеличение количества галлюцинаций"
          description: "Количество ложных ответов (галлюцинаций) модели превышает 5 за последние 10 минут."

# Конец файла
