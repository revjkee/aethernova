# ========================================================================
# access_matrix.yaml — Ролевая матрица доступа к исходному коду проекта
# Модуль: platform-security/code-protection/rbac_integrity/
# Уровень: CLASS-ZERO-CODE-TRUST | Проверено: 20 агентов, 3 генерала
# ========================================================================

roles:
  - id: OWNER
    description: Полный доступ ко всем репозиториям, ключам, конфигурации
    permissions:
      - read_all
      - write_all
      - approve_rbac
      - override_ci
      - rotate_keys
      - access_logs
      - decrypt_assets
    constraints:
      - mfa_required
      - signed_commits
      - gpg_enforced

  - id: SECURITY_AUDITOR
    description: Проверка RBAC, логов, целостности, детект утечек
    permissions:
      - read_all
      - access_logs
      - audit_integrity
      - run_leak_scanner
    constraints:
      - readonly_mode
      - pgp_verified_key

  - id: CORE_DEVELOPER
    description: Разработка доверенных модулей и критических библиотек
    permissions:
      - read_code
      - write_core
      - push_signed_commits
      - run_tests
    constraints:
      - must_pass_static_analysis
      - code_owner_review_required
      - write_limited_to: ["backend/", "ai-core/", "anon-core/"]

  - id: CONTRIBUTOR
    description: Внешние участники, предлагающие код
    permissions:
      - read_code
      - submit_mr
      - comment
    constraints:
      - no_direct_write
      - code_owner_approval_required
      - sandbox_ci_only

  - id: CI_BOT
    description: Автоматизация CI/CD, тестов и сборок
    permissions:
      - read_code
      - run_pipeline
      - post_status
      - update_build_artifacts
    constraints:
      - no_write_to_src
      - isolated_environment
      - checksum_validation_required

  - id: DOCS_WRITER
    description: Доступ только к документации и wiki
    permissions:
      - read_docs
      - write_docs
    constraints:
      - doc_scope_only

resources:
  - id: backend/
    access: [OWNER, CORE_DEVELOPER, CI_BOT]

  - id: anon-core/
    access: [OWNER, CORE_DEVELOPER, SECURITY_AUDITOR]

  - id: docs/
    access: [OWNER, DOCS_WRITER, CONTRIBUTOR]

  - id: infrastructure/
    access: [OWNER, SECURITY_AUDITOR]

  - id: tests/
    access: [OWNER, CORE_DEVELOPER, CI_BOT]

compliance:
  - all_changes_must_be_signed: true
  - minimum_reviewers: 2
  - code_integrity_verification: enabled
  - forbidden_operations:
      - git push --force
      - editing logs manually
      - CI override without OWNER role

