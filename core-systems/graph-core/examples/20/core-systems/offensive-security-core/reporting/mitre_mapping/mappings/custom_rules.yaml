version: 1.0
source: TeslaAI-ThreatIntel-v7
description: >
  Правила сопоставления активности с матрицей MITRE ATT&CK.
  Используется для классификации угроз, оценки рисков и AI-реакции на инциденты.

rules:
  - id: rule_001
    name: "Remote SMB Exploit Detection"
    condition: all
    match:
      - indicators:
          - smb/pipe/srvsvc
          - ms17_010
          - port: 445
      - cve_ids:
          - CVE-2017-0144
      - technique:
          id: T1133
          name: External Remote Services
      - risk_score: high
    response:
      priority: critical
      ai_flag: escalate
      auto_isolate: true
      notify: SOC,AI-Core
      tags: [EternalBlue, RemoteAccess, LateralMovement]

  - id: rule_002
    name: "Web Shell via File Upload"
    condition: any
    match:
      - file_extension: .jsp
      - url_patterns:
          - "*manager/html"
      - technique:
          id: T1505.003
          name: Web Shell
    response:
      priority: medium
      ai_flag: observe
      auto_isolate: false
      notify: AI-Core
      tags: [Tomcat, Persistence]

  - id: rule_003
    name: "Reconnaissance via Masscan"
    condition: all
    match:
      - process_name: masscan
      - flags:
          - --rate
          - -p
      - technique:
          id: T1595
          name: Active Scanning
    response:
      priority: low
      ai_flag: log_only
      auto_isolate: false
      notify: AI-Sensor
      tags: [Recon, PortScan]

  - id: rule_004
    name: "AI Signature Drift Detection"
    condition: all
    match:
      - ai_behavior: deviation
      - source: LLM-Agent
      - signal_variance: >3σ
    response:
      priority: critical
      ai_flag: quarantine_ai
      auto_isolate: true
      notify: Governance, MetaGen
      tags: [AI-Drift, LLM, Anomaly]

  - id: rule_005
    name: "Zero-Day Behavior via Exploit Pattern"
    condition: all
    match:
      - unknown_cve: true
      - behavior_pattern:
          - privilege_escalation
          - process_injection
      - technique:
          id: T1068
          name: Exploitation for Privilege Escalation
    response:
      priority: critical
      ai_flag: anomaly_track
      auto_isolate: true
      notify: IntelHub, SOC
      tags: [ZeroDay, Exploitation, Escalation]
