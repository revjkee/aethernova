#!/bin/bash
# Industrial-Grade Host Reconnaissance Script (RedTeam Edition)

OUTPUT="/tmp/host_recon_$(hostname)_$(date +%Y%m%d%H%M%S).log"

echo "[*] Host Recon started at $(date)" | tee -a "$OUTPUT"
echo "-----------------------------" | tee -a "$OUTPUT"

function section() {
    echo -e "\n[+] $1" | tee -a "$OUTPUT"
    echo "-----------------------------" | tee -a "$OUTPUT"
}

section "Hostname and Kernel Info"
uname -a 2>/dev/null | tee -a "$OUTPUT"
hostnamectl 2>/dev/null | tee -a "$OUTPUT"

section "User Information"
whoami 2>/dev/null | tee -a "$OUTPUT"
id 2>/dev/null | tee -a "$OUTPUT"
who 2>/dev/null | tee -a "$OUTPUT"
lastlog 2>/dev/null | head -n 10 | tee -a "$OUTPUT"

section "OS Version and Distribution"
cat /etc/*release 2>/dev/null | tee -a "$OUTPUT"

section "Running Processes (Top 10)"
ps aux --sort=-%mem | head -n 15 2>/dev/null | tee -a "$OUTPUT"

section "Network Configuration"
ip addr show 2>/dev/null | tee -a "$OUTPUT"
ip route show 2>/dev/null | tee -a "$OUTPUT"
cat /etc/resolv.conf 2>/dev/null | tee -a "$OUTPUT"

section "Open Ports (ss + netstat fallback)"
ss -tulnp 2>/dev/null || netstat -tulnp 2>/dev/null | tee -a "$OUTPUT"

section "Logged-in Users and SSH Sessions"
w 2>/dev/null | tee -a "$OUTPUT"
who -a 2>/dev/null | tee -a "$OUTPUT"
grep "sshd" /var/log/auth.log 2>/dev/null | tail -n 15 | tee -a "$OUTPUT"

section "Scheduled Tasks"
crontab -l 2>/dev/null | tee -a "$OUTPUT"
ls -la /etc/cron* 2>/dev/null | tee -a "$OUTPUT"

section "Mounted Drives and Filesystems"
df -h 2>/dev/null | tee -a "$OUTPUT"
mount 2>/dev/null | tee -a "$OUTPUT"

section "Recent Sudo and Auth Logs"
grep "sudo" /var/log/auth.log 2>/dev/null | tail -n 20 | tee -a "$OUTPUT"
grep "session opened" /var/log/auth.log 2>/dev/null | tail -n 20 | tee -a "$OUTPUT"

section "Known SSH Keys"
find /home -name "authorized_keys" 2>/dev/null | tee -a "$OUTPUT"
find /root -name "authorized_keys" 2>/dev/null | tee -a "$OUTPUT"

section "Security Binaries & Detection Surface"
which curl wget python nc perl gcc socat nmap 2>/dev/null | tee -a "$OUTPUT"
ls -la /usr/sbin /sbin 2>/dev/null | grep -E 'tcpdump|iptables|auditctl|firewalld' | tee -a "$OUTPUT"

section "Recent Files Modified (last 48h)"
find /etc /var /home -type f -mtime -2 2>/dev/null | head -n 25 | tee -a "$OUTPUT"

section "Potential Credential Files"
find /home /root -type f \( -iname "*.kdbx" -o -iname "*.txt" -o -iname "*.json" -o -iname "*cred*" \) 2>/dev/null | tee -a "$OUTPUT"

echo "[*] Recon Complete. Output saved to $OUTPUT"
