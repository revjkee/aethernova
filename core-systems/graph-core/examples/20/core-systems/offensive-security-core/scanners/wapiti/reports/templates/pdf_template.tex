\documentclass[a4paper,12pt]{article}
\usepackage[utf8]{inputenc}
\usepackage[russian]{babel}
\usepackage{geometry}
\usepackage{longtable}
\usepackage{hyperref}
\usepackage{xcolor}
\usepackage{fancyhdr}
\usepackage{titlesec}
\usepackage{tcolorbox}
\usepackage{listings}
\usepackage{amsmath}

\geometry{left=2.5cm,right=2.5cm,top=3cm,bottom=3cm}

% Заголовки секций с цветом
\titleformat{\section}{\normalfont\Large\bfseries\color{blue}}{\thesection}{1em}{}
\titleformat{\subsection}{\normalfont\large\bfseries\color{cyan!70!black}}{\thesubsection}{1em}{}

% Колонтитулы
\pagestyle{fancy}
\fancyhf{}
\fancyhead[L]{Отчёт Wapiti}
\fancyhead[R]{\leftmark}
\fancyfoot[C]{\thepage}

% Определение цветов для уровней уязвимостей
\newcommand{\severitycolor}[1]{%
  \ifnum#1=1 \color{green} % Низкий
  \else\ifnum#1=2 \color{orange} % Средний
  \else \color{red} % Высокий
  \fi\fi
}

% Бокс для описания уязвимости
\newtcolorbox{vulnbox}[1][]{
  colframe=blue!75!black,
  colback=blue!5!white,
  coltitle=black,
  fonttitle=\bfseries,
  sharp corners,
  enhanced,
  attach boxed title to top left={yshift=-2mm,xshift=5mm},
  boxed title style={size=small,colframe=blue!75!black},
  title=Уязвимость,
  #1
}

\begin{document}

\begin{center}
    {\LARGE \textbf{Отчёт о сканировании Wapiti}}\\[1em]
    {\large Цель: \texttt{\detokenize{ {{ scan_info.target }} }}}\\
    {\large Начало сканирования: \texttt{\detokenize{ {{ scan_info.start_time }} }}}\\
    {\large Окончание сканирования: \texttt{\detokenize{ {{ scan_info.end_time }} }}}\\
    {\large Версия Wapiti: \texttt{\detokenize{ {{ scan_info.version }} }}}\\[2em]
\end{center}

\section*{Общие сведения}

\begin{itemize}
    \item Цель сканирования: \texttt{\detokenize{ {{ scan_info.target }} }}
    \item Дата начала: \texttt{\detokenize{ {{ scan_info.start_time }} }}
    \item Дата окончания: \texttt{\detokenize{ {{ scan_info.end_time }} }}
    \item Версия Wapiti: \texttt{\detokenize{ {{ scan_info.version }} }}
\end{itemize}

\section*{Обнаруженные уязвимости}

{% if vulnerabilities and vulnerabilities|length > 0 %}
\begin{longtable}{|p{3cm}|p{1.5cm}|p{8cm}|p{4cm}|}
\hline
\textbf{Имя} & \textbf{Уровень} & \textbf{Описание} & \textbf{URL} \\
\hline
\endhead

{% for vuln in vulnerabilities %}
\severitycolor{{ vuln.severity_num }}%
{{ vuln.name }} & 
\ifnum {{ vuln.severity_num }}=1 Низкий \else \ifnum {{ vuln.severity_num }}=2 Средний \else Высокий \fi \fi & 
\detokenize{ {{ vuln.description }} } & 
\url{\detokenize{ {{ vuln.url }} }} \\
\hline
{% endfor %}

\end{longtable}

\section*{Детали уязвимостей}

{% for vuln in vulnerabilities %}
\begin{vulnbox}[title={{ vuln.name }} -- {{ vuln.severity }}]
\textbf{URL:} \url{\detokenize{ {{ vuln.url }} }}\\
\textbf{Параметры:} \detokenize{ {{ vuln.parameter }} }\\
\textbf{Описание:}\\
\detokenize{ {{ vuln.details }} }
\end{vulnbox}

\vspace{1em}
{% endfor %}

{% else %}
\textbf{Уязвимости не обнаружены.}
{% endif %}

\section*{Завершение отчёта}

\begin{center}
    Отчёт сгенерирован автоматически с помощью Wapiti -- сканера уязвимостей веб-приложений.
\end{center}

\end{document}
