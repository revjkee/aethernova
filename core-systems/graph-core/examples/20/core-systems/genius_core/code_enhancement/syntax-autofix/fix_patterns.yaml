# /genius-core/code-enhancement/syntax-autofix/fix_patterns.yaml

# Паттерны автоматических исправлений синтаксиса и стиля кода
# Используются для обнаружения типичных ошибок и быстрого их исправления
# с целью повышения качества и стандартизации кода.

fix_patterns:
  - id: missing_colon
    description: Исправление отсутствующих двоеточий после заголовков блоков (if, for, while, def, class)
    pattern: '^(.*(if|for|while|def|class).*)[^:]$'
    fix: '{line}: добавлен двоеточие в конце'
    apply:
      - insert: ':'
        position: end_of_line

  - id: incorrect_indentation
    description: Исправление неправильных отступов (смешение пробелов и табуляций)
    pattern: '^\t+.*'
    fix: 'замена табуляций на 4 пробела'
    apply:
      - replace_tabs_with_spaces: 4

  - id: trailing_whitespace
    description: Удаление пробелов в конце строк
    pattern: '\s+$'
    fix: 'удалены пробелы в конце строки'
    apply:
      - remove_trailing_whitespace

  - id: missing_imports
    description: Автоматическое добавление недостающих импортов для стандартных функций (print, open и др.)
    pattern: '.*(print|open|range|len)\('
    fix: 'проверка и добавление импортов, если нужно'
    apply:
      - add_import_if_missing:
          modules:
            - builtins

  - id: double_equals_in_condition
    description: Замена оператора сравнения "==" на "is" или наоборот в зависимости от типа переменных
    pattern: 'if\s+.*==.*:'
    fix: 'корректировка оператора сравнения для объектов и None'
    apply:
      - context_aware_operator_fix

  - id: missing_return_type_annotation
    description: Добавление аннотации типа возвращаемого значения в функциях без неё
    pattern: 'def\s+\w+\(.*\):'
    fix: 'добавлена аннотация -> None, если отсутствует'
    apply:
      - add_return_annotation:
          default_type: None

  - id: use_fstring
    description: Замена строковых конкатенаций и форматирования на f-string для python >=3.6
    pattern: '(\'|")\s*\+\s*\w+'
    fix: 'преобразование в f-string'
    apply:
      - convert_to_fstring

  - id: redundant_pass
    description: Удаление избыточных операторов pass в функциях и классах с реальным телом
    pattern: 'pass'
    fix: 'удалён лишний pass'
    apply:
      - remove_redundant_pass

  - id: multiple_blank_lines
    description: Сведение нескольких подряд идущих пустых строк к одной
    pattern: '\n{3,}'
    fix: 'сведено к одной пустой строке'
    apply:
      - reduce_blank_lines_to_one

  - id: missing_docstring
    description: Добавление заглушек docstring в функции и классы без документации
    pattern: '^(def|class)\s+\w+\(?.*\)?:\n(?!\s+""")'
    fix: 'добавлен шаблон docstring'
    apply:
      - add_docstring_stub:
          template: |
            """
            Описание функции/класса.
            """

# Общие настройки исправлений
fix_settings:
  max_fixes_per_file: 5
  fix_order_priority: syntax_errors_first
  log_fixes: true
  autofix_enabled: true
  language_targets:
    - python
    - javascript
    - typescript
