service: teslaai-functions

frameworkVersion: '3'

provider:
  name: aws
  runtime: python3.11
  stage: production
  region: us-east-1
  timeout: 30
  memorySize: 512
  logRetentionInDays: 7
  environment:
    STAGE: ${opt:stage, 'production'}
    AI_MODE: "multiagent"
    SECURE_MODE: "true"

functions:
  copilotHandler:
    handler: handlers/copilot_handler.main
    events:
      - http:
          path: copilot/invoke
          method: post
          cors: true
          authorizer:
            name: authFunction
            type: request
  defenseSuggester:
    handler: handlers/defense_suggester.main
    events:
      - http:
          path: suggest/defense
          method: post
          cors: true
  attackPlanner:
    handler: handlers/attack_planner.main
    events:
      - http:
          path: attack/plan
          method: post
          cors: true

plugins:
  - serverless-python-requirements
  - serverless-iam-roles-per-function

custom:
  pythonRequirements:
    dockerizePip: true
    slim: true
    strip: false

package:
  individually: true

iamRoleStatements:
  - Effect: Allow
    Action:
      - dynamodb:*
      - s3:*
      - logs:*
    Resource: "*"
