version: 1.0

global:
  log_level: "info"
  ui: true
  disable_mlock: false
  default_lease_ttl: "1h"
  max_lease_ttl: "24h"
  listener:
    tcp:
      address: "0.0.0.0:8200"
      tls_disable: false
      tls_cert_file: "/etc/vault/ssl/vault.crt"
      tls_key_file: "/etc/vault/ssl/vault.key"
      tls_min_version: "tls12"
      tls_cipher_suites:
        - "TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384"
        - "TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256"

storage:
  raft:
    path: "/opt/vault/data"
    node_id: "vault-node-1"
    retry_join:
      - leader_api_addr: "https://vault-1.example.com:8200"
        leader_ca_cert_file: "/etc/vault/ssl/ca.crt"
      - leader_api_addr: "https://vault-2.example.com:8200"
        leader_ca_cert_file: "/etc/vault/ssl/ca.crt"

api_addr: "https://vault.example.com:8200"
cluster_addr: "https://vault.example.com:8201"

seal:
  type: "transit"
  transit:
    address: "https://vault-seal.example.com"
    token: "{{ lookup('env','VAULT_SEAL_TOKEN') }}"
    key_name: "vault-auto-unseal"
    mount_path: "transit/"
    tls_skip_verify: false

audit:
  file:
    path: "/var/log/vault_audit.log"
    log_raw: true
    hmac_accessor: true

policies:
  - name: "default"
    path: "/etc/vault/policies/default.hcl"
  - name: "devops"
    path: "/etc/vault/policies/devops.hcl"
  - name: "infra"
    path: "/etc/vault/policies/infra.hcl"

auth:
  - type: "token"
    description: "Token-based access"
    default_ttl: "30m"
  - type: "userpass"
    description: "DevOps Local User Auth"
    config:
      max_ttl: "1h"
  - type: "github"
    description: "CI/CD GitHub Access"
    config:
      organization: "teslaai-genesis"
  - type: "kubernetes"
    description: "K8s Workload Auth"
    config:
      kubernetes_host: "https://kubernetes.default.svc:443"
      token_reviewer_jwt: "{{lookup('env','K8S_JWT')}}"
      kubernetes_ca_cert: "/var/run/secrets/kubernetes.io/serviceaccount/ca.crt"

secrets_engines:
  - path: "kv/"
    type: "kv"
    version: 2
    config:
      max_versions: 10
      cas_required: true
  - path: "transit/"
    type: "transit"
  - path: "database/"
    type: "database"
  - path: "aws/"
    type: "aws"
    config:
      access_key: "{{ lookup('env','VAULT_AWS_KEY') }}"
      secret_key: "{{ lookup('env','VAULT_AWS_SECRET') }}"
  - path: "gcp/"
    type: "gcp"

telemetry:
  statsd_address: "127.0.0.1:8125"
  disable_hostname: true
  prometheus_retention_time: "24h"

performance:
  cache_size: "64MiB"
  max_request_duration: "60s"

features:
  rate_limit:
    enabled: true
    max_requests_per_second: 500
  security_headers:
    content_security_policy: "default-src 'self';"
    x_frame_options: "DENY"
    x_content_type_options: "nosniff"
    referrer_policy: "strict-origin-when-cross-origin"

