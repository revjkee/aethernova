### Zabbix Agent Industrial Configuration (TeslaAI Genesis) ###

############ GENERAL PARAMETERS ############

PidFile=/var/run/zabbix/zabbix_agentd.pid
LogFile=/var/log/zabbix/zabbix_agentd.log
LogFileSize=50
EnableRemoteCommands=0
LogRemoteCommands=0

############ NETWORK SETTINGS ############

Server=127.0.0.1,10.0.0.0/8,192.168.0.0/16
ServerActive=zabbix-server.teslaai.internal
Hostname=teslaai-agent-node01
ListenPort=10050
ListenIP=0.0.0.0
Timeout=10

############ SECURITY SETTINGS ############

TLSConnect=psk
TLSAccept=psk
TLSPSKIdentity=TESLAAI_AGENT_PSK
TLSPSKFile=/etc/zabbix/psk/agent01.psk
AllowRoot=0
UnsafeUserParameters=0

############ USER PARAMETERS ############

Include=/etc/zabbix/zabbix_agentd.d/*.conf

UserParameter=ai.latency[*],/opt/zabbix/scripts/get_latency.sh $1
UserParameter=ai.status[*],/opt/zabbix/scripts/status_check.sh $1
UserParameter=ai.agent_drift[*],/opt/zabbix/scripts/agent_drift.py $1

############ RESOURCE CONTROLS ############

StartAgents=5
RefreshActiveChecks=120
BufferSize=1000
MaxLinesPerSecond=50

############ METRICS & LOGGING ############

EnablePersistentBuffer=1
BufferSend=5
BufferSize=1000
MaxLinesPerSecond=100

############ ADVANCED MONITORING ############

AllowKey=system.cpu.load[,avg1]
AllowKey=system.cpu.util[,user]
AllowKey=system.memory.util[,used]
AllowKey=system.swap.size[,free]
AllowKey=vfs.fs.size[/,free]
AllowKey=net.if.in[eth0]
AllowKey=net.if.out[eth0]
AllowKey=proc.num[,,run]
AllowKey=agent.ping

############ LOG MONITORING ############

LogFile=/var/log/zabbix/zabbix_agentd.log
LogRemoteCommands=0
LogType=file
LogFileSize=20

############ CUSTOMIZATION ############

HostMetadata=teslaai-core-v2
HostMetadataItem=system.uname
Alias=cpu=/proc/stat
Alias=memory=/proc/meminfo
Alias=latency=/opt/zabbix/metrics/latency.sh
Alias=drift=/opt/zabbix/metrics/drift.sh

############ FILESYSTEM MONITORING ############

UserParameter=fs.inode.usage[*],df -i | grep "$1" | awk '{print $5}' | tr -d '%'
UserParameter=fs.disk.usage[*],df -h | grep "$1" | awk '{print $5}' | tr -d '%'

############ PERFORMANCE THRESHOLDS ############

UserParameter=perf.queue.backlog[*],/opt/zabbix/scripts/queue_backlog_check.sh $1
UserParameter=perf.gpu.util[*],nvidia-smi --query-gpu=utilization.gpu --format=csv,noheader,nounits

