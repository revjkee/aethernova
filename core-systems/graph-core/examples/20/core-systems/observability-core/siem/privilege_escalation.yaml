# observability/dashboards/siem/privilege_escalation.yaml

rule_id: PRIV_ESC_007
description: >
  Detects potential privilege escalation techniques involving token manipulation, SUDO/RunAs abuse, or unusual group additions.

enabled: true
severity: high
tags:
  - privilege-escalation
  - siem
  - mitre_technique:T1078
  - mitre_technique:T1068
  - insider-threat
  - credential-abuse

conditions:
  type: composite
  match:
    - field: event_type
      operator: in
      value:
        - user_group_modification
        - process_creation
        - sudo_activity
        - token_modification

    - field: command_line
      operator: contains_any
      value:
        - "net localgroup administrators"
        - "whoami /priv"
        - "powershell Add-LocalGroupMember"
        - "sudo su"
        - "runas /user:"
        - "SetTokenInformation"

    - field: user_account_type
      operator: equals
      value: standard_user

    - field: device_profile_baseline
      operator: not_equals
      value: expected_admin_activity

exceptions:
  - user: ["domain-admin", "secops-root"]
    comment: Trusted elevated accounts

actions:
  - type: alert
    message: >
      Privilege escalation attempt detected from {{ user }} on {{ host }} using: {{ command_line }}

  - type: quarantine
    target: session
    reason: Suspicious privilege escalation attempt

  - type: threat_score
    increment: 50
    reason: Escalation Pattern Matched (Critical TTP)
