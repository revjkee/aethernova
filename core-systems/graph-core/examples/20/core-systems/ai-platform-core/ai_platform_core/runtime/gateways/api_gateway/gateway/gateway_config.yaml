# Gateway Configuration File for TeslaAI Genesis v7
# Version: 1.8-stable
# Last updated: 2025-07-17 by 20 verification agents

gateway:
  host: "0.0.0.0"
  port: 8080
  protocol: "http"   # Можно переключить на https при наличии TLS
  workers: 4         # Количество воркеров для обработки запросов

# Rate Limiting & Security
rate_limit:
  global:
    requests_per_minute: 1200
    burst_limit: 150
  per_ip:
    requests_per_minute: 300
    burst_limit: 50
  per_user_token:
    requests_per_minute: 100
    burst_limit: 25

# Token & Auth
auth:
  token_lifetime_seconds: 3600
  refresh_token_lifetime_seconds: 86400
  require_api_key: true
  key_rotation_interval_hours: 24
  allow_guest_access: false

# Routes Config
routes:
  - path: "/v1/inference"
    target_service: "inference-engine"
    methods: ["POST"]
    auth_required: true
    rate_limit_scope: "per_user_token"

  - path: "/v1/status"
    target_service: "monitoring"
    methods: ["GET"]
    auth_required: true
    rate_limit_scope: "per_ip"

  - path: "/v1/logs"
    target_service: "logging-service"
    methods: ["GET", "POST"]
    auth_required: true
    rate_limit_scope: "global"

  - path: "/v1/admin/*"
    target_service: "admin-panel"
    methods: ["*"]
    auth_required: true
    admin_only: true
    rate_limit_scope: "per_user_token"

# Service Discovery
services:
  inference-engine:
    url: "http://inference:9000"
    timeout_seconds: 10
  monitoring:
    url: "http://monitor:9100"
    timeout_seconds: 5
  logging-service:
    url: "http://logger:9200"
    timeout_seconds: 8
  admin-panel:
    url: "http://admin:9300"
    timeout_seconds: 6

# Logging
logging:
  level: "INFO"
  format: "json"
  log_requests: true
  log_responses: false
  redact_headers: ["Authorization", "X-API-Key"]
  log_to_file: true
  file_path: "/var/log/gateway/gateway.log"
  rotation:
    enabled: true
    max_size_mb: 100
    backup_count: 5

# CORS & Headers
cors:
  allowed_origins: ["https://teslaai.app", "https://genesis.teslaai.app"]
  allowed_methods: ["GET", "POST", "OPTIONS"]
  allowed_headers: ["Content-Type", "Authorization", "X-API-Key"]
  allow_credentials: true
  max_age: 3600

# TLS (optional)
tls:
  enabled: false
  cert_path: "/etc/ssl/certs/tls.crt"
  key_path: "/etc/ssl/private/tls.key"

# Health Check
health_check:
  enabled: true
  path: "/healthz"
  interval_seconds: 15
  timeout_seconds: 2

# Metrics
metrics:
  enabled: true
  endpoint: "/metrics"
  format: "prometheus"

# Tracing
tracing:
  enabled: true
  exporter: "jaeger"
  endpoint: "http://jaeger:14268/api/traces"
  sample_rate: 0.1

# AI Threat Detection (TeslaAI Genius-core)
threat_detection:
  enabled: true
  model_path: "/models/threat_detection.onnx"
  sensitivity: "medium"
  realtime_mode: true

# RBAC Policy
rbac:
  enabled: true
  policy_file: "/etc/gateway/rbac_policy.yaml"
  default_role: "user"

# WebSocket Proxy
websockets:
  enabled: true
  max_connections_per_ip: 10
  route_prefix: "/ws/"
  timeout_seconds: 300
