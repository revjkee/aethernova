# defense_rules.yaml
# Правила защиты для AI Defense Suggester
# Модуль содержит набор правил и рекомендаций для автоматического анализа и генерации защитных мер

rules:
  - id: DR001
    name: "Блокировка IP по аномальной активности"
    description: "Автоматически блокировать IP-адреса, проявляющие подозрительную активность, например, множественные неудачные попытки входа."
    conditions:
      - event_type: "failed_login"
      - threshold: 5
      - time_window_minutes: 10
    actions:
      - action_type: "block_ip"
      - duration_minutes: 60
    severity: high

  - id: DR002
    name: "Обнаружение SQL-инъекций"
    description: "Отслеживать запросы, содержащие признаки SQL-инъекций, и блокировать их выполнение."
    conditions:
      - event_type: "web_request"
      - pattern: "(union select|--|;|or 1=1)"
    actions:
      - action_type: "block_request"
      - notify_security_team: true
    severity: critical

  - id: DR003
    name: "Защита от перебора паролей"
    description: "Ограничение количества попыток авторизации для предотвращения brute-force атак."
    conditions:
      - event_type: "login_attempt"
      - threshold: 10
      - time_window_minutes: 15
    actions:
      - action_type: "lock_account"
      - notify_user: true
    severity: high

  - id: DR004
    name: "Мониторинг необычной активности пользователя"
    description: "Выявление действий пользователя, отклоняющихся от нормального поведения, например, скачивание большого объёма данных."
    conditions:
      - event_type: "data_download"
      - threshold_mb: 500
      - time_window_minutes: 30
    actions:
      - action_type: "alert_security_team"
      - action_type: "temporarily_suspend_user"
    severity: medium

  - id: DR005
    name: "Обновление и проверка патчей"
    description: "Автоматический аудит систем на предмет устаревших патчей и уязвимостей."
    conditions:
      - event_type: "system_scan"
      - condition: "missing_security_updates"
    actions:
      - action_type: "notify_admin"
      - action_type: "schedule_patch_install"
    severity: critical

  - id: DR006
    name: "Фильтрация входящего трафика по геолокации"
    description: "Блокировка трафика из стран, не связанных с деятельностью компании."
    conditions:
      - event_type: "network_connection"
      - geoip_not_in: ["RU", "DE", "US"]  # Пример списка разрешённых стран
    actions:
      - action_type: "block_connection"
    severity: medium

  - id: DR007
    name: "Обнаружение и блокировка DDoS атак"
    description: "Мониторинг и автоматическая блокировка подозрительных всплесков входящего трафика."
    conditions:
      - event_type: "traffic_spike"
      - threshold_rps: 10000
      - time_window_seconds: 60
    actions:
      - action_type: "activate_ddos_mitigation"
      - notify_security_team: true
    severity: critical

  - id: DR008
    name: "Контроль целостности файлов"
    description: "Отслеживание изменений критичных файлов и системных конфигураций."
    conditions:
      - event_type: "file_change"
      - path_patterns: ["/etc/passwd", "/var/www/html/", "/usr/bin/"]
    actions:
      - action_type: "alert_security_team"
      - action_type: "rollback_changes"
    severity: high

  - id: DR009
    name: "Проверка подозрительных процессов"
    description: "Обнаружение и остановка неавторизованных или подозрительных процессов."
    conditions:
      - event_type: "process_start"
      - blacklist_process_names: ["nc", "netcat", "powershell", "cmd.exe"]
    actions:
      - action_type: "terminate_process"
      - notify_admin: true
    severity: high

  - id: DR010
    name: "Шифрование данных в покое"
    description: "Обеспечить шифрование всех критичных данных на дисках и в базах."
    conditions:
      - event_type: "data_storage"
      - condition: "unencrypted_sensitive_data_detected"
    actions:
      - action_type: "encrypt_data"
      - notify_compliance_team: true
    severity: critical

meta:
  version: "1.0.0"
  last_updated: "2025-07-11"
  author: "TeslaAI Defense Suggester Team"
