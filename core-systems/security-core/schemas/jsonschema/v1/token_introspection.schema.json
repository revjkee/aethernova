{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://schemas.aethernova.org/security/v1/token_introspection.schema.json",
  "title": "Aethernova Security Core â€” Token Introspection Response (v1)",
  "description": "Industrial JSON Schema for OAuth2 RFC 7662-compatible token introspection responses with extensions for PoP/DPoP, delegations/caveats, hardware attestation, hybrid signatures, encryption metadata, and observability.",
  "type": "object",
  "required": ["active"],
  "additionalProperties": false,
  "patternProperties": {
    "^x-[A-Za-z0-9_.-]+$": {}
  },
  "properties": {
    "active": {
      "type": "boolean",
      "description": "Indicates whether the token is currently active per RFC 7662."
    },
    "token_id": {
      "type": "string",
      "description": "Stable identifier of the token (maps to jti).",
      "minLength": 1
    },
    "jti": {
      "type": "string",
      "description": "JWT ID (token identifier).",
      "minLength": 1
    },
    "format": {
      "type": "string",
      "enum": ["protobuf", "jwt", "paseto", "cwt", "macaroon"],
      "description": "Logical token format."
    },
    "serialization": {
      "type": "string",
      "enum": ["compact", "json", "cbor", "protobuf", "msgpack"],
      "description": "Serialization used by the token."
    },
    "compression": {
      "type": "string",
      "enum": ["none", "deflate", "zstd"],
      "default": "none"
    },
    "issuer": {
      "type": "string",
      "format": "uri",
      "description": "Issuer URI (iss)."
    },
    "subject": {
      "type": "string",
      "description": "Subject (sub)."
    },
    "audience": {
      "oneOf": [
        { "type": "string" },
        { "type": "array", "items": { "type": "string" }, "minItems": 1 }
      ],
      "description": "Audience (aud)."
    },
    "username": { "type": "string" },
    "client_id": { "type": "string" },
    "token_type": {
      "type": "string",
      "description": "Token type (e.g., access_token, refresh_token)."
    },
    "token_type_hint": {
      "type": "string",
      "description": "Echo of the hint provided by the client, if any."
    },
    "scope": {
      "oneOf": [
        { "type": "string", "pattern": "^[A-Za-z0-9:._-]+( [A-Za-z0-9:._-]+)*$" },
        { "type": "array", "items": { "type": "string", "pattern": "^[A-Za-z0-9:._-]+$" } }
      ],
      "description": "Granted scopes as a space-delimited string or array."
    },
    "scopes": {
      "type": "array",
      "items": { "$ref": "#/$defs/scope" },
      "description": "Structured scope descriptors."
    },
    "exp": { "$ref": "#/$defs/timestampSeconds" },
    "iat": { "$ref": "#/$defs/timestampSeconds" },
    "nbf": { "$ref": "#/$defs/timestampSeconds" },
    "iss": {
      "type": "string",
      "format": "uri",
      "description": "Alias for issuer to match RFC 7662 providers."
    },
    "sub": {
      "type": "string",
      "description": "Alias for subject to match RFC 7662 providers."
    },
    "aud": {
      "oneOf": [
        { "type": "string" },
        { "type": "array", "items": { "type": "string" }, "minItems": 1 }
      ],
      "description": "Alias for audience to match RFC 7662 providers."
    },
    "claims": { "$ref": "#/$defs/claims" },
    "subject_context": { "$ref": "#/$defs/subjectContext" },
    "roles": { "type": "array", "items": { "type": "string" } },
    "permissions": { "type": "array", "items": { "type": "string" } },
    "groups": { "type": "array", "items": { "type": "string" } },
    "cnf": { "$ref": "#/$defs/confirmation" },
    "key_binding": { "$ref": "#/$defs/keyBinding" },
    "delegations": { "type": "array", "items": { "$ref": "#/$defs/delegation" } },
    "attestation": { "$ref": "#/$defs/attestationBundle" },
    "signatures": { "$ref": "#/$defs/multiSignature" },
    "encryption": { "$ref": "#/$defs/encryption" },
    "digest": { "$ref": "#/$defs/digest" },
    "meta": { "$ref": "#/$defs/tokenMeta" },
    "status": { "$ref": "#/$defs/tokenStatus" },
    "ext": {
      "type": "object",
      "description": "Free-form extension container.",
      "additionalProperties": true
    }
  },
  "$defs": {
    "timestampSeconds": {
      "type": "integer",
      "minimum": 0,
      "description": "Seconds since Unix epoch (UTC)."
    },
    "digest": {
      "type": "object",
      "required": ["algorithm", "value"],
      "additionalProperties": false,
      "properties": {
        "algorithm": {
          "type": "string",
          "enum": ["SHA-256", "SHA-384", "SHA-512", "BLAKE2b-256", "BLAKE3-256"]
        },
        "value": {
          "type": "string",
          "pattern": "^[A-Za-z0-9_-]+$",
          "description": "Base64url-encoded digest over canonical bytes."
        }
      }
    },
    "scope": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "name": { "type": "string", "pattern": "^[A-Za-z0-9:._-]+$", "minLength": 1 },
        "resource": { "type": "string", "minLength": 1 },
        "actions": { "type": "array", "items": { "type": "string", "pattern": "^[a-z]+$" } },
        "not_before": { "$ref": "#/$defs/timestampSeconds" },
        "not_after": { "$ref": "#/$defs/timestampSeconds" },
        "constraints": { "type": "object", "additionalProperties": true }
      }
    },
    "claims": {
      "type": "object",
      "additionalProperties": true,
      "properties": {
        "iss": { "type": "string", "format": "uri" },
        "sub": { "type": "string" },
        "aud": {
          "oneOf": [
            { "type": "string" },
            { "type": "array", "items": { "type": "string" }, "minItems": 1 }
          ]
        },
        "exp": { "$ref": "#/$defs/timestampSeconds" },
        "nbf": { "$ref": "#/$defs/timestampSeconds" },
        "iat": { "$ref": "#/$defs/timestampSeconds" },
        "jti": { "type": "string" },
        "roles": { "type": "array", "items": { "type": "string" } },
        "permissions": { "type": "array", "items": { "type": "string" } },
        "groups": { "type": "array", "items": { "type": "string" } },
        "private": { "type": "object", "additionalProperties": true }
      }
    },
    "subjectContext": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "tenant_id": { "type": "string" },
        "user_id": { "type": "string" },
        "service_id": { "type": "string" },
        "session_id": { "type": "string" },
        "device_id": { "type": "string" },
        "user_agent": { "type": "string" },
        "ip_address": { "type": "string" },
        "region": { "type": "string" },
        "locale": { "type": "string" },
        "platform": { "type": "string" },
        "mfa_level": { "type": "string", "enum": ["none", "sms", "totp", "webauthn"] },
        "risk_score": { "type": "number", "minimum": 0.0, "maximum": 1.0 },
        "risk_factors": { "type": "object", "additionalProperties": true }
      }
    },
    "confirmation": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "jwk": { "$ref": "#/$defs/jwk" },
        "jkt": {
          "type": "string",
          "pattern": "^[A-Za-z0-9_-]{16,}$",
          "description": "JWK thumbprint (base64url)."
        },
        "kid": { "type": "string" }
      }
    },
    "keyBinding": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "public_key_spki": {
          "type": "string",
          "pattern": "^[A-Za-z0-9_/+=\\-]+$",
          "description": "Base64-encoded SPKI"
        },
        "key_id": { "type": "string" },
        "cnf": { "$ref": "#/$defs/confirmation" },
        "proof_chain": { "type": "array", "items": { "$ref": "#/$defs/proof" } }
      }
    },
    "proof": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "media_type": { "type": "string", "enum": ["jws", "cose-sign1", "cose-sign"] },
        "data": {
          "type": "string",
          "pattern": "^[A-Za-z0-9_-]+$",
          "description": "Detached proof bytes (base64url)."
        },
        "created_at": { "$ref": "#/$defs/timestampSeconds" }
      }
    },
    "attestationBundle": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "evidence": { "type": "array", "items": { "$ref": "#/$defs/attestation" } },
        "results": { "type": "array", "items": { "$ref": "#/$defs/attestationResult" } }
      }
    },
    "attestation": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "tpm",
            "intel_sgx",
            "intel_tdx",
            "amd_sev_snp",
            "arm_trustzone",
            "apple_devicecheck",
            "android_key",
            "fido_u2f"
          ]
        },
        "evidence": { "type": "string", "pattern": "^[A-Za-z0-9_/+=\\-]+$" },
        "nonce": { "type": "string", "pattern": "^[A-Za-z0-9_-]+$" },
        "params": { "type": "object", "additionalProperties": true }
      }
    },
    "attestationResult": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": { "type": "string" },
        "valid": { "type": "boolean" },
        "verifier": { "type": "string" },
        "policy_id": { "type": "string" },
        "reason": { "type": "string" },
        "verified_at": { "$ref": "#/$defs/timestampSeconds" }
      }
    },
    "signature": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "algorithm": {
          "type": "string",
          "enum": [
            "ed25519",
            "ed448",
            "ecdsa_p256",
            "ecdsa_p384",
            "ecdsa_p521",
            "rsa_pss_2048",
            "rsa_pss_3072",
            "rsa_pss_4096",
            "dilithium2",
            "dilithium3",
            "dilithium5",
            "falcon512",
            "falcon1024",
            "sphincs_sha2_128s"
          ]
        },
        "key_id": { "type": "string" },
        "origin": {
          "type": "string",
          "enum": ["local", "hsm", "aws_kms", "gcp_kms", "azure_kv", "vault", "tpm", "tee"]
        },
        "signature": { "type": "string", "pattern": "^[A-Za-z0-9_-]+$" },
        "created_at": { "$ref": "#/$defs/timestampSeconds" },
        "public_key_spki": { "type": "string", "pattern": "^[A-Za-z0-9_/+=\\-]+$" },
        "x5c_chain_der": {
          "type": "array",
          "items": { "type": "string", "pattern": "^[A-Za-z0-9_/+=\\-]+$" }
        },
        "kms_uri": { "type": "string" },
        "protected_headers": { "type": "string", "pattern": "^[A-Za-z0-9_-]+$" },
        "tags": { "type": "array", "items": { "type": "string" } }
      }
    },
    "multiSignature": {
      "type": "array",
      "items": { "$ref": "#/$defs/signature" }
    },
    "encryption": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "mode": {
          "type": "string",
          "enum": ["none", "aead", "jwe", "hpke", "paseto_local"]
        },
        "aead": {
          "type": "string",
          "enum": ["aes_gcm_128", "aes_gcm_256", "chacha20_poly1305"]
        },
        "iv": { "type": "string", "pattern": "^[A-Za-z0-9_-]+$" },
        "salt": { "type": "string", "pattern": "^[A-Za-z0-9_-]+$" },
        "aad": { "type": "string", "pattern": "^[A-Za-z0-9_-]*$" },
        "jwe_compact": { "type": "string" },
        "jwe_protected": { "type": "string" },
        "jwe_recipient": { "type": "string" },
        "hpke": { "$ref": "#/$defs/hpkeSuite" },
        "recipient_pubkey": { "type": "string", "pattern": "^[A-Za-z0-9_/+=\\-]+$" },
        "ephemeral_pubkey": { "type": "string", "pattern": "^[A-Za-z0-9_/+=\\-]+$" },
        "enc": { "type": "string", "pattern": "^[A-Za-z0-9_-]+$" },
        "info": { "type": "string" },
        "paseto_version": { "type": "string" },
        "paseto_footer": { "type": "string", "pattern": "^[A-Za-z0-9_-]*$" },
        "cek_kid": { "type": "string" },
        "cek_kms_uri": { "type": "string" }
      }
    },
    "hpkeSuite": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "kem": { "type": "string", "enum": ["p256", "p384", "p521", "x25519", "x448"] },
        "kdf": { "type": "string", "enum": ["hkdf_sha256", "hkdf_sha384", "hkdf_sha512"] },
        "aead": {
          "type": "string",
          "enum": ["aes_gcm_128", "aes_gcm_256", "chacha20_poly1305"]
        }
      }
    },
    "delegation": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "grant_id": { "type": "string" },
        "grantor": { "$ref": "#/$defs/principal" },
        "grantee": { "$ref": "#/$defs/principal" },
        "scopes": { "type": "array", "items": { "$ref": "#/$defs/scope" } },
        "caveats": { "type": "array", "items": { "$ref": "#/$defs/caveat" } },
        "max_hops": { "type": "integer", "minimum": 0 },
        "issued_at": { "$ref": "#/$defs/timestampSeconds" },
        "expires_at": { "$ref": "#/$defs/timestampSeconds" }
      }
    },
    "principal": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": { "type": "string", "enum": ["user", "service", "device", "role"] },
        "id": { "type": "string" },
        "attributes": { "type": "object", "additionalProperties": true }
      }
    },
    "caveat": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "id": { "type": "string" },
        "kind": {
          "type": "string",
          "enum": ["time", "ip", "geo", "rate", "aud", "nonce", "predicate"]
        },
        "expression": { "type": "string" },
        "location": { "type": "string" },
        "binder": { "$ref": "#/$defs/digest" }
      }
    },
    "tokenMeta": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "issuer_service": { "type": "string" },
        "issuer_instance": { "type": "string" },
        "issuer_region": { "type": "string" },
        "policy_id": { "type": "string" },
        "default_ttl": {
          "type": "integer",
          "minimum": 0,
          "description": "Default TTL in seconds used at issuance."
        },
        "one_time_use": { "type": "boolean" },
        "non_transferrable": { "type": "boolean" },
        "trace_id": { "type": "string" },
        "span_id": { "type": "string" },
        "client_app": { "type": "string" },
        "client_version": { "type": "string" },
        "annotations": { "type": "object", "additionalProperties": true }
      }
    },
    "tokenStatus": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "state": {
          "type": "string",
          "enum": ["active", "revoked", "expired", "not_yet_valid"]
        },
        "reason": { "type": "string" },
        "as_of": { "$ref": "#/$defs/timestampSeconds" }
      }
    },
    "jwk": {
      "type": "object",
      "required": ["kty"],
      "additionalProperties": false,
      "patternProperties": {
        "^x-[A-Za-z0-9_.-]+$": {}
      },
      "properties": {
        "kty": { "type": "string", "enum": ["OKP", "EC", "RSA", "oct"] },
        "crv": { "type": "string" },
        "x": { "type": "string", "pattern": "^[A-Za-z0-9_-]+$" },
        "y": { "type": "string", "pattern": "^[A-Za-z0-9_-]+$" },
        "d": { "type": "string", "pattern": "^[A-Za-z0-9_-]+$" },
        "n": { "type": "string", "pattern": "^[A-Za-z0-9_-]+$" },
        "e": { "type": "string", "pattern": "^[A-Za-z0-9_-]+$" },
        "alg": { "type": "string" },
        "kid": { "type": "string" },
        "use": { "type": "string", "enum": ["sig", "enc"] },
        "key_ops": { "type": "array", "items": { "type": "string" } }
      }
    }
  },
  "examples": [
    {
      "active": true,
      "iss": "https://auth.example.com/",
      "sub": "user_123",
      "client_id": "app_abc",
      "token_type": "access_token",
      "scope": "orders:read profile:read",
      "exp": 1893456000,
      "iat": 1693452000,
      "nbf": 1693451700,
      "jti": "f5f6c1ec-1b2a-4a1c-8d3c-9f9a9d5e5e01"
    },
    {
      "active": true,
      "format": "jwt",
      "serialization": "compact",
      "compression": "none",
      "issuer": "https://auth.neurocity.ai/",
      "subject": "svc:ingestor",
      "audience": ["orders-api", "billing-api"],
      "scope": ["orders:read", "orders:list"],
      "scopes": [
        { "name": "orders:read", "resource": "orders/*", "actions": ["read"] }
      ],
      "exp": 1893456000,
      "iat": 1693452000,
      "cnf": { "jkt": "4Qx9-0r0QfD1S8XQZl0K2w" },
      "key_binding": {
        "public_key_spki": "TUlJQklqQU5CZ2txaG==",
        "key_id": "k-2025-08",
        "proof_chain": [
          { "media_type": "jws", "data": "ZXlKaGJHY2lPaA", "created_at": 1693452001 }
        ]
      },
      "attestation": {
        "evidence": [
          { "type": "intel_tdx", "evidence": "TUM0Q0ZRRGl", "nonce": "N8z1y3g" }
        ],
        "results": [
          {
            "type": "intel_tdx",
            "valid": true,
            "verifier": "attest.svc",
            "policy_id": "tdx-baseline-v3",
            "verified_at": 1693452010
          }
        ]
      },
      "signatures": [
        { "algorithm": "ed25519", "key_id": "k-2025-08", "origin": "hsm", "signature": "aDNLOWY", "created_at": 1693452000 },
        { "algorithm": "dilithium2", "key_id": "k-2025-08-pq", "origin": "hsm", "signature": "QVFJRA", "created_at": 1693452000, "tags": ["pq-hybrid"] }
      ],
      "digest": { "algorithm": "SHA-256", "value": "7MDm3Ooj6x7tZ5n2w" },
      "meta": { "issuer_service": "auth", "issuer_instance": "auth-1", "issuer_region": "eu-central-1", "trace_id": "abc123" }
    }
  ]
}
