# =============================================================================
# security-core: пример промышленной конфигурации окружения
# Скопируйте в .env и заполните плейсхолдеры. Не коммитьте реальный .env.
# Секреты выдавайте через Vault/KMS/Secrets Manager. Значения ниже — примеры.
# =============================================================================

# -----------------------------------------------------------------------------
# Общие настройки приложения
# -----------------------------------------------------------------------------
APP_NAME=security-core
APP_ENV=production            # production|staging|dev
APP_DEBUG=false               # НИКОГДА не включайте в production
APP_URL=https://security-core.local
TZ=UTC

SERVER_HOST=0.0.0.0
SERVER_PORT=8080
WORKERS=4                     # gunicorn/uvicorn workers
REQUEST_ID_HEADER=X-Request-ID

# -----------------------------------------------------------------------------
# TLS / mTLS
# -----------------------------------------------------------------------------
TLS_ENABLED=true
TLS_CERT_FILE=/etc/security-core/certs/server.crt
TLS_KEY_FILE=/etc/security-core/keys/server.key
TLS_CA_FILE=/etc/security-core/certs/ca.crt

MTLS_REQUIRED=false
MTLS_CLIENT_CA_DIR=/etc/security-core/clients/ca

# Блокировка устаревших версий TLS (управляется приложением/ингрессом)
FF_BLOCK_LEGACY_TLS=true      # TLS 1.0/1.1 off

# -----------------------------------------------------------------------------
# Криптография и ключи
# -----------------------------------------------------------------------------
# Храните ключи в Vault/KMS. Пути ниже — для примера DEV.
JWT_PUBLIC_KEY_PATH=/secrets/jwt_pub.pem
JWT_PRIVATE_KEY_PATH=/secrets/jwt_priv.pem
JWT_ALG=RS256
JWT_AUDIENCE=neurocity
JWT_ISSUER=security-core

SESSION_SECRET=CHANGE_ME_LENGTH_64
CSRF_SECRET=CHANGE_ME_LENGTH_64

# Провайдеры ключей: vault|aws-kms|gcp-kms|azure-kms|local
KEY_PROVIDER=vault

# Vault
VAULT_ADDR=https://vault.local:8200
VAULT_NAMESPACE=
VAULT_ROLE_ID=
VAULT_SECRET_ID=
VAULT_TOKEN=
VAULT_MOUNT=kv
VAULT_PATH_PREFIX=neurocity/security-core

# AWS KMS (если KEY_PROVIDER=aws-kms)
AWS_REGION=eu-north-1
AWS_KMS_KEY_ID=
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=

# GCP KMS (если KEY_PROVIDER=gcp-kms)
GCP_PROJECT_ID=
GCP_KMS_LOCATION=
GCP_KMS_KEYRING=
GCP_KMS_KEY=
GOOGLE_APPLICATION_CREDENTIALS=/secrets/gcp-sa.json

# Azure Key Vault (если KEY_PROVIDER=azure-kms)
AZURE_TENANT_ID=
AZURE_CLIENT_ID=
AZURE_CLIENT_SECRET=
AZURE_KEYVAULT_NAME=
AZURE_KEY_NAME=
AZURE_KEY_VERSION=

# Режим совместимости с FIPS (если библиотека поддерживает)
FF_FIPS_ONLY_MODE=false

# -----------------------------------------------------------------------------
# База данных
# -----------------------------------------------------------------------------
DB_ENGINE=postgres
DB_HOST=postgres
DB_PORT=5432
DB_NAME=security_core
DB_USER=security_core
DB_PASSWORD=CHANGE_ME
DB_SSLMODE=require
DB_SSLROOTCERT=/etc/ssl/certs/ca-certificates.crt
DB_POOL_SIZE=20
DB_MAX_OVERFLOW=10
DB_CONN_TIMEOUT=5

# -----------------------------------------------------------------------------
# Кэш
# -----------------------------------------------------------------------------
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=
REDIS_TLS=false

# -----------------------------------------------------------------------------
# Шины сообщений / аудит
# -----------------------------------------------------------------------------
KAFKA_BROKERS=kafka-1:9092,kafka-2:9092
KAFKA_SASL_USERNAME=
KAFKA_SASL_PASSWORD=
KAFKA_SASL_MECHANISM=SCRAM-SHA-256   # или PLAIN/OAUTHBEARER
KAFKA_SECURITY_PROTOCOL=PLAINTEXT    # или SASL_SSL
KAFKA_SSL_CAFILE=/etc/ssl/certs/ca-certificates.crt

AUDIT_TOPIC=security.audit
ALERT_TOPIC=security.alerts

# -----------------------------------------------------------------------------
# Объектное хранилище
# -----------------------------------------------------------------------------
S3_ENDPOINT=
S3_REGION=eu-north-1
S3_BUCKET=neurocity-security-core
S3_ACCESS_KEY_ID=
S3_SECRET_ACCESS_KEY=
S3_FORCE_PATH_STYLE=true
S3_USE_SSL=true

# -----------------------------------------------------------------------------
# Аутентификация / OIDC
# -----------------------------------------------------------------------------
OIDC_ENABLED=true
OIDC_ISSUER_URL=https://auth.example.com/
OIDC_CLIENT_ID=security-core
OIDC_CLIENT_SECRET=CHANGE_ME
OIDC_REDIRECT_URI=https://security-core.local/auth/callback
OIDC_SCOPES=openid,profile,email,offline_access
OIDC_JWKS_CACHE_TTL=600
OAUTH2_PROXY_MODE=false

# -----------------------------------------------------------------------------
# RBAC / Policy (OPA)
# -----------------------------------------------------------------------------
POLICY_ENGINE=opa              # opa|local
OPA_URL=http://opa:8181
OPA_BUNDLE_URL=
OPA_AUTH_TOKEN=
DEFAULT_ROLE=reader

# -----------------------------------------------------------------------------
# CORS / CSP
# -----------------------------------------------------------------------------
CORS_ALLOW_ORIGINS=https://admin.neurocity.local
CORS_ALLOW_METHODS=GET,POST,PUT,DELETE,OPTIONS
CORS_ALLOW_HEADERS=Authorization,Content-Type,X-Request-ID
CORS_ALLOW_CREDENTIALS=false

CSP_DEFAULT_SRC='self'
CSP_SCRIPT_SRC='self'
CSP_STYLE_SRC='self'
CSP_IMG_SRC='self data:'
CSP_CONNECT_SRC='self'
CSP_FRAME_ANCESTORS='none'
REFERRER_POLICY=no-referrer

# -----------------------------------------------------------------------------
# Rate limiting и антиабьюз
# -----------------------------------------------------------------------------
RATE_LIMIT_ENABLED=true
RATE_LIMIT_PER_MINUTE=120
RATE_LIMIT_BURST=240
TLS_CLIENT_FINGERPRINT_LIMIT=false

RECAPTCHA_ENABLED=false
RECAPTCHA_SITE_KEY=
RECAPTCHA_SECRET_KEY=

# -----------------------------------------------------------------------------
# DLP (Data Loss Prevention)
# -----------------------------------------------------------------------------
DLP_ENABLED=true
DLP_BLOCK_PATTERNS=card,ssn,iban,private_key
DLP_LOG_MATCHES=true
DLP_REDACT=true

# -----------------------------------------------------------------------------
# Логирование / Наблюдаемость
# -----------------------------------------------------------------------------
LOG_LEVEL=INFO                 # DEBUG|INFO|WARN|ERROR
LOG_FORMAT=json                # json|text
LOG_SAMPLING=0.1               # 0..1 (вероятность)
LOG_SENSITIVE_REDACTION=true

TRACING_ENABLED=true
OTEL_EXPORTER_OTLP_ENDPOINT=http://otel-collector:4317
OTEL_SERVICE_NAME=security-core
OTEL_RESOURCE_ATTRIBUTES=service.version=0.1.0,service.namespace=core-systems

METRICS_ENABLED=true
PROMETHEUS_PORT=9090

SIEM_ENDPOINT=
SIEM_TOKEN=

# -----------------------------------------------------------------------------
# Алертинг
# -----------------------------------------------------------------------------
ALERT_WEBHOOK_URL=
ALERT_MIN_SEVERITY=high        # info|low|medium|high|critical

# -----------------------------------------------------------------------------
# Фичефлаги / Ротация секретов
# -----------------------------------------------------------------------------
FF_STRICT_MTLS=false
FF_ENCRYPT_AT_REST=true
FF_ENCRYPT_IN_TRANSIT=true
FF_SECRETS_ROTATION_DAYS=30

# -----------------------------------------------------------------------------
# Соответствие требованиям / хранение данных
# -----------------------------------------------------------------------------
GDPR_MODE=true
DATA_RESIDENCY=EU
RETENTION_DAYS=365
SNAPSHOT_PURGE_DAYS=7

# -----------------------------------------------------------------------------
# Тестовые режимы / демоданные
# -----------------------------------------------------------------------------
MOCK_MODE=false
DEMO_DATA=false

# -----------------------------------------------------------------------------
# Таймауты и завершение
# -----------------------------------------------------------------------------
READ_TIMEOUT_MS=10000
WRITE_TIMEOUT_MS=10000
IDLE_TIMEOUT_MS=60000
SHUTDOWN_GRACE_PERIOD_S=30

# -----------------------------------------------------------------------------
# Вебхуки / Подписи
# -----------------------------------------------------------------------------
WEBHOOK_HMAC_SECRET=CHANGE_ME

# -----------------------------------------------------------------------------
# Детектирование аномалий
# -----------------------------------------------------------------------------
ANOMALY_ENABLED=true
ANOMALY_SCORE_THRESHOLD=0.85
ANOMALY_WINDOW_SEC=300
