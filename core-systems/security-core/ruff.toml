# Цель: промышленный профиль безопасности и качества
target-version = "py312"
line-length = 100
indent-width = 4

# Автофикс осторожный: безопасные правки включены, опасные отключены
fix = true
unsafe-fixes = false

# Основные наборы правил:
# E/F/W  — pycodestyle/pyflakes; I — isort; N — pep8-naming
# UP     — pyupgrade; B — bugbear; A — builtins; ANN — annotations
# S      — bandit (безопасность); BLE — исключения; C4 — comprehensions
# DTZ    — date-time; ISC — implicit-str-concat; ICN — import-conventions
# T20    — print; Q — quotes; PTH — pathlib; PIE — misc; PL — pylint subset
# PT     — pytest; RET — returns; RUF — ruff; SIM — simplify; TID — tidy imports
# TRY    — tryceratops; PERF — производительность
select = [
  "E", "F", "W", "I", "N",
  "UP", "B", "A", "ANN",
  "S", "BLE", "C4", "DTZ", "ISC", "ICN",
  "T20", "Q", "PTH", "PIE", "PL", "PT", "RET",
  "RUF", "SIM", "TID", "TRY", "PERF", "C90"
]

# Игнор по умолчанию для приемлемой практичности
ignore = [
  # Аннотации для self/cls не требуем
  "ANN101", "ANN102",
  # Конфликты стилей docstring при использовании numpy-style
  "D203", "D212"
]

# Порог цикломатической сложности
[tool.ruff.mccabe]
max-complexity = 10

# Стандартизируем isort
[tool.ruff.isort]
known-first-party = ["security_core"]
combine-as-imports = true
force-sort-within-sections = true

# Конвенция для docstring'ов
[tool.ruff.pydocstyle]
convention = "numpy"

# pycodestyle
[tool.ruff.pycodestyle]
max-doc-length = 100

# Аннотации: требуем типы, включая переменные, но без self/cls
[tool.ruff.flake8-annotations]
mypy-init-return = true
allow-star-arg-any = false
suppress-none-returning = false

# Bugbear: иммутабельные фабрики
[tool.ruff.flake8-bugbear]
extend-immutable-calls = ["pydantic.Field", "dataclasses.field", "attr.ib"]

# Импорт-политика: запрещаем относительные импорты
[tool.ruff.flake8-tidy-imports]
ban-relative-imports = "parents"

# Tryceratops: корректная обработка исключений
[tool.ruff.tryceratops]
ban-reraise-no-from = true

# Политика строк и форматирования
[tool.ruff.format]
quote-style = "double"
indent-style = "space"
docstring-code-format = true
skip-magic-trailing-comma = false

# Конкретные запрещённые практики в прод-коде
[tool.ruff.per-file-ignores]
# Тесты: допускаем assert/print и ослабляем безопасность для фикстур и моков
"tests/**/*.py" = ["S101", "S105", "S106", "T201", "D", "ANN", "PT011", "PLR2004"]
# Инициализаторы пакетов: не требуем модульных docstring'ов
"**/__init__.py" = ["D104"]
# Скрипты и утилиты: разрешаем subprocess-паттерны и локальные принты
"scripts/**/*.py" = ["S603", "S607", "T201", "D", "ANN"]

# Дополнительные настройки подмодулей pylint
[tool.ruff.pylint]
max-args = 8
