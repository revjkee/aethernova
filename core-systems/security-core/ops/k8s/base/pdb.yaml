# PodDisruptionBudgets for security-core
# apiVersion: policy/v1 is stable and supported in modern Kubernetes
# Требование: для API установите replicas >= 2 в соответствующем Deployment/Rollout.

---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: security-core-api-pdb
  labels:
    app.kubernetes.io/name: security-core
    app.kubernetes.io/instance: security-core
    app.kubernetes.io/component: api
    app.kubernetes.io/part-of: core-systems
    app.kubernetes.io/version: "1.0.0"
    app.kubernetes.io/managed-by: kustomize
    app.kubernetes.io/created-by: ops
spec:
  # Жесткий бюджет для критичного трафика API:
  # допускаем не более одного одновременного добровольного прерывания.
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: security-core
      app.kubernetes.io/component: api

---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: security-core-worker-pdb
  labels:
    app.kubernetes.io/name: security-core
    app.kubernetes.io/instance: security-core
    app.kubernetes.io/component: worker
    app.kubernetes.io/part-of: core-systems
    app.kubernetes.io/version: "1.0.0"
    app.kubernetes.io/managed-by: kustomize
    app.kubernetes.io/created-by: ops
spec:
  # Более гибкий бюджет для фоновых задач:
  # до 25% Pod-ов можно эвакуировать/обновлять одновременно.
  maxUnavailable: 25%
  selector:
    matchLabels:
      app.kubernetes.io/name: security-core
      app.kubernetes.io/component: worker
