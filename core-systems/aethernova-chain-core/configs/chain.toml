# =============================================================================
# Aethernova Chain Core — Chain Configuration (BTC 2.0 Profile)
# Путь: /aethernova-chain-core/configs/chain.toml
# Назначение: Параметры L1-цепочки, независимые от конкретного узла.
# Для prod рекомендуется помечать файл как read-only и подписывать артефакты.
# =============================================================================

schema_version = "1.0"

[network]
chain_id        = "aethernova-btc2"
block_time_ms   = 2000                      # 2 сек/блок
target_finality = "seconds"                 # семантика финализации (информативно)

[units]
symbol          = "AEV"
decimals        = 8                         # 1 AEV = 10^8 nea
minor_unit_name = "nea"

# -----------------------------------------------------------------------------
# Экономика: hard cap, халвинг, субсидии, комиссии.
# -----------------------------------------------------------------------------
[economics]
hard_cap_total_supply = "22000000.00000000" # AEV, жёсткий лимит
# Интервал халвинга в блоках: 4 года при 2 сек/блок.
# 4 года * 365.25 дней/год * 24 ч/день * 3600 сек/ч / 2 сек/блок ≈ 63,072,000
halving_interval_blocks = 63072000

# Начальная субсидия. Геометрическая серия с делением на 2 на каждом халвинге
# обеспечивает сумму ≤ hard_cap_total_supply (без учёта комиссий).
initial_block_subsidy  = "0.17430000"       # AEV/блок, рассчитано под hard cap 22M

# Политика обращения с комиссиями:
#   "burn"        — сжигание 100%
#   "treasury"    — 100% в казначейство
#   "split"       — доли burn/treasury ниже
fees_policy = "split"

[economics.fees_split]
burn_pct     = 50                            # %
treasury_pct = 50                            # %
treasury_address = "aev1qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqtreasury" # заглушка

# -----------------------------------------------------------------------------
# Эпохи/чекпойнты: размер эпохи, параметры финализации (finality gadget).
# -----------------------------------------------------------------------------
[epoch]
# Длина эпохи в блоках; в конце эпохи чекпойнт и агрегация доказательств.
length_blocks = 30000

[finality]
enabled             = true
# Требуемая доля валидирующей мощности для финализации эпохи (например, ≥ 2/3).
threshold_fraction  = 0.67
# Минимальная «глубина» (в блоках) перед объявлением чекпойнта финальным.
checkpoint_confirmations = 2

# Лёгкий клиент: параметры окна валидации заголовков/доказательств.
[finality.light_client]
max_header_gap_blocks = 100000
proof_scheme           = "aggregate-signature"  # информативно (BLS/ed25519-agg и т.д.)

# -----------------------------------------------------------------------------
# P2P/Сети уровня цепочки (не путать с конфигом узла).
# -----------------------------------------------------------------------------
[chain_p2p]
# Максимальная «дистанция» реорганизации, на которую соглашается протокол.
max_reorg_depth_blocks = 100
# Минимальная версия протокола для участия в консенсусе.
min_protocol_version   = "1.0.0"

# -----------------------------------------------------------------------------
# Транзакции/ресурсы: лимиты на уровне L1 (должны соответствовать VM-лимитам).
# -----------------------------------------------------------------------------
[transactions]
max_tx_size_bytes            = 131072         # 128 KiB
max_block_size_bytes         = 8388608        # 8 MiB
max_block_gas                = 50000000       # суммарный газ на блок
max_txs_per_block            = 20000
malleability_protection      = true
replay_protection_chain_tag  = "0xA3"         # условный tag сети

# -----------------------------------------------------------------------------
# Политика параллельного исполнения и детерминизм.
# -----------------------------------------------------------------------------
[execution]
parallel_enabled     = true
# Конфликты определяются через множества чтения/записи (read/write set).
conflict_resolution  = "rwset-optimistic"
# Запрет на недетерминированные хост-функции в продакшне.
nondeterminism_guard = "deny"

# -----------------------------------------------------------------------------
# Снапшоты состояния и хранение пруфов для light clients.
# -----------------------------------------------------------------------------
[snapshots]
enabled                    = true
interval_blocks            = 10000
retain_last_n              = 36               # ~ один «квартал» при 2с/блок
content_addressed          = true             # адресация по хэшу состояния
prove_state_commitments    = true             # меркл/векл-обязательства состояния

# -----------------------------------------------------------------------------
# Приватность (опционально): shielded-пулы, формат пруфов, лимиты.
# -----------------------------------------------------------------------------
[privacy]
shielded_enabled           = true
proof_system               = "plonk"          # или "halo2"; фактическая реализация в zk/*
max_proof_size_bytes       = 65536
nullifier_set_size_hint    = 33554432         # hint для параметров zk-схем

# -----------------------------------------------------------------------------
# Адреса системных контрактов/пулов (если применимо).
# -----------------------------------------------------------------------------
[system_contracts]
governance_address         = "aev1qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqgov"
token_address              = "aev1qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqtok"
privacy_verifier_address   = "aev1qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqzkv"
bridge_portal_address      = "aev1qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqbrg"

# -----------------------------------------------------------------------------
# Параметры валидаторов/стейкинга на уровне протокола.
# -----------------------------------------------------------------------------
[validators]
# Жёсткий лимит валидаторов в активном наборе (для BFT-окна).
max_active_validators = 150
# Минимальный стейк для участия (AEV).
min_stake = "10000.00000000"
# Слешинг: проценты/условия на уровне протокола.
[validators.slashing]
downtime_pct   = 0.01
double_sign_pct= 0.05
evidence_max_age_blocks = 100000

# -----------------------------------------------------------------------------
# Политики апгрейда протокола (chain governance / hard fork gates).
# -----------------------------------------------------------------------------
[upgrades]
# Разрешённые типы апгрейдов: "param-only", "stateful", "hard-fork".
allowed = ["param-only", "stateful", "hard-fork"]
# Минимальный период оповещения перед активацией параметрического апгрейда.
notice_period_blocks = 216000  # ~5 суток при 2с
# Хардфорк активируется только по зафиксированному высотному номеру (H-номер).
hard_fork_activation_height = 0  # 0 => не запланирован

# -----------------------------------------------------------------------------
# Контроль целостности: референсные хэши генезиса/цепочки для быстрой проверки.
# -----------------------------------------------------------------------------
[integrity]
# Хэш genesis.json после нормализации (канонический порядок полей).
genesis_canonical_hash = ""     # заполняется CI при релизе
# Ожидаемый формат коммитментов блока (информативно).
block_commitment_scheme = "merkle-root(v1)"

# -----------------------------------------------------------------------------
# Профиль BTC 2.0 (информативно; потребляется сборкой и tooling).
# -----------------------------------------------------------------------------
[profile]
name            = "btc2"
finality_gadget = true
parallel_exec   = true
zk_privacy      = true

# =============================================================================
# Раздел «prod hardening»: для production окружений рекомендуется:
#  - Пометить файл read-only и подписывать артефакты (SLSA provenance).
#  - Использовать deterministic build (Cargo.lock, -Zdeny-warnings в CI).
#  - Фиксировать значения адресов системных контрактов и treasury.
# =============================================================================
[hardening]
read_only_required      = true
slsa_provenance_required= true
deny_warnings_in_ci     = true
