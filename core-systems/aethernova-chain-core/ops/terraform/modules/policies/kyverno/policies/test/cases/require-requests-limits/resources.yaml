---
apiVersion: v1
kind: Namespace
metadata:
  name: dev-app
  labels:
    environment: dev
    app.kubernetes.io/part-of: aethernova-chain-core
---
# Позитив: Pod с корректными requests/limits у всех контейнеров и initContainers
apiVersion: v1
kind: Pod
metadata:
  name: pod-valid-rr
  namespace: dev-app
spec:
  initContainers:
    - name: init-a
      image: busybox:1.36
      command: ["sh", "-c", "echo init"]
      resources:
        requests:
          cpu: "50m"
          memory: "64Mi"
        limits:
          cpu: "200m"
          memory: "128Mi"
  containers:
    - name: app
      image: nginx:1.27
      resources:
        requests:
          cpu: "100m"
          memory: "128Mi"
        limits:
          cpu: "300m"
          memory: "256Mi"
---
# Негатив: отсутствуют limits у основного контейнера
apiVersion: v1
kind: Pod
metadata:
  name: pod-missing-limits
  namespace: dev-app
spec:
  containers:
    - name: app
      image: nginx:1.27
      resources:
        requests:
          cpu: "100m"
          memory: "128Mi"
  initContainers:
    - name: init-a
      image: busybox:1.36
      command: ["sh", "-c", "echo init"]
      resources:
        requests:
          cpu: "25m"
          memory: "32Mi"
        limits:
          cpu: "100m"
          memory: "64Mi"
---
# Негатив: отсутствуют requests у initContainer
apiVersion: v1
kind: Pod
metadata:
  name: pod-missing-requests-init
  namespace: dev-app
spec:
  initContainers:
    - name: init-a
      image: busybox:1.36
      command: ["sh", "-c", "echo init"]
      resources:
        limits:
          cpu: "100m"
          memory: "64Mi"
  containers:
    - name: app
      image: nginx:1.27
      resources:
        requests:
          cpu: "100m"
          memory: "128Mi"
        limits:
          cpu: "300m"
          memory: "256Mi"
---
# Позитив: Deployment с корректными requests/limits
apiVersion: apps/v1
kind: Deployment
metadata:
  name: deploy-valid-rr
  namespace: dev-app
spec:
  replicas: 1
  selector:
    matchLabels:
      app: web
  template:
    metadata:
      labels:
        app: web
    spec:
      initContainers:
        - name: init-a
          image: busybox:1.36
          command: ["sh", "-c", "echo init"]
          resources:
            requests:
              cpu: "25m"
              memory: "32Mi"
            limits:
              cpu: "100m"
              memory: "64Mi"
      containers:
        - name: app
          image: nginx:1.27
          resources:
            requests:
              cpu: "150m"
              memory: "192Mi"
            limits:
              cpu: "400m"
              memory: "384Mi"
---
# Негатив: Deployment без memory limits
apiVersion: apps/v1
kind: Deployment
metadata:
  name: deploy-missing-limits
  namespace: dev-app
spec:
  replicas: 1
  selector:
    matchLabels:
      app: api
  template:
    metadata:
      labels:
        app: api
    spec:
      containers:
        - name: api
          image: ghcr.io/aethernova/fake-api:0.1.0
          resources:
            requests:
              cpu: "200m"
              memory: "256Mi"
            limits:
              cpu: "500m"
              # memory отсутствует — ожидается нарушение политики
---
# Позитив: Pod с ephemeralContainers, все имеют requests/limits
apiVersion: v1
kind: Pod
metadata:
  name: pod-with-ephemeral
  namespace: dev-app
spec:
  containers:
    - name: app
      image: nginx:1.27
      resources:
        requests:
          cpu: "100m"
          memory: "128Mi"
        limits:
          cpu: "300m"
          memory: "256Mi"
  ephemeralContainers:
    - name: debugger
      image: busybox:1.36
      targetContainerName: app
      command: ["sh"]
      stdin: true
      tty: true
      resources:
        requests:
          cpu: "25m"
          memory: "32Mi"
        limits:
          cpu: "100m"
          memory: "64Mi"
---
# Ресурс в kube-system: при наличии исключений в политике не должен нарушать (негатив для политики, позитив для теста исключений)
apiVersion: v1
kind: Pod
metadata:
  name: sys-pod-without-resources
  namespace: kube-system
spec:
  containers:
    - name: c
      image: busybox:1.36
      command: ["sh", "-c", "sleep 3600"]
      # нет requests/limits — должен быть пропущен политикой, если kube-system исключён
