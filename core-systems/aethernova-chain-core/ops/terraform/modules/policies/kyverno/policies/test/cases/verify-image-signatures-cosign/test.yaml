apiVersion: cli.kyverno.io/v1alpha1
kind: Test
metadata:
  name: verify-image-signatures-cosign
policies:
  # Относительный путь до политики проверки подписей образов.
  - ../../../clusterpolicies/supply-chain/verify-image-signatures-cosign.yaml

# Ресурсы-фикстуры (Pods) с разными вариантами образов:
#  - resources/pod-signed.yaml                -> ghcr.io/kyverno/test-verify-image:signed
#  - resources/pod-unsigned.yaml              -> ghcr.io/kyverno/test-verify-image:unsigned
#  - resources/pod-signed-other-key.yaml      -> ghcr.io/kyverno/test-verify-image:signed-by-someone-else
resources:
  - resources/pod-signed.yaml
  - resources/pod-unsigned.yaml
  - resources/pod-signed-other-key.yaml

# Ожидаемые результаты:
# Предполагается, что в политике имя (metadata.name) = "verify-image-signatures-cosign",
# а у правила (spec.rules[].name) = "verify-image" (как в официальных примерах).
results:
  - policy: verify-image-signatures-cosign
    rule: verify-image
    resource: pod-signed
    kind: Pod
    result: pass

  - policy: verify-image-signatures-cosign
    rule: verify-image
    resource: pod-unsigned
    kind: Pod
    result: fail

  - policy: verify-image-signatures-cosign
    rule: verify-image
    resource: pod-signed-other-key
    kind: Pod
    result: fail
