# Path: aethernova-chain-core/ops/terraform/modules/policies/gatekeeper/mutations/modifyset/kustomization.yaml
# Purpose: Industrial-grade Kustomize entrypoint for Gatekeeper ModifySet mutations.
# Notes:
# - Includes all YAMLs from ./modifyset/ directory (cluster-scoped resources are supported).
# - Adds consistent labels/annotations for auditability and provenance.
# - Avoids name hashing (none of the resources here use generators).
# - Safe for idempotent GitOps pipelines.

apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Namespace is ignored for cluster-scoped resources (Gatekeeper mutations are cluster-scoped),
# but we set it for consistency and future namespaced additions.
namespace: gatekeeper-system

# Provide a clear prefix to distinguish Aethernova policies in cluster inventories.
namePrefix: aethernova-

# Add build-time metadata to track origin and management.
buildMetadata:
  - originAnnotations
  - managedByLabel

# Common labels applied to all rendered resources.
commonLabels:
  app.kubernetes.io/name: gatekeeper-mutations
  app.kubernetes.io/component: modifyset
  app.kubernetes.io/part-of: aethernova-chain-core
  app.kubernetes.io/managed-by: kustomize
  app.kubernetes.io/version: "v1"
  org.aethernova.module: policies
  org.aethernova.submodule: gatekeeper
  org.aethernova.layer: ops

# Common annotations for provenance/audit.
commonAnnotations:
  org.aethernova.owner: "platform-security-core"
  org.aethernova.repo: "aethernova-chain-core"
  org.aethernova.path: "ops/terraform/modules/policies/gatekeeper/mutations/modifyset"
  org.aethernova.change-control: "gitops"
  org.aethernova.slsa.provenance: "attestations-enabled"
  org.aethernova.policy.reviewed: "true"

# Include all manifests from the local subdirectory.
# Kustomize accepts directories in 'resources' and will load all *.yaml/*.yml within.
resources:
  - .

# Optional label transformer for stricter propagation semantics.
labels:
  - includeSelectors: false
    includeTemplates: true
    pairs:
      policy.aethernova.io/type: mutation
      policy.aethernova.io/kind: ModifySet

# Strategic patches can be added here to enforce organization-wide invariants
# on all ModifySet objects without editing each file. Example (commented):
# patches:
#   - target:
#       group: mutations.gatekeeper.sh
#       version: v1beta1
#       kind: ModifySet
#       name: .*
#     patch: |-
#       - op: add
#         path: /metadata/annotations/policy.aethernova.io~1enforced
#         value: "true"

# Kustomize configurations (uncomment if you add custom fields requiring name/namespace resolution)
# configurations:
#   - kustomizeconfig.yaml

# Generator options are declared here for completeness (not used by ModifySet manifests).
generatorOptions:
  disableNameSuffixHash: true
  labels:
    generator.aethernova.io/enabled: "false"

# Sorting options can help produce stable diffs across CI runs.
# Uncomment if your pipeline benefits from legacy order.
# sortOptions:
#   order: legacy
