# aethernova-chain-core/ops/terraform/modules/policies/gatekeeper/mutations/assign/kustomization.yaml
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# В этом каталоге размещаются только Cluster-scoped манифесты Gatekeeper Mutations (kind: Assign).
# Именование файлов рекомендуется в формате: assign-<purpose>.yaml
# Примеры ниже можно удалить/дополнить под ваш набор правил.

resources:
  - assign-default-securitycontext.yaml
  - assign-enforce-run-as-nonroot.yaml
  - assign-default-imagepullpolicy.yaml
  - assign-default-probes.yaml
  - assign-add-tolerations.yaml
  - assign-add-nodeaffinity.yaml
  - assign-add-topologyspreadconstraints.yaml
  - assign-propagate-namespace-labels.yaml

# Единые метки для наблюдаемости, трассировки и инвентаризации.
commonLabels:
  app.kubernetes.io/name: gatekeeper-policies
  app.kubernetes.io/instance: gatekeeper-policies
  app.kubernetes.io/part-of: aethernova-chain-core
  app.kubernetes.io/component: policies
  app.kubernetes.io/version: v1
  policy.aethernova.io/bundle: gatekeeper-mutations
  policy.aethernova.io/type: assign
  gatekeeper.sh/mutation: "assign"

# Единые аннотации: происхождение, соответствие и владельцы.
commonAnnotations:
  policy.aethernova.io/owner: "platform-security-core"
  policy.aethernova.io/source: "ops/terraform/modules/policies/gatekeeper/mutations/assign"
  policy.aethernova.io/compliance: "baseline"
  policy.aethernova.io/managed-by: "kustomize"
  policy.aethernova.io/change-control: "gitops"

# Опции генераторов (на будущее, если добавите generators).
generatorOptions:
  disableNameSuffixHash: true
  labels:
    app.kubernetes.io/managed-by: kustomize
    policy.aethernova.io/generator: "true"
  annotations:
    policy.aethernova.io/generator-note: "hash disabled for deterministic refs"

# Патчи-замены (необязательно): пример гарантирует,
# что все Assign получают те же метки/аннотации на верхнем уровне, даже если файлы не содержат их.
# Оставлено как шаблон: раскомментируйте при необходимости.
# patches:
#   - target:
#       group: mutations.gatekeeper.sh
#       version: v1alpha1
#       kind: Assign
#     patch: |-
#       - op: add
#         path: /metadata/labels
#         value:
#           policy.aethernova.io/sync: "true"
#       - op: add
#         path: /metadata/annotations/policy.aethernova.io/last-reviewed
#         value: "2025-09-12"

# Ограничение namespace умышленно не задаётся: ресурсы Assign — cluster-scoped,
# и должны применяться на уровне кластера (Gatekeeper контролирует их из gatekeeper-system).
# Namespace в таких ресурсах будет проигнорирован Kubernetes API.
