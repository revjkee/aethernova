# File: aethernova-chain-core/ops/terraform/modules/policies/gatekeeper/mutations/assignmetadata/ kustomization.yaml
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Включаем все манифесты мутаций AssignMetadata.
# Имена файлов примерные — держите их рядом с этим kustomization.yaml.
# Каждый файл должен содержать объект sh.gatekeeper.mutations.v1beta1.AssignMetadata.
resources:
  - mutation-add-standard-labels.yaml
  - mutation-add-ops-annotations.yaml
  - mutation-add-namespace-owner-label.yaml

# Единые метки для трассировки и аудита. Применяются ко всем ресурсам.
commonLabels:
  app.kubernetes.io/part-of: aethernova-chain-core
  app.kubernetes.io/component: policy-mutation
  app.kubernetes.io/managed-by: kustomize
  gatekeeper.sh/policy-scope: assignmetadata

# Дополнительный LabelTransformer для включения меток также в selectors/templates, где это допустимо.
labels:
  - pairs:
      app.kubernetes.io/instance: chain-core
    includeSelectors: true
    includeTemplates: true

# Общие аннотации (например, для ссылок на репозиторий и практики).
commonAnnotations:
  policies.aethernova.io/source: gitops
  policies.aethernova.io/owner: platform-security
  policies.aethernova.io/description: "Gatekeeper AssignMetadata mutations for default labels/annotations"

# Настройки генераторов (если позже добавите configMapGenerator/secretGenerator).
generatorOptions:
  disableNameSuffixHash: true

# Строгая проверка путей. Если в будущих overlay вы используете компоненты, включите ignoreMissingComponents: true.
# components:
#   - ../../components/some-shared-transformer
# patches: []  # Патчи не требуются для базовой сборки AssignMetadata.

# Замечание:
# AssignMetadata — кластерные ресурсы (cluster-scoped). Не указываем namespace здесь, чтобы не подменять его.
# Kustomize корректно применит commonLabels/commonAnnotations без изменения области видимости.
