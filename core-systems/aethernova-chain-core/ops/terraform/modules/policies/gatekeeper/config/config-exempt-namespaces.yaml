# path: aethernova-chain-core/ops/terraform/modules/policies/gatekeeper/config/config-exempt-namespaces.yaml
apiVersion: config.gatekeeper.sh/v1alpha1
kind: Config
metadata:
  name: config
  labels:
    app.kubernetes.io/name: gatekeeper-config
    app.kubernetes.io/part-of: aethernova-chain-core
    app.kubernetes.io/component: policy
    app.kubernetes.io/managed-by: terraform
  annotations:
    # Изменяйте список исключений осознанно: уберите неймспейс из списка,
    # если хотите, чтобы на него распространялись политики.
    policy.aethernova.io/owner: "platform-security-core"
    policy.aethernova.io/description: "Глобальные исключения неймспейсов и оптимизация sync для Gatekeeper"
spec:
  # Глобальные исключения для обоих процессов Gatekeeper:
  #  - webhook  (валидация/превентион при создании/обновлении)
  #  - audit    (периодическая проверка существующих объектов)
  match:
    - excludedNamespaces:
        - kube-system
        - gatekeeper-system
        - kube-public
        - kube-node-lease
        - cert-manager
        - istio-system
        - monitoring
        - logging
        - ingress-nginx
        - metallb-system
        - local-path-storage
        - velero
        - argo
        - argo-rollouts
        - argo-events
        - argocd
        - kubernetes-dashboard
        - longhorn-system
        - rook-ceph
        - flux-system
        - tigera-operator
        - calico-system
        - openebs
        - nvidia-gpu-operator
        - kyverno
      processes:
        - "webhook"
        - "audit"

  # Ограничение набора синхронизируемых ресурсов для аудита (снижение нагрузки на cache).
  # Добавляйте сюда только те виды, к которым реально привязаны ваши Constraints.
  sync:
    syncOnly:
      - group: ""
        version: v1
        kind: Namespace
      - group: ""
        version: v1
        kind: Pod
      - group: ""
        version: v1
        kind: Service
      - group: ""
        version: v1
        kind: PersistentVolumeClaim
      - group: apps
        version: v1
        kind: Deployment
      - group: apps
        version: v1
        kind: StatefulSet
      - group: apps
        version: v1
        kind: DaemonSet
      - group: networking.k8s.io
        version: v1
        kind: Ingress
      - group: batch
        version: v1
        kind: Job
      - group: batch
        version: v1
        kind: CronJob
      - group: rbac.authorization.k8s.io
        version: v1
        kind: Role
      - group: rbac.authorization.k8s.io
        version: v1
        kind: RoleBinding
      - group: rbac.authorization.k8s.io
        version: v1
        kind: ClusterRole
      - group: rbac.authorization.k8s.io
        version: v1
        kind: ClusterRoleBinding
      - group: ""
        version: v1
        kind: ServiceAccount
      - group: ""
        version: v1
        kind: ConfigMap
