# aethernova-chain-core/ops/terraform/modules/policies/gatekeeper/constraints/prod/networking/kustomization.yaml
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Явно перечисляем инстансы Constraints (Cluster-scoped).
# Создайте соответствующие файлы в этом же каталоге.
resources:
  - constraint-disallow-external-loadbalancer.yaml
  - constraint-require-networkpolicy.yaml
  - constraint-restrict-nodeport.yaml
  - constraint-restrict-ingress-wildcard-hosts.yaml
  - constraint-enforce-ingress-tls.yaml
  - constraint-disallow-public-services.yaml
  - constraint-limit-lb-source-ranges.yaml
  - constraint-disallow-host-network.yaml
  - constraint-disallow-hostpath-volumes.yaml
  - constraint-disallow-privileged-containers.yaml

# Единые метки для трассируемости и соответствия политикам организации.
commonLabels:
  app.kubernetes.io/part-of: aethernova-chain-core
  app.kubernetes.io/managed-by: kustomize
  policy.engine: gatekeeper
  policy.domain: networking
  environment: prod

# Аннотации для аудита и воспроизводимости.
commonAnnotations:
  policy.aethernova.io/owner: platform-security
  policy.aethernova.io/review: "true"
  policy.aethernova.io/change-request: "required"
  policy.aethernova.io/tier: "critical"
  vcs.repo: "git@repo:aethernova-chain-core.git"
  vcs.path: "ops/terraform/modules/policies/gatekeeper/constraints/prod/networking"
  deploy.intent: "enforce"

# Жёсткое требование на отсутствие пропущенных файлов — сборка должна быть детерминирована.
generatorOptions:
  disableNameSuffixHash: true

# Возможные стратегические патчи можно подключать здесь (оставлено на будущее).
# patchesStrategicMerge:
#   - patches/additional-annotations.yaml
