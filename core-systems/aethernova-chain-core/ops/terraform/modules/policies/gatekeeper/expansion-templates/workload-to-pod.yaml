# -----------------------------------------------------------------------------
# ExpansionTemplate: Workloads -> Pod
# Назначение: применять pod-ориентированные политики Gatekeeper к workload-ресурсам
# Официальная спецификация и пример полей (applyTo, templateSource, generatedGVK):
# https://open-policy-agent.github.io/gatekeeper/website/docs/expansion/  (v3.20.x)
# -----------------------------------------------------------------------------
apiVersion: expansion.gatekeeper.sh/v1alpha1
kind: ExpansionTemplate
metadata:
  name: workloads-expand-to-pod
  labels:
    app.kubernetes.io/name: gatekeeper-expansion
    app.kubernetes.io/component: workload-to-pod
    app.kubernetes.io/part-of: aethernova-chain-core
  annotations:
    # Документация: Validating Workload Resources using ExpansionTemplate
    # https://open-policy-agent.github.io/gatekeeper/website/docs/expansion/
    openpolicyagent.org/reference: "gatekeeper-expansion-workload-to-pod"
spec:
  # applyTo: указывает родительские GVK, которые будут «разворачиваться» в целевой GVK
  applyTo:
    # apps/v1 контроллеры, создающие Pod из spec.template
    - groups: ["apps"]
      versions: ["v1"]
      kinds: ["Deployment", "DaemonSet", "ReplicaSet", "StatefulSet"]
    # core/v1 ReplicationController
    - groups: [""]
      versions: ["v1"]
      kinds: ["ReplicationController"]
    # batch/v1 Job
    - groups: ["batch"]
      versions: ["v1"]
      kinds: ["Job"]
  # Путь к PodSpec-шаблону внутри родителя (см. официальные примеры)
  # Для всех ресурсов выше Pod берётся из .spec.template
  templateSource: "spec.template"
  # Целевая GVK, к которой применяются pod-политики
  generatedGVK:
    group: ""
    version: "v1"
    kind: "Pod"

---
# -----------------------------------------------------------------------------
# ExpansionTemplate: CronJob -> Job
# Назначение: охватить CronJob. CronJob создаёт Job из spec.jobTemplate.
# Далее Job подпадает под первый шаблон (Job -> Pod через spec.template).
# Документация по механизму ExpansionTemplate: см. ссылку выше.
# -----------------------------------------------------------------------------
apiVersion: expansion.gatekeeper.sh/v1alpha1
kind: ExpansionTemplate
metadata:
  name: cronjob-expand-to-job
  labels:
    app.kubernetes.io/name: gatekeeper-expansion
    app.kubernetes.io/component: cronjob-to-job
    app.kubernetes.io/part-of: aethernova-chain-core
  annotations:
    openpolicyagent.org/reference: "gatekeeper-expansion-cronjob-to-job"
spec:
  applyTo:
    - groups: ["batch"]
      versions: ["v1"]
      kinds: ["CronJob"]
  # Для CronJob источник — .spec.jobTemplate (а не .spec.template)
  templateSource: "spec.jobTemplate"
  generatedGVK:
    group: "batch"
    version: "v1"
    kind: "Job"

# -----------------------------------------------------------------------------
# Пояснения:
# 1) Валидация выполняется как в вебхуке (admission), так и в аудите. См. доку.  # 

Не могу подтвердить никаких дополнительных, не указанных в доке, полей/возможностей за пределами приведенных источников.
::contentReference[oaicite:10]{index=10}
