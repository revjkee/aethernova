{
  "title": "Top-K ${metric} by ${by}",
  "type": "table",
  "datasource": {
    "type": "prometheus",
    "uid": "${DS_PROMETHEUS}"
  },
  "pluginVersion": "11.x",
  "targets": [
    {
      "refId": "A",
      "editorMode": "code",
      "datasource": {
        "type": "prometheus",
        "uid": "${DS_PROMETHEUS}"
      },
      "expr": "topk($topk, sum by ($by) (rate(${metric:raw}[$__rate_interval])))",
      "legendFormat": "{{${by}}}",
      "instant": true,
      "range": false
    }
  ],
  "fieldConfig": {
    "defaults": {
      "unit": "short",
      "mappings": [],
      "thresholds": {
        "mode": "absolute",
        "steps": [
          { "color": "green" },
          { "color": "red", "value": 0 }
        ]
      },
      "custom": {
        "align": "auto",
        "displayMode": "auto",
        "filterable": true
      }
    },
    "overrides": [
      {
        "matcher": { "id": "byName", "options": "Value" },
        "properties": [
          { "id": "custom.align", "value": "right" },
          { "id": "unit", "value": "short" }
        ]
      }
    ]
  },
  "options": {
    "showHeader": true,
    "cellHeight": "sm",
    "footer": { "show": false }
  },
  "transparent": false
}
