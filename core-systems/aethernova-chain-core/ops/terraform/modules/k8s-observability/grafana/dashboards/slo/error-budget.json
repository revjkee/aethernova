{
  "id": null,
  "uid": "slo-error-budget-aethernova",
  "title": "SLO Error Budget & Burn Rate (Aethernova)",
  "schemaVersion": 39,
  "version": 1,
  "style": "dark",
  "editable": true,
  "tags": ["slo", "sli", "error-budget", "burn-rate", "prometheus"],
  "time": { "from": "now-6h", "to": "now" },
  "timepicker": { "refresh_intervals": ["10s","30s","1m","5m","15m","1h"], "time_options": ["1h","6h","12h","24h","3d","7d","28d"] },
  "annotations": { "list": [ { "builtIn": 1, "type": "dashboard", "name": "Annotations & Alerts", "enable": true, "hide": true } ] },
  "templating": {
    "list": [
      {
        "type": "datasource",
        "name": "DS_PROMETHEUS",
        "label": "Prometheus",
        "query": "prometheus",
        "hide": 0
      },
      {
        "type": "textbox",
        "name": "slo_goal",
        "label": "SLO target (%)",
        "query": "99.9"
      },
      {
        "type": "textbox",
        "name": "slo_window_days",
        "label": "SLO window (days)",
        "query": "30"
      },
      {
        "type": "textbox",
        "name": "service_selector",
        "label": "Label selectors (inside {...})",
        "query": "job=~\".*\""
      },
      {
        "type": "textbox",
        "name": "total_metric",
        "label": "Total counter metric",
        "query": "requests_total_count"
      },
      {
        "type": "textbox",
        "name": "error_metric",
        "label": "Error counter metric",
        "query": "requests_error_count"
      }
    ]
  },
  "panels": [
    {
      "type": "row",
      "title": "SLO Summary",
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 }
    },
    {
      "type": "stat",
      "title": "SLO target",
      "datasource": "$DS_PROMETHEUS",
      "gridPos": { "h": 3, "w": 4, "x": 0, "y": 1 },
      "fieldConfig": { "defaults": { "unit": "percent", "decimals": 3 } },
      "options": { "reduceOptions": { "calcs": ["lastNotNull"] } },
      "targets": [ { "expr": "vector($slo_goal)" } ]
    },
    {
      "type": "stat",
      "title": "Error budget total (%)",
      "datasource": "$DS_PROMETHEUS",
      "gridPos": { "h": 3, "w": 4, "x": 4, "y": 1 },
      "fieldConfig": { "defaults": { "unit": "percent", "decimals": 3 } },
      "options": { "reduceOptions": { "calcs": ["lastNotNull"] } },
      "targets": [ { "expr": "vector(100 - $slo_goal)" } ]
    },
    {
      "type": "stat",
      "title": "Error budget remaining (%)",
      "description": "100 * max(0, 1 - (error_ratio / (1 - SLO))) over SLO window",
      "datasource": "$DS_PROMETHEUS",
      "gridPos": { "h": 3, "w": 8, "x": 8, "y": 1 },
      "fieldConfig": { "defaults": { "unit": "percent", "decimals": 2 } },
      "options": { "reduceOptions": { "calcs": ["lastNotNull"] } },
      "targets": [
        {
          "expr": "100 * clamp_min( 1 - ( ( sum(increase(${error_metric}{${service_selector}}[${slo_window_days}d])) / sum(increase(${total_metric}{${service_selector}}[${slo_window_days}d])) ) / (1 - $slo_goal/100) , 0)"
        }
      ]
    },
    {
      "type": "stat",
      "title": "ETA to budget exhaustion (hours, ~1h BR)",
      "description": "Approx ETA = (remaining_fraction * window_hours) / burn_rate_1h",
      "datasource": "$DS_PROMETHEUS",
      "gridPos": { "h": 3, "w": 8, "x": 16, "y": 1 },
      "fieldConfig": { "defaults": { "unit": "h", "decimals": 1 } },
      "options": { "reduceOptions": { "calcs": ["lastNotNull"] } },
      "targets": [
        {
          "expr": "( ( clamp_min( 1 - ( ( sum(increase(${error_metric}{${service_selector}}[${slo_window_days}d])) / sum(increase(${total_metric}{${service_selector}}[${slo_window_days}d])) ) / (1 - $slo_goal/100) , 0) ) * vector($slo_window_days*24) ) / clamp_min( ( sum(rate(${error_metric}{${service_selector}}[1h])) / sum(rate(${total_metric}{${service_selector}}[1h])) ) / (1 - $slo_goal/100) , 0.0001) "
        }
      ]
    },

    {
      "type": "row",
      "title": "Burn Rates (multi-window)",
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 4 }
    },
    {
      "type": "timeseries",
      "title": "Burn rate (1h, threshold 14.4×)",
      "datasource": "$DS_PROMETHEUS",
      "gridPos": { "h": 6, "w": 12, "x": 0, "y": 5 },
      "fieldConfig": {
        "defaults": {
          "unit": "none",
          "decimals": 2,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "green", "value": null },
              { "color": "red",   "value": 14.4 }
            ]
          }
        }
      },
      "options": { "legend": { "displayMode": "list", "placement": "bottom" } },
      "targets": [
        {
          "expr": "( sum(rate(${error_metric}{${service_selector}}[1h])) / sum(rate(${total_metric}{${service_selector}}[1h])) ) / (1 - $slo_goal/100)",
          "legendFormat": "BR 1h"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Burn rate (6h, threshold 6×)",
      "datasource": "$DS_PROMETHEUS",
      "gridPos": { "h": 6, "w": 12, "x": 12, "y": 5 },
      "fieldConfig": {
        "defaults": {
          "unit": "none",
          "decimals": 2,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "green", "value": null },
              { "color": "red",   "value": 6 }
            ]
          }
        }
      },
      "options": { "legend": { "displayMode": "list", "placement": "bottom" } },
      "targets": [
        {
          "expr": "( sum(rate(${error_metric}{${service_selector}}[6h])) / sum(rate(${total_metric}{${service_selector}}[6h])) ) / (1 - $slo_goal/100)",
          "legendFormat": "BR 6h"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Short-window confirmation BR (5m & 30m)",
      "description": "Для multiwindow: 1h↔5m и 6h↔30m подтверждение",
      "datasource": "$DS_PROMETHEUS",
      "gridPos": { "h": 6, "w": 24, "x": 0, "y": 11 },
      "fieldConfig": { "defaults": { "unit": "none", "decimals": 2 } },
      "options": { "legend": { "displayMode": "list", "placement": "bottom" } },
      "targets": [
        {
          "expr": "( sum(rate(${error_metric}{${service_selector}}[5m])) / sum(rate(${total_metric}{${service_selector}}[5m])) ) / (1 - $slo_goal/100)",
          "legendFormat": "BR 5m"
        },
        {
          "expr": "( sum(rate(${error_metric}{${service_selector}}[30m])) / sum(rate(${total_metric}{${service_selector}}[30m])) ) / (1 - $slo_goal/100)",
          "legendFormat": "BR 30m"
        }
      ]
    },

    {
      "type": "row",
      "title": "Error Ratio & Budget Trend",
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 17 }
    },
    {
      "type": "timeseries",
      "title": "Error ratio (5m rate)",
      "datasource": "$DS_PROMETHEUS",
      "gridPos": { "h": 6, "w": 12, "x": 0, "y": 18 },
      "fieldConfig": { "defaults": { "unit": "percentunit", "decimals": 3 } },
      "options": { "legend": { "displayMode": "list", "placement": "bottom" } },
      "targets": [
        {
          "expr": "sum(rate(${error_metric}{${service_selector}}[5m])) / sum(rate(${total_metric}{${service_selector}}[5m]))",
          "legendFormat": "error_ratio (5m)"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Budget consumed over window (%)",
      "description": "100 * BR * (window / SLO_period)",
      "datasource": "$DS_PROMETHEUS",
      "gridPos": { "h": 6, "w": 12, "x": 12, "y": 18 },
      "fieldConfig": { "defaults": { "unit": "percent", "decimals": 2 } },
      "options": { "legend": { "displayMode": "list", "placement": "bottom" } },
      "targets": [
        {
          "expr": "100 * ( ( sum(rate(${error_metric}{${service_selector}}[1h])) / sum(rate(${total_metric}{${service_selector}}[1h])) ) / (1 - $slo_goal/100) ) / vector($slo_window_days*24)",
          "legendFormat": "1h window"
        },
        {
          "expr": "100 * ( ( sum(rate(${error_metric}{${service_selector}}[6h])) / sum(rate(${total_metric}{${service_selector}}[6h])) ) / (1 - $slo_goal/100) ) * vector(6) / vector($slo_window_days*24)",
          "legendFormat": "6h window"
        },
        {
          "expr": "100 * ( ( sum(rate(${error_metric}{${service_selector}}[3d])) / sum(rate(${total_metric}{${service_selector}}[3d])) ) / (1 - $slo_goal/100) ) * vector(72) / vector($slo_window_days*24)",
          "legendFormat": "3d window"
        }
      ]
    },

    {
      "type": "row",
      "title": "Inputs (debug)",
      "collapsed": true,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 24 }
    },
    {
      "type": "stat",
      "title": "Total events (SLO window)",
      "datasource": "$DS_PROMETHEUS",
      "gridPos": { "h": 3, "w": 6, "x": 0, "y": 25 },
      "fieldConfig": { "defaults": { "unit": "short" } },
      "targets": [ { "expr": "sum(increase(${total_metric}{${service_selector}}[${slo_window_days}d]))" } ]
    },
    {
      "type": "stat",
      "title": "Error events (SLO window)",
      "datasource": "$DS_PROMETHEUS",
      "gridPos": { "h": 3, "w": 6, "x": 6, "y": 25 },
      "fieldConfig": { "defaults": { "unit": "short" } },
      "targets": [ { "expr": "sum(increase(${error_metric}{${service_selector}}[${slo_window_days}d]))" } ]
    },
    {
      "type": "stat",
      "title": "Error ratio (SLO window) %",
      "datasource": "$DS_PROMETHEUS",
      "gridPos": { "h": 3, "w": 6, "x": 12, "y": 25 },
      "fieldConfig": { "defaults": { "unit": "percentunit", "decimals": 3 } },
      "targets": [
        { "expr": "100 * ( sum(increase(${error_metric}{${service_selector}}[${slo_window_days}d])) / sum(increase(${total_metric}{${service_selector}}[${slo_window_days}d])) )" }
      ]
    },
    {
      "type": "stat",
      "title": "Budget used (SLO window) %",
      "datasource": "$DS_PROMETHEUS",
      "gridPos": { "h": 3, "w": 6, "x": 18, "y": 25 },
      "fieldConfig": { "defaults": { "unit": "percent", "decimals": 2 } },
      "targets": [
        { "expr": "100 * ( ( sum(increase(${error_metric}{${service_selector}}[${slo_window_days}d])) / sum(increase(${total_metric}{${service_selector}}[${slo_window_days}d])) ) / (1 - $slo_goal/100) )" }
      ]
    }
  ]
}
