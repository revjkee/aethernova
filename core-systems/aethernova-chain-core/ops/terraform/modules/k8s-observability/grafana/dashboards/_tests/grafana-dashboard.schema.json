{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://aethernova.io/schemas/grafana-dashboard.schema.json",
  "title": "Grafana Dashboard (Aethernova hardened)",
  "type": "object",
  "additionalProperties": true,
  "required": ["title", "schemaVersion", "panels", "templating"],
  "properties": {
    "uid": { "type": ["string", "null"], "maxLength": 128 },
    "id": { "type": ["integer", "null"] },
    "title": { "type": "string", "minLength": 1 },
    "schemaVersion": { "type": "integer", "minimum": 1 },
    "version": { "type": ["integer", "null"], "minimum": 0 },
    "editable": { "type": ["boolean", "null"] },
    "style": { "type": ["string", "null"] },
    "timezone": { "type": ["string", "null"] },
    "refresh": { "type": ["string", "null"], "pattern": "^(off|\\d+(ms|s|m|h|d))$" },
    "tags": { "type": "array", "items": { "type": "string" } },
    "graphTooltip": { "type": ["integer", "null"], "enum": [0, 1, 2, null] },
    "time": {
      "type": "object",
      "additionalProperties": false,
      "required": ["from", "to"],
      "properties": {
        "from": { "type": "string", "minLength": 1 },
        "to": { "type": "string", "minLength": 1 }
      }
    },
    "timepicker": {
      "type": "object",
      "additionalProperties": true,
      "properties": {
        "refresh_intervals": { "type": "array", "items": { "type": "string" } },
        "hidden": { "type": ["boolean", "null"] }
      }
    },
    "links": {
      "type": "array",
      "items": { "$ref": "#/$defs/link" }
    },
    "annotations": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "list": {
          "type": "array",
          "items": { "$ref": "#/$defs/annotation" }
        }
      }
    },
    "templating": {
      "type": "object",
      "additionalProperties": false,
      "required": ["list"],
      "properties": {
        "list": {
          "type": "array",
          "items": { "$ref": "#/$defs/variable" }
        }
      }
    },
    "panels": {
      "type": "array",
      "items": { "$ref": "#/$defs/panel" }
    },
    "fiscalYearStartMonth": { "type": ["integer", "null"], "minimum": 0, "maximum": 12 },
    "weekStart": { "type": ["string", "null"] }
  },

  "$defs": {
    "gridPos": {
      "type": "object",
      "additionalProperties": false,
      "required": ["h", "w", "x", "y"],
      "properties": {
        "h": { "type": "integer", "minimum": 1 },
        "w": { "type": "integer", "minimum": 1 },
        "x": { "type": "integer", "minimum": 0 },
        "y": { "type": "integer", "minimum": 0 }
      }
    },

    "datasource": {
      "type": ["object", "string", "null"],
      "additionalProperties": true,
      "properties": {
        "type": { "type": "string" },
        "uid": { "type": "string" }
      }
    },

    "thresholds": {
      "type": "object",
      "additionalProperties": false,
      "required": ["mode", "steps"],
      "properties": {
        "mode": { "type": "string", "enum": ["absolute", "percentage"] },
        "steps": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "additionalProperties": true,
            "properties": {
              "color": { "type": "string" },
              "value": { "type": ["number", "null"] }
            }
          }
        }
      }
    },

    "fieldConfig": {
      "type": "object",
      "additionalProperties": true,
      "properties": {
        "defaults": {
          "type": "object",
          "additionalProperties": true,
          "properties": {
            "unit": { "type": ["string", "null"] },
            "min": { "type": ["number", "null"] },
            "max": { "type": ["number", "null"] },
            "decimals": { "type": ["integer", "null"], "minimum": 0 },
            "color": { "type": ["object", "null"], "additionalProperties": true },
            "mappings": { "type": "array", "items": { "type": "object" } },
            "thresholds": { "$ref": "#/$defs/thresholds" },
            "custom": { "type": ["object", "null"], "additionalProperties": true }
          }
        },
        "overrides": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": true,
            "properties": {
              "matcher": { "type": "object", "additionalProperties": true },
              "properties": { "type": "array", "items": { "type": "object", "additionalProperties": true } }
            }
          }
        }
      }
    },

    "target": {
      "type": "object",
      "additionalProperties": true,
      "required": ["refId"],
      "properties": {
        "refId": { "type": "string", "minLength": 1 },
        "editorMode": { "type": ["string", "null"] },
        "datasource": { "$ref": "#/$defs/datasource" },
        "expr": { "type": ["string", "null"] },
        "query": { "type": ["string", "null"] },
        "legendFormat": { "type": ["string", "null"] },
        "range": { "type": ["boolean", "null"] }
      },
      "allOf": [
        {
          "if": {
            "properties": { "datasource": { "type": "object", "properties": { "type": { "const": "prometheus" } }, "required": ["type"] } }
          },
          "then": {
            "required": ["expr"]
          }
        }
      ]
    },

    "panelBase": {
      "type": "object",
      "additionalProperties": true,
      "required": ["type", "title", "id", "gridPos"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["timeseries", "stat", "table", "bargauge", "bar-gauge", "heatmap", "gauge", "state-timeline"]
        },
        "title": { "type": "string" },
        "id": { "type": "integer", "minimum": 0 },
        "description": { "type": ["string", "null"] },
        "transparent": { "type": ["boolean", "null"] },
        "datasource": { "$ref": "#/$defs/datasource" },
        "targets": {
          "type": "array",
          "items": { "$ref": "#/$defs/target" }
        },
        "interval": { "type": ["string", "null"] },
        "intervalFactor": { "type": ["integer", "null"], "minimum": 1 },
        "gridPos": { "$ref": "#/$defs/gridPos" },
        "fieldConfig": { "$ref": "#/$defs/fieldConfig" },
        "options": { "type": "object", "additionalProperties": true },
        "links": { "type": "array", "items": { "$ref": "#/$defs/link" } },
        "pluginVersion": { "type": ["string", "null"] }
      }
    },

    "panelTimeseries": {
      "allOf": [
        { "$ref": "#/$defs/panelBase" },
        {
          "properties": {
            "type": { "const": "timeseries" }
          }
        }
      ]
    },

    "panelStat": {
      "allOf": [
        { "$ref": "#/$defs/panelBase" },
        {
          "properties": {
            "type": { "const": "stat" },
            "options": {
              "type": "object",
              "additionalProperties": true,
              "properties": {
                "reduceOptions": { "type": "object", "additionalProperties": true },
                "colorMode": { "type": ["string", "null"] }
              }
            }
          }
        }
      ]
    },

    "panelTable": {
      "allOf": [
        { "$ref": "#/$defs/panelBase" },
        {
          "properties": {
            "type": { "const": "table" },
            "transformations": { "type": "array", "items": { "type": "object", "additionalProperties": true } },
            "options": { "type": "object", "additionalProperties": true }
          }
        }
      ]
    },

    "panelBargauge": {
      "allOf": [
        { "$ref": "#/$defs/panelBase" },
        {
          "properties": {
            "type": { "enum": ["bargauge", "bar-gauge"] },
            "options": { "type": "object", "additionalProperties": true }
          }
        }
      ]
    },

    "panel": {
      "oneOf": [
        { "$ref": "#/$defs/panelTimeseries" },
        { "$ref": "#/$defs/panelStat" },
        { "$ref": "#/$defs/panelTable" },
        { "$ref": "#/$defs/panelBargauge" },
        { "$ref": "#/$defs/panelBase" }
      ]
    },

    "variable": {
      "type": "object",
      "additionalProperties": true,
      "required": ["type", "name"],
      "properties": {
        "type": { "type": "string", "enum": ["datasource", "query", "textbox", "constant", "custom", "interval"] },
        "name": { "type": "string", "minLength": 1 },
        "label": { "type": ["string", "null"] },
        "hide": { "type": ["integer", "null"], "enum": [0, 1, 2, null] },
        "query": { "type": ["string", "object", "null"] },
        "datasource": { "$ref": "#/$defs/datasource" },
        "refresh": { "type": ["integer", "null"], "enum": [0, 1, 2, null] },
        "includeAll": { "type": ["boolean", "null"] },
        "multi": { "type": ["boolean", "null"] },
        "value": { "type": ["string", "null"] },
        "current": { "type": ["object", "null"], "additionalProperties": true },
        "options": { "type": ["array", "null"], "items": { "type": "object", "additionalProperties": true } }
      },
      "allOf": [
        {
          "if": { "properties": { "type": { "const": "datasource" } } },
          "then": {
            "required": ["query"]
          }
        }
      ]
    },

    "link": {
      "type": "object",
      "additionalProperties": true,
      "properties": {
        "title": { "type": ["string", "null"] },
        "url": { "type": ["string", "null"] },
        "targetBlank": { "type": ["boolean", "null"] },
        "tooltip": { "type": ["string", "null"] }
      }
    },

    "annotation": {
      "type": "object",
      "additionalProperties": true,
      "properties": {
        "name": { "type": ["string", "null"] },
        "datasource": { "$ref": "#/$defs/datasource" },
        "enable": { "type": ["boolean", "null"] },
        "iconColor": { "type": ["string", "null"] },
        "type": { "type": ["string", "null"] },
        "expr": { "type": ["string", "null"] },
        "tags": { "type": ["array", "null"], "items": { "type": "string" } }
      }
    }
  }
}
