# Kubernetes PodDisruptionBudget for Aethernova Chain Core
# apiVersion and fields per Kubernetes policy/v1 PDB spec.
# - Only one of "minAvailable" OR "maxUnavailable" may be set. (See k8s docs)
# - Uses recommended app.kubernetes.io/* labels for selectors and identification.
# Reference:
#   - https://kubernetes.io/docs/concepts/workloads/pods/disruptions/
#   - https://kubernetes.io/docs/tasks/run-application/configure-pdb/
#   - https://kubernetes.io/docs/concepts/overview/working-with-objects/common-labels/
#   - https://kubernetes.io/docs/reference/labels-annotations-taints/

---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: validator-pdb
  labels:
    app.kubernetes.io/name: aethernova-chain
    app.kubernetes.io/instance: main
    app.kubernetes.io/component: validator
    app.kubernetes.io/part-of: aethernova-chain-core
    app.kubernetes.io/version: "v1"
  annotations:
    # Protect validator quorum during voluntary disruptions (node drain, etc.)
    # Keep >=80% of validator pods available.
    # Do NOT set maxUnavailable here since it is mutually exclusive with minAvailable.
    # See: k8s docs "Specifying a PodDisruptionBudget".
    a8n.io/description: "PDB to preserve validator quorum with >=80% availability"
spec:
  minAvailable: "80%"
  selector:
    matchLabels:
      app.kubernetes.io/name: aethernova-chain
      app.kubernetes.io/instance: main
      app.kubernetes.io/component: validator
      app.kubernetes.io/part-of: aethernova-chain-core

---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: rpc-pdb
  labels:
    app.kubernetes.io/name: aethernova-chain
    app.kubernetes.io/instance: main
    app.kubernetes.io/component: rpc
    app.kubernetes.io/part-of: aethernova-chain-core
    app.kubernetes.io/version: "v1"
  annotations:
    # For stateless RPC/frontends it is often safe to allow 1 pod disruption.
    # Using maxUnavailable here (not minAvailable) per k8s spec (mutually exclusive).
    a8n.io/description: "PDB for RPC layer allowing at most one unavailable pod"
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: aethernova-chain
      app.kubernetes.io/instance: main
      app.kubernetes.io/component: rpc
      app.kubernetes.io/part-of: aethernova-chain-core
