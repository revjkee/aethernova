# ledger-core/mypy.ini
# Профиль: строгий для prod‑кода, послабления для tests/ и вспомогательных скриптов.
# Совместим с Python 3.11+ (корректируйте при необходимости).

[mypy]
python_version = 3.11
# Если проект разложен по namespace‑пакетам (PEP 420):
namespace_packages = True
explicit_package_bases = True

# Какие файлы проверять (корень репозитория = ledger-core/)
files = ledger_core, scripts, tests

# Исключения из анализа (рег. выражение)
exclude = (?x)(
    ^\.venv/|
    ^\.mypy_cache/|
    ^build/|
    ^dist/|
    ^\.eggs/|
    ^\.tox/|
    ^notebooks?/|
    ^docs/_build/
)$

# Инкрементальный кэш
incremental = True
cache_dir = .mypy_cache
sqlite_cache = True

# Диагностика/вывод
show_error_context = True
show_column_numbers = True
show_error_codes = True
pretty = True
color_output = True
error_summary = True
warn_unused_configs = True

# Импорты
# normal — стандартная резолюция; для отдельных внешних модулей ниже включён ignore_missing_imports
follow_imports = normal

# Близко к --strict, но с тонкими настройками для индустриальной практики
# (смягчено: allow_redefinition=True для шаблонов и динамики, отключено disallow_any_explicit)
warn_redundant_casts = True
warn_unused_ignores = True
warn_unreachable = True
warn_no_return = True
warn_return_any = True
no_implicit_optional = True
check_untyped_defs = True
disallow_incomplete_defs = True
disallow_untyped_defs = True
disallow_untyped_calls = True
disallow_untyped_decorated_calls = True
disallow_subclassing_any = True
disallow_any_generics = True
implicit_reexport = False
strict_equality = True
allow_redefinition = True

# Конфигурация уровня ошибок (по умолчанию — error)
# Можно смягчить некоторые коды до "warning" (пример закомментирован):
# disable_error_code = 
# warn_unused_ignores

# -----------------------------------
# Опциональные плагины (раскомментируйте при наличии)
#plugins =
#    pydantic.mypy
#    attrs

# [pydantic-mypy]
# init_forbid_extra = True
# init_typed = True
# warn_required_dynamic_aliases = True

# [attrs]
# attrs_auto_attribs_default = True

# -----------------------------------
# Перегрузки для отдельных путей/модулей

# Тесты: разрешаем больше динамики, но всё ещё собираем полезные ошибки
[mypy-tests.*]
disallow_untyped_defs = False
disallow_untyped_calls = False
warn_return_any = False
allow_redefinition = True

# Скрипты (одноразовые/CLI): немного мягче
[mypy-scripts.*]
disallow_untyped_defs = False
disallow_untyped_calls = False
allow_redefinition = True

# Примеры/документация (если есть)
[mypy-examples.*]
disallow_untyped_defs = False
disallow_untyped_calls = False
warn_return_any = False

# -----------------------------------
# Внешние зависимости без типингов — глушим ошибки импортов (точечно)

[mypy-numpy.*]
ignore_missing_imports = True

[mypy-pandas.*]
ignore_missing_imports = True

[mypy-requests.*]
ignore_missing_imports = True

[mypy-sqlalchemy.*]
ignore_missing_imports = True

[mypy-pydantic.*]
ignore_missing_imports = True

[mypy-kafka.*]
ignore_missing_imports = True

[mypy-pytest.*]
ignore_missing_imports = True

# Если используется cloud‑SDK/клиенты:
[mypy-boto3.*]
ignore_missing_imports = True

[mypy-google.*]
ignore_missing_imports = True

# -----------------------------------
# Локальные протоколы/плагины генерации кода (если присутствуют):
# [mypy-ledger_core.generated.*]
# ignore_errors = True

# -----------------------------------
# Примеры тонкой настройки по кодам ошибок (оставлено как подсказка):
#   error_code из mypy: https://mypy.readthedocs.io/en/stable/error_code_list.html
# [mypy-ledger_core.experimental.*]
# warn_unused_ignores = False
# enable_error_code = truthy-bool, redundant-expr
# disable_error_code = misc
