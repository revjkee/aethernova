# ops/helm/ledger-core/Chart.yaml
apiVersion: v2
name: ledger-core
description: >
  Ledger Core — высоконадежный сервис учета операций. Чарт включает деплой API/worker,
  конфигурацию сервисов и (опционально) зависимости: PostgreSQL и Redis.

type: application

# SemVer для самого чарта (шаблонов и зависимостей)
version: 0.1.0

# Версия приложения. Может наследоваться из CI (например, через --app-version).
appVersion: "1.0.0"

# Совместимость с версиями Kubernetes
kubeVersion: ">=1.25.0-0"

home: https://example.com/ledger-core
sources:
  - https://example.com/ledger-core/docs
  - https://git.example.com/org/ledger-core
keywords:
  - ledger
  - accounting
  - api
  - worker
  - postgres
  - redis
maintainers:
  - name: Data Platform Team
    email: data-platform@example.com
    url: https://example.com/team

# Аннотации — полезны для Artifact Hub и внутреннего каталога
annotations:
  artifacthub.io/category: application
  artifacthub.io/license: Apache-2.0
  artifacthub.io/links: |
    - name: Documentation
      url: https://example.com/ledger-core/docs
    - name: Source
      url: https://git.example.com/org/ledger-core
  artifacthub.io/images: |
    - name: ledger-core
      image: ghcr.io/example/ledger-core:1.0.0
      whitelisted: true
  artifacthub.io/changes: |
    - kind: added
      description: Initial Helm chart with optional PostgreSQL/Redis dependencies
    - kind: changed
      description: Enforced Kubernetes >=1.25 and policy/v1 PDB compatibility
  artifacthub.io/containsSecurityUpdates: "false"

# Зависимости (подтягиваются условно через values)
dependencies:
  # Используйте официальный Chart по вашему стандарту; ниже — примерные координаты.
  - name: postgresql
    version: 12.5.6
    repository: https://charts.bitnami.com/bitnami
    condition: postgresql.enabled
    tags: ["db", "postgresql"]
  - name: redis
    version: 18.8.0
    repository: https://charts.bitnami.com/bitnami
    condition: redis.enabled
    tags: ["cache", "redis"]

# Ограничения/возможности чарта
# (необязательный блок — для самодокументации)
annotationsExtended:
  capabilities:
    - rollingUpdate
    - pdb
    - hpa
    - serviceMonitor
  notes:
    - "Для production рекомендуется внешняя управляемая БД: postgresql.enabled=false"
    - "Для zero-downtime используйте PDB и HPA; см. templates/"
