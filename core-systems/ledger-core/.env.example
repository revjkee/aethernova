################################################################################
# ledger-core / .env.example
# Переименуйте в .env и задайте реальные значения. Никогда не коммитьте секреты.
# Формат: KEY=VALUE (без кавычек, если не требуется). Комментарии начинаются с #.
################################################################################

########################################
# ПРОФИЛЬ/РЕЖИМЫ ЗАПУСКА
########################################
APP_NAME=ledger-core
APP_ENV=development            # development|staging|production
APP_DEBUG=false                # true только локально
APP_TIMEZONE=UTC
APP_LOCALE=en_US
APP_BASE_URL=http://localhost:8080
APP_PORT=8080
APP_BIND=0.0.0.0

# Устойчивость к перезапускам
APP_SHUTDOWN_GRACE_SECONDS=20

########################################
# БЕЗОПАСНОСТЬ / СЕКРЕТЫ / КЛЮЧИ
########################################
# Генерируйте случайные 32+ байт (base64/hex). Меняйте при компрометации.
SECRET_KEY_BASE=change_me_32bytes_min
# JWT для API клиентов
JWT_ISSUER=ledger-core
JWT_AUDIENCE=ledger-clients
JWT_ACCESS_TTL_SECONDS=900          # 15m
JWT_REFRESH_TTL_SECONDS=2592000     # 30d
JWT_SIGNING_ALG=RS256               # HS256|RS256|ES256
# Для RS/ES укажите пути к ключам (PEM). Не храните ключи в репозитории.
JWT_PRIVATE_KEY_PATH=secrets/jwt/app_rsa_private.pem
JWT_PUBLIC_KEY_PATH=secrets/jwt/app_rsa_public.pem

# Ротация ключей (идентификаторы активной версии)
KEY_ROTATION_ACTIVE_JWT_KID=v1
KEY_ROTATION_ACTIVE_WEBHOOK_KID=v1

# Подпись веб‑хуков
WEBHOOK_SIGN_ALG=HMAC_SHA256
WEBHOOK_SIGN_SECRET=change_me_webhook_secret
WEBHOOK_TOLERANCE_SECONDS=300

# Политики CORS
CORS_ENABLED=true
CORS_ALLOWED_ORIGINS=http://localhost:3000,https://example.com
CORS_ALLOWED_HEADERS=Authorization,Content-Type,X-Request-Id
CORS_ALLOWED_METHODS=GET,POST,PUT,PATCH,DELETE,OPTIONS

########################################
# БАЗА ДАННЫХ (PostgreSQL)
########################################
DB_HOST=localhost
DB_PORT=5432
DB_NAME=ledger
DB_USER=ledger_app
DB_PASSWORD=change_me_db_password
DB_SSLMODE=disable               # disable|require|verify-ca|verify-full
DB_MAX_OPEN_CONNS=50
DB_MAX_IDLE_CONNS=10
DB_CONN_MAX_LIFETIME_SECONDS=1800
DB_STATEMENT_TIMEOUT_MS=30000
DB_SEARCH_PATH=public

# Реплики только для чтения (через запятую), опционально
DB_READ_REPLICAS=                 # e.g. replica1:5432,replica2:5432
DB_RO_ROUTING=lag_aware           # round_robin|lag_aware|off
DB_RO_MAX_LAG_SECONDS=5

# Миграции
DB_MIGRATIONS_DIR=./migrations
DB_MIGRATE_ON_START=true

########################################
# КЭШ / РЕЙТЛИМИТ / СЕССИИ (Redis)
########################################
REDIS_URL=redis://localhost:6379/0
REDIS_TLS=false
REDIS_POOL_SIZE=20
REDIS_KEY_PREFIX=ledger

# Идемпотентность (хранилище ключей)
IDEMPOTENCY_TTL_SECONDS=86400
IDEMPOTENCY_PREFIX=idemp

# Рейтлимиты (пример: 1000 запросов в 60с на токен)
RATE_LIMIT_ENABLED=true
RATE_LIMIT_BUCKET=api_token
RATE_LIMIT_CAPACITY=1000
RATE_LIMIT_INTERVAL_SECONDS=60

########################################
# СООБЩЕНИЯ / БРОКЕР / ОЧЕРЕДИ (выберите стек)
########################################
# Kafka (вариант 1)
KAFKA_ENABLED=false
KAFKA_BROKERS=localhost:9092
KAFKA_CLIENT_ID=ledger-core
KAFKA_SSL=false
KAFKA_SASL_MECHANISM=none         # none|PLAIN|SCRAM-SHA-256|SCRAM-SHA-512|OAUTHBEARER
KAFKA_SASL_USERNAME=
KAFKA_SASL_PASSWORD=
KAFKA_TOPIC_EVENTS=ledger.events
KAFKA_TOPIC_AUDIT=ledger.audit
KAFKA_ACKS=all
KAFKA_MAX_IN_FLIGHT=5

# NATS (вариант 2)
NATS_ENABLED=true
NATS_URL=nats://localhost:4222
NATS_JETSTREAM=true
NATS_STREAM_EVENTS=LEDGER_EVENTS
NATS_STREAM_AUDIT=LEDGER_AUDIT
NATS_USER=
NATS_PASSWORD=

# Пул воркеров фоновых задач
WORKER_CONCURRENCY=8
WORKER_PREFETCH=64
WORKER_MAX_RETRIES=10
WORKER_RETRY_BACKOFF_SECONDS=1,2,5,10,30

########################################
# ОБЪЕКТНОЕ ХРАНИЛИЩЕ (S3‑совместимое)
########################################
S3_ENABLED=false
S3_ENDPOINT=https://s3.amazonaws.com
S3_REGION=us-east-1
S3_ACCESS_KEY_ID=
S3_SECRET_ACCESS_KEY=
S3_BUCKET_ATTACHMENTS=ledger-attachments
S3_FORCE_PATH_STYLE=false
S3_SSE=aws:kms                       # пусто|AES256|aws:kms
S3_KMS_KEY_ID=                       # при S3_SSE=aws:kms

########################################
# НАБЛЮДАЕМОСТЬ / ЛОГИ / ТРЕЙСЫ
########################################
LOG_LEVEL=info                      # debug|info|warn|error
LOG_FORMAT=json                     # json|console
LOG_SAMPLING=1.0                    # 0..1

# OpenTelemetry
OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4317
OTEL_EXPORTER=otlp                  # none|otlp
OTEL_SERVICE_NAME=ledger-core
OTEL_RESOURCE_ATTRIBUTES=deployment.environment=${APP_ENV}
OTEL_TRACES_SAMPLER=parentbased_traceidratio
OTEL_TRACES_SAMPLER_ARG=0.1

# Метрики Prometheus (если включено в приложении)
METRICS_ENABLED=true
METRICS_BIND=0.0.0.0:9464

########################################
# АУДИТ / КОМПЛАЕНС
########################################
AUDIT_ENABLED=true
AUDIT_TOPIC=ledger.audit
AUDIT_REDACT_PII=true
AUDIT_RETENTION_DAYS=365

########################################
# ВАЛЮТЫ / ОКРУГЛЕНИЕ / КУРСЫ
########################################
CURRENCY_DEFAULT=USD
CURRENCY_SUPPORTED=USD,EUR,SEK,GBP
# Банковское округление (round half to even) по умолчанию
MONEY_ROUNDING_MODE=bankers
MONEY_SCALE_DEFAULT=2
MONEY_MAX_SCALE=6

# Источник курсов (только примерные ключи)
FX_PROVIDER=ecb                     # ecb|fixer|openexchangerates|custom
FX_REFRESH_CRON=0 */2 * * *         # каждые 2 часа
FX_API_URL=
FX_API_KEY=

########################################
# ПЛАТЕЖНЫЕ ИНТЕГРАЦИИ (примерные плейсхолдеры)
########################################
# Stripe
STRIPE_ENABLED=false
STRIPE_API_KEY=
STRIPE_WEBHOOK_SECRET=
# Adyen
ADYEN_ENABLED=false
ADYEN_MERCHANT_ACCOUNT=
ADYEN_API_KEY=
ADYEN_HMAC_KEY=

########################################
# ВЕБ‑ХУКИ / ИСХОДЯЩИЕ ИНТЕГРАЦИИ
########################################
WEBHOOK_RETRY_BACKOFF_SECONDS=5,15,60,300
WEBHOOK_MAX_RETRIES=10
WEBHOOK_CONN_TIMEOUT_MS=3000
WEBHOOK_READ_TIMEOUT_MS=5000
WEBHOOK_ENABLE_TLS_PINNING=false
WEBHOOK_ALLOWED_HOSTS=*             # * или список доменов

########################################
# ПОЧТА (SMTP)
########################################
SMTP_ENABLED=false
SMTP_HOST=localhost
SMTP_PORT=25
SMTP_USER=
SMTP_PASSWORD=
SMTP_STARTTLS=true
SMTP_FROM=noreply@example.com

########################################
# API / ПАГИНАЦИЯ / ДОКУМЕНТАЦИЯ
########################################
API_MAX_PAGE_SIZE=1000
API_DEFAULT_PAGE_SIZE=100
API_BODY_LIMIT_MB=5
API_ENABLE_DOCS=true

########################################
# ИДЕМПОТЕНТНОСТЬ / ДЕДУПЛИКАЦИЯ
########################################
IDEMPOTENCY_HEADER=X-Idempotency-Key
DEDUPE_WINDOW_SECONDS=60

########################################
# ПОЛИТИКИ ПАРОЛЕЙ / MFA (если требуется)
########################################
AUTH_PASSWORD_MIN_LENGTH=12
AUTH_PASSWORD_REQUIRE_SYMBOL=true
AUTH_MFA_REQUIRED=false

########################################
# ФИЧЕ‑ФЛАГИ
########################################
FEATURE_BULK_IMPORT=false
FEATURE_ASYNC_EXPORTS=true
FEATURE_DOUBLE_ENTRY_STRICT=true

########################################
# ТЕСТОВЫЕ ПРОФИЛИ (опциональные overrides)
########################################
# Для локальных тестов можно переопределить часть параметров:
# APP_ENV=test
# DB_NAME=ledger_test
# DB_MIGRATE_ON_START=true
# LOG_LEVEL=warn
# OTEL_EXPORTER=none
# KAFKA_ENABLED=false
# NATS_ENABLED=false

########################################
# СТЕЙДЖИНГ / ПРОДАКШН ПОДСКАЗКИ (не значения!)
########################################
# APP_ENV=staging|production
# APP_DEBUG=false
# DB_SSLMODE=verify-full
# JWT_SIGNING_ALG=RS256 (с внешним KMS/HSM)
# S3_SSE=aws:kms и указать S3_KMS_KEY_ID
# OTEL_TRACES_SAMPLER_ARG=0.05..0.2
# LOG_SAMPLING ≤ 0.5 при высоком трафике
# CORS_ALLOWED_ORIGINS указывать явно, без *
################################################################################
