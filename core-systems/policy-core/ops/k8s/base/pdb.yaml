# policy-core/ops/k8s/base/pdb.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: policy-core-pdb
  labels:
    app.kubernetes.io/name: policy-core
    app.kubernetes.io/part-of: policy-core
    app.kubernetes.io/component: engine    # при необходимости переопределите в overlay (например: loader|evaluator|synchronizer)
    app.kubernetes.io/managed-by: kustomize
  annotations:
    kubernetes.io/description: "PDB защищает policy-core от добровольных эвикций (drain/autoscaler/узкозонные работы)."
    policy.core/audit.owner: "platform-security-core"
    policy.core/audit.purpose: "Удержание доступности сервиса во время плановых операций."
    policy.core/audit.revision: "0"        # переопределяйте номером коммита/релиза в overlay
spec:
  # Для HA по умолчанию удерживаем не менее 60% доступных подов.
  # При 1 реплике это эквивалентно 1 и полностью блокирует эвикции для исключения простоя.
  # В dev можно ослабить до "50%" или задать maxUnavailable: 1 в overlay.
  minAvailable: "60%"

  # Внимание: селектор должен строго соответствовать Deployment/StatefulSet подам policy-core.
  selector:
    matchLabels:
      app.kubernetes.io/name: policy-core
      app.kubernetes.io/component: engine
