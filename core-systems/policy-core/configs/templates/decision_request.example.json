{
  "apiVersion": "policy-core/v1",
  "kind": "DecisionRequest",
  "requestId": "6d3a0f2c-4b5e-4b1a-9b5d-1b2c3d4e5f60",
  "timestamp": "2025-08-28T13:15:00Z",
  "tenant": {
    "id": "acme",
    "environment": "prod"
  },
  "correlationId": "c0a8f0e2-1e2f-4f3a-9d2c-7b1a9e5f0c3d",
  "idempotencyKey": "approve-invoice-INV-000123-user-42-2025-08-28T13:15:00Z",
  "policy": {
    "set": "default",
    "revision": "v42.7.1",
    "eval": {
      "timeoutMs": 1200,
      "explain": "full",
      "trace": false,
      "returnObligations": true
    }
  },
  "subject": {
    "id": "user:42",
    "type": "user",
    "primaryEmail": "alice@acme.example",
    "displayName": "Alice Example",
    "identities": {
      "sso": "okta:00u123abcXYZ",
      "github": "alice",
      "azureAd": "a1b2c3d4-0000-1111-2222-333344445555"
    },
    "roles": [
      "analyst",
      "billing-approver"
    ],
    "groups": [
      "finance",
      "eu-staff"
    ],
    "attributes": {
      "department": "finance",
      "employmentType": "employee",
      "managerId": "user:7",
      "clearance": "internal",
      "country": "SE"
    },
    "mfa": {
      "presented": true,
      "methods": [
        "totp"
      ],
      "lastVerifiedAt": "2025-08-28T12:50:00Z"
    }
  },
  "resource": {
    "id": "invoice:2025/08/INV-000123",
    "type": "invoice",
    "urn": "urn:acme:invoice:2025:08:INV-000123",
    "ownerId": "acct:customer:987",
    "collection": "invoices",
    "path": "/customers/987/invoices/INV-000123",
    "labels": {
      "region": "eu-central",
      "product": "prime"
    },
    "classification": "confidential",
    "createdAt": "2025-08-20T09:01:02Z",
    "attributes": {
      "amount": 1999.99,
      "currency": "EUR",
      "status": "pending",
      "overdueDays": 0,
      "country": "SE"
    }
  },
  "action": {
    "name": "approve",
    "operation": "write",
    "http": {
      "method": "POST",
      "path": "/v1/invoices/INV-000123/approve"
    }
  },
  "context": {
    "purposeOfUse": "billing-approval",
    "justification": "Quarterly invoice approval",
    "channel": "web",
    "originApp": "policy-console",
    "requestIp": "203.0.113.10",
    "location": {
      "country": "SE",
      "city": "Stockholm",
      "lat": 59.3293,
      "lon": 18.0686
    },
    "device": {
      "id": "dev-9a7f",
      "os": {
        "name": "macOS",
        "version": "14.5"
      },
      "managed": true,
      "trustedNetwork": false,
      "posture": {
        "diskEncrypted": true,
        "firewallEnabled": true,
        "avRunning": true
      }
    },
    "session": {
      "id": "sess-abc123",
      "startedAt": "2025-08-28T12:00:00Z",
      "expiresAt": "2025-08-28T18:00:00Z"
    },
    "risk": {
      "score": 14,
      "level": "low",
      "signals": [
        "mfa",
        "managed-device"
      ]
    },
    "jurisdiction": [
      "EU",
      "SE"
    ],
    "dataResidency": "EU",
    "requestTime": "2025-08-28T13:15:00Z",
    "timezone": "Europe/Stockholm"
  },
  "constraints": {
    "dataFilter": {
      "allowFields": [
        "id",
        "amount",
        "currency",
        "status",
        "ownerId"
      ],
      "masking": [
        {
          "field": "ownerId",
          "method": "hash",
          "params": {
            "algo": "sha256"
          }
        }
      ],
      "rowLevel": {
        "where": "attributes.country == subject.attributes.country"
      }
    },
    "obligations": [
      {
        "on": "Permit",
        "type": "audit.log",
        "params": {
          "category": "billing",
          "redact": [
            "ownerId"
          ]
        }
      },
      {
        "on": "Permit",
        "type": "notify",
        "params": {
          "channel": "slack",
          "target": "#approvals"
        }
      },
      {
        "on": "Deny",
        "type": "audit.log",
        "params": {
          "category": "billing-deny"
        }
      }
    ]
  },
  "cache": {
    "allow": true,
    "ttlSeconds": 300,
    "keyParts": [
      "tenant.id",
      "subject.id",
      "action.name",
      "resource.type",
      "resource.id"
    ]
  },
  "requestedDecisions": [
    "permit",
    "explain",
    "obligations"
    ]
  ,
  "ext": {
    "x-trace-id": "b6f1e1c2-6a4e-4c01-9f1b-2d3c4b5a6e7f",
    "x-release": "policy-core@0.1.0"
  },
  "integrity": {
    "alg": "sha256",
    "hash": "REPLACE_WITH_REQUEST_BODY_SHA256"
  }
}
