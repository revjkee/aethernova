# ===========================
# mythos-core /.env.example
# Назначение: промышленный шаблон конфигурации (12-factor)
# Формат: KEY=VALUE, без кавычек, UTF-8
# Предупреждение: НЕ храните реальные секреты в VCS
# ===========================

# -------- APP / RUNTIME --------
APP_NAME=mythos-core
APP_ENV=dev                    # dev|staging|prod
APP_DEBUG=true                 # prod=false
APP_HOST=0.0.0.0
APP_PORT=8080
APP_BASE_URL=http://localhost:8080
TZ=UTC
LOCALE=ru_RU.UTF-8
RUNTIME_USER=app               # prod: имя непривилегированного пользователя процесса
RUNTIME_GROUP=app

# -------- LOGGING / OBSERVABILITY --------
LOG_LEVEL=INFO                 # DEBUG|INFO|WARN|ERROR
LOG_FORMAT=json                # json|text
LOG_JSON_PRETTY=false          # dev=true
LOG_FILE=                      # путь к файлу или пусто для stdout
OTEL_TRACING_ENABLED=false     # prod=true
OTEL_EXPORTER_OTLP_ENDPOINT=   # пример: http://otel-collector:4318
OTEL_EXPORTER_OTLP_HEADERS=    # пример: "authorization=Bearer <token>"
OTEL_SERVICE_NAME=mythos-core
PROMETHEUS_SCRAPE_ENABLED=true
PROMETHEUS_METRICS_PORT=9100
SENTRY_DSN=                    # опционально: DSN для отчётов об ошибках
SENTRY_ENVIRONMENT=${APP_ENV}

# -------- SECURITY / AUTH / CRYPTO --------
SECRET_KEY=change-me-dev-secret-32bytes-min
PASSWORD_HASH_SCHEME=argon2id  # argon2id|bcrypt
PASSWORD_MIN_LENGTH=12
JWT_ENABLED=true
JWT_ALG=HS256                  # HS256|RS256|EdDSA
JWT_SECRET=change-me-jwt-dev
JWT_ACCESS_TTL=900             # секунды
JWT_REFRESH_TTL=1209600        # 14 дней
JWT_ISSUER=mythos-core
JWT_AUDIENCE=mythos-clients
CSRF_PROTECTION_ENABLED=true
CSRF_TRUSTED_ORIGINS=http://localhost:3000
ALLOW_REGISTRATION=true        # prod=false
ADMIN_EMAIL=admin@example.com  # dev наполнение
ADMIN_PASSWORD=admin123456     # dev, НЕ использовать в prod

# -------- CORS / CLIENT ACCESS --------
CORS_ENABLED=true
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:5173
CORS_ALLOWED_METHODS=GET,POST,PUT,PATCH,DELETE,OPTIONS
CORS_ALLOWED_HEADERS=Authorization,Content-Type,X-Request-ID
CORS_ALLOW_CREDENTIALS=true

# -------- RATE LIMITING / ANTIFRAUD --------
RATE_LIMIT_ENABLED=true
RATE_LIMIT_REDIS_URL=redis://redis:6379/2
RATE_LIMIT_DEFAULT_RPS=10
RATE_LIMIT_BURST=20
RATE_LIMIT_IP_WHITELIST=
RATE_LIMIT_IP_BLACKLIST=

# -------- DATABASE (PostgreSQL) --------
DB_MAIN_HOST=postgres
DB_MAIN_PORT=5432
DB_MAIN_NAME=mythos
DB_MAIN_USER=mythos
DB_MAIN_PASSWORD=devpassword
DB_MAIN_SSLMODE=disable        # require|verify-full для prod
DB_POOL_MIN_SIZE=5
DB_POOL_MAX_SIZE=30
DB_POOL_TIMEOUT_S=30
DB_STATEMENTS_LOG=false

# -------- CACHE (Redis) --------
REDIS_URL=redis://redis:6379/0
REDIS_TLS_ENABLED=false
CACHE_DEFAULT_TTL_S=300

# -------- MESSAGE BROKER --------
# Вариант 1: RabbitMQ (AMQP)
BROKER_KIND=amqp               # amqp|kafka|none
AMQP_URL=amqp://guest:guest@rabbitmq:5672/%2f
AMQP_PREFETCH=32
# Вариант 2: Kafka
KAFKA_BROKERS=kafka:9092
KAFKA_SASL_ENABLED=false
KAFKA_SASL_MECHANISM=PLAIN
KAFKA_SASL_USERNAME=
KAFKA_SASL_PASSWORD=
KAFKA_SECURITY_PROTOCOL=PLAINTEXT  # SASL_SSL для prod
# Очереди/топики
QUEUE_DEFAULT=tasks.default
QUEUE_HIGH=tasks.high
QUEUE_LOW=tasks.low

# -------- STORAGE (S3 совместимое) --------
S3_ENDPOINT=http://minio:9000
S3_REGION=us-east-1
S3_ACCESS_KEY=minioadmin
S3_SECRET_KEY=minioadmin
S3_BUCKET_PUBLIC=mythos-public
S3_BUCKET_PRIVATE=mythos-private
S3_FORCE_PATH_STYLE=true
S3_SIGNED_URL_TTL_S=900

# -------- EMAIL / NOTIFICATIONS --------
SMTP_HOST=mailhog
SMTP_PORT=1025
SMTP_USER=
SMTP_PASSWORD=
SMTP_TLS=false
SMTP_FROM="Mythos Core <no-reply@mythos.local>"
# SMS провайдер (пример)
TWILIO_ENABLED=false
TWILIO_ACCOUNT_SID=
TWILIO_AUTH_TOKEN=
TWILIO_FROM_NUMBER=

# -------- WEBHOOKS / INTEGRATIONS --------
WEBHOOK_SIGNATURE_REQUIRED=true
WEBHOOK_SECRET=change-me-webhook
WEBHOOK_RETRY_MAX=10
WEBHOOK_RETRY_BACKOFF_S=1.5
TELEGRAM_BOT_ENABLED=false
TELEGRAM_BOT_TOKEN=
ETH_RPC_URL=
TON_API_ENDPOINT=
TON_API_KEY=

# -------- FEATURE FLAGS (пример для домена Mythos) --------
FEATURE_LORE_BUILDER=true
FEATURE_AGENT_CHAINS=true
FEATURE_3D_GIFTS=false
FEATURE_MARKETPLACE=false
FEATURE_EXPERIMENTAL_API=false

# -------- AI PROVIDERS / MODELS --------
AI_ENABLE_LOCAL=false
OPENAI_API_KEY=
OPENAI_BASE_URL=
OPENAI_MODEL=gpt-4o
OPENAI_EMBEDDING_MODEL=text-embedding-3-large
ANTHROPIC_API_KEY=
GEMINI_API_KEY=
HUGGINGFACE_TOKEN=
AI_SAFETY_TOXICITY_THRESHOLD=0.85

# -------- WORKERS / SCHEDULER --------
WORKER_CONCURRENCY=8
WORKER_MAX_TASKS_PER_CHILD=1000
SCHEDULER_ENABLED=true
SCHEDULER_TZ=${TZ}
SCHEDULE_CRON_SYNC_LORE=*/15 * * * *
SCHEDULE_CRON_GC=0 3 * * *

# -------- HTTP SERVER / TLS --------
HTTP_KEEPALIVE=true
HTTP_REQUEST_TIMEOUT_S=30
HTTP_BODY_LIMIT_MB=25
HTTPS_ENABLED=false
TLS_CERT_PATH=
TLS_KEY_PATH=

# -------- FILE UPLOADS --------
UPLOAD_MAX_MB=50
UPLOAD_ALLOWED_MIME=image/png,image/jpeg,application/pdf,application/zip

# -------- AUDIT / COMPLIANCE --------
AUDIT_LOG_ENABLED=true
AUDIT_LOG_SINK=stdout           # stdout|file|http
AUDIT_LOG_FILE=
GDPR_MODE=false
DATA_RETENTION_DAYS=365
PII_REDACTION_ENABLED=true

# -------- IDENTITY / OIDC (опционально) --------
OIDC_ENABLED=false
OIDC_ISSUER_URL=
OIDC_CLIENT_ID=
OIDC_CLIENT_SECRET=
OIDC_SCOPES=openid,profile,email
OIDC_REDIRECT_URL=${APP_BASE_URL}/auth/oidc/callback

# -------- DEV SEED / BOOTSTRAP --------
DEV_AUTOMIGRATE=true
DEV_AUTOCREATE_ADMIN=true
DEV_SEED_FIXTURES=false

# -------- TRACING HEADERS / CORRELATION --------
TRACE_HEADER_REQUEST_ID=X-Request-ID
TRACE_HEADER_PARENT_TRACE=X-Trace-Parent
PROPAGATE_B3=false
PROPAGATE_W3C_TRACE=true

# -------- MISC --------
PAGINATION_DEFAULT_LIMIT=50
PAGINATION_MAX_LIMIT=500
DEFAULT_TIMEZONE=${TZ}
