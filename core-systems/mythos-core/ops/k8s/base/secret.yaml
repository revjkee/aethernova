# mythos-core/ops/k8s/base/secret.yaml
# Промышленный шаблон секрета приложения Mythos Core.
# ВНИМАНИЕ: НЕ КОММИТЬ реальные значения. Заполняйте через оверлеи (kustomize),
# шаблонизатор CI/CD или Secret Manager. Kubernetes сам преобразует stringData -> data (base64).
apiVersion: v1
kind: Secret
metadata:
  name: mythos-core-app # РЕКОМЕНДАЦИЯ: для ротации использовать версионирование имени в оверлеях (напр., mythos-core-app-v2)
  # namespace не указываем в base — задаётся оверлеем
  labels:
    app.kubernetes.io/name: mythos-core
    app.kubernetes.io/instance: mythos-core
    app.kubernetes.io/component: api
    app.kubernetes.io/part-of: mythos-core
    app.kubernetes.io/managed-by: kustomize
    app.kubernetes.io/version: "0.1.0" # при желании патчится CI из git tag/sha
  annotations:
    kubernetes.io/description: "Application secrets for Mythos Core (DB, cache, crypto keys, telemetry)."
    # Арго/Флюкс и др. контроллеры понимают произвольные аннотации; специфичные аннотации добавляйте в оверлеях
type: Opaque
immutable: true
stringData:
  # ОБЩЕЕ
  APP_ENV: "production"                       # prod/staging/dev
  APP_SECRET_KEY: "REPLACE_ME_SECURE_RANDOM"  # криптостойкий ключ (>=32 байт)
  LOG_LEVEL: "INFO"                           # DEBUG/INFO/WARN/ERROR

  # АУТЕНТИФИКАЦИЯ/JWT
  JWT_SECRET: "REPLACE_ME_JWT_SECRET"
  JWT_ALGORITHM: "HS256"
  JWT_EXPIRES_IN: "3600"                      # сек

  # БД
  DATABASE_URL: "postgresql+psycopg://user:password@postgres:5432/mythos"
  DB_POOL_SIZE: "10"
  DB_POOL_TIMEOUT: "30"

  # КЭШ/БРОКЕР
  REDIS_URL: "redis://redis:6379/0"
  REDIS_TLS: "false"

  # ТЕЛЕМЕТРИЯ/ОПОВЕЩЕНИЯ (опционально)
  SENTRY_DSN: ""
  OTEL_EXPORTER_OTLP_ENDPOINT: ""             # напр., https://otel-collector:4317
  OTEL_RESOURCE_ATTRIBUTES: "service.name=mythos-core,service.version=0.1.0"

  # CORS/ХОСТЫ (если применимо)
  ALLOWED_HOSTS: "mythos.example.com"
  CORS_ALLOW_ORIGINS: "https://mythos.example.com"

  # ВНЕШНИЕ API (примеры, при необходимости)
  # THIRD_PARTY_API_KEY: ""
  # PAYMENT_PROVIDER_SECRET: ""

  # ПРИМЕЧАНИЕ:
  # - При изменении значений у immutable Secret Kubernetes не позволит обновить объект — ротация выполняется через новый Secret name.
  # - Автоматический рестарт pod при смене секрета обеспечивается либо контроллером (напр., Stakater Reloader), либо аннотациями в Deployment.
