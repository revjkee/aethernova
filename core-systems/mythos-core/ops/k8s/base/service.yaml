# mythos-core/ops/k8s/base/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: mythos-core
  labels:
    app.kubernetes.io/name: mythos-core
    app.kubernetes.io/instance: mythos-core
    app.kubernetes.io/part-of: mythos
    app.kubernetes.io/component: api
    app.kubernetes.io/version: "0.1.0"
    app.kubernetes.io/managed-by: kustomize
  annotations:
    kubernetes.io/description: "Mythos Core API service (HTTP, gRPC, metrics)"
    prometheus.io/scrape: "true"
    prometheus.io/port: "9090"
    prometheus.io/path: "/metrics"
    service.kubernetes.io/topology-aware-hints: "auto"
spec:
  type: ClusterIP
  # Для кластеров с поддержкой dual-stack можно переопределить ipFamilies в оверлеях.
  ipFamilyPolicy: PreferDualStack
  # Локальный обход трафика не принудителен, балансировка по кластеру.
  internalTrafficPolicy: Cluster
  publishNotReadyAddresses: false
  sessionAffinity: None
  selector:
    app.kubernetes.io/name: mythos-core
    app.kubernetes.io/component: api
  ports:
    - name: http
      port: 80
      targetPort: 8080
      protocol: TCP
      appProtocol: http
    - name: grpc
      port: 50051
      targetPort: 50051
      protocol: TCP
      appProtocol: grpc
    - name: metrics
      port: 9090
      targetPort: 9090
      protocol: TCP
      appProtocol: http
