# mypy configuration for mythos-core
# Industrial-grade static typing configuration
# Enforces strict type safety across core code, with scoped relaxations
# for third-party dependencies and tests.

[mypy]
# Core strictness
python_version = 3.11
warn_unused_configs = True
warn_redundant_casts = True
warn_unused_ignores = True
warn_return_any = True
warn_unreachable = True

# Disallow implicit dynamic typing
disallow_untyped_calls = True
disallow_untyped_defs = True
disallow_incomplete_defs = True
disallow_subclassing_any = True
disallow_any_unimported = True
disallow_any_generics = True
disallow_any_explicit = False  # allow explicit Any only where annotated
check_untyped_defs = True
no_implicit_optional = True

# Error handling
strict_optional = True
ignore_missing_imports = False
show_error_context = True
show_column_numbers = True
show_error_codes = True
pretty = True

# Incremental cache
cache_dir = .mypy_cache
incremental = True
sqlite_cache = True

# Project structure
namespace_packages = True
mypy_path = stubs:src

# Plugins for frameworks used in NeuroForge / Aethernova
plugins =
    pydantic.mypy
    sqlalchemy.ext.mypy.plugin
    mypy_django_plugin.main

# Allowlist for optional types in selected cases
allow_redefinition = False
implicit_reexport = False

# ----------------------
# Package-specific configs
# ----------------------

# Core project code: strict
[mypy-mythos_core.*]
disallow_untyped_defs = True
disallow_untyped_calls = True
disallow_incomplete_defs = True
check_untyped_defs = True
strict_optional = True

# Tests: more relaxed typing (still checked but less strict)
[mypy-tests.*]
disallow_untyped_defs = False
disallow_untyped_calls = False
check_untyped_defs = False
warn_unused_ignores = False

# Third-party dependencies without type hints: ignored
[mypy-numpy.*]
ignore_missing_imports = True
[mypy-torch.*]
ignore_missing_imports = True
[mypy-transformers.*]
ignore_missing_imports = True
[mypy-pandas.*]
ignore_missing_imports = True
[mypy-sqlalchemy.*]
ignore_missing_imports = True
[mypy-requests.*]
ignore_missing_imports = True
[mypy-uvicorn.*]
ignore_missing_imports = True
[mypy-fastapi.*]
ignore_missing_imports = True
[mypy-aiogram.*]
ignore_missing_imports = True

# Allow plugins to generate correct types
[mypy.plugins.django-stubs]
django_settings_module = "settings"

# ----------------------
# Experimental / advanced
# ----------------------
strict_equality = True
local_partial_types = True
show_traceback = False
follow_imports = normal
