{
  "title": "LLMOps Token Usage Dashboard",
  "uid": "llmops-token-usage",
  "version": 1,
  "schemaVersion": 36,
  "refresh": "10s",
  "time": {
    "from": "now-6h",
    "to": "now"
  },
  "panels": [
    {
      "type": "stat",
      "title": "Total Tokens Used",
      "id": 1,
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "green", "value": null },
              { "color": "orange", "value": 100000 },
              { "color": "red", "value": 200000 }
            ]
          }
        }
      },
      "targets": [
        {
          "expr": "sum(rate(llmops_token_usage_total[5m]))",
          "legendFormat": "total_tokens"
        }
      ]
    },
    {
      "type": "graph",
      "title": "Token Usage Over Time",
      "id": 2,
      "datasource": "Prometheus",
      "lines": true,
      "linewidth": 2,
      "fill": 1,
      "targets": [
        {
          "expr": "rate(llmops_token_usage_total[1m])",
          "legendFormat": "{{instance}}"
        }
      ]
    },
    {
      "type": "bar gauge",
      "title": "Token Usage by Endpoint",
      "id": 3,
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "unit": "short"
        }
      },
      "targets": [
        {
          "expr": "topk(5, sum by (endpoint) (rate(llmops_token_usage_total[1m])))",
          "legendFormat": "{{endpoint}}"
        }
      ]
    },
    {
      "type": "table",
      "title": "Token Usage per User",
      "id": 4,
      "datasource": "Prometheus",
      "columns": [],
      "targets": [
        {
          "expr": "sum by (user_id) (rate(llmops_token_usage_total[1m]))",
          "legendFormat": "{{user_id}}"
        }
      ]
    },
    {
      "type": "heatmap",
      "title": "Heatmap: Usage Density",
      "id": 5,
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "rate(llmops_token_usage_total[1m])",
          "legendFormat": "{{instance}}"
        }
      ],
      "xAxis": { "show": true, "mode": "time" },
      "yAxis": { "show": true, "format": "short" },
      "color": { "mode": "heatmap" }
    }
  ],
  "annotations": {
    "list": [
      {
        "name": "Deploy Events",
        "type": "tags",
        "datasource": "Prometheus",
        "iconColor": "rgba(255, 96, 96, 1)",
        "enable": true,
        "expr": "increase(deploy_events_total[5m]) > 0"
      }
    ]
  },
  "templating": {
    "list": [
      {
        "name": "user_id",
        "type": "query",
        "datasource": "Prometheus",
        "refresh": 2,
        "query": "label_values(llmops_token_usage_total, user_id)"
      }
    ]
  },
  "schema": "grafana",
  "editable": true,
  "versioned": true
}
