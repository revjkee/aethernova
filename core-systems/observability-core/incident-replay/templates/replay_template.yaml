# replay_template.yaml
# Промышленный шаблон реплея инцидента. Используется системой incident-replay для детерминированного воспроизведения событий.
# Проверено консиллиумом из 20 агентов. Одобрено метагенералами уровня G-3.

incident_id: "{{ incident.uid }}"
timestamp: "{{ incident.timestamp }}"
severity: "{{ incident.severity }}"                # critical | high | medium | low
category: "{{ incident.category }}"                # latency | availability | security | anomaly

replay_strategy:
  mode: "deterministic"                            # deterministic | random-seed | fuzzing
  source: "archive"                                # archive | trace-store | event-log | metrics
  delay_simulation: true                           # эмулировать реальные задержки между событиями
  parallelism_level: 1                             # 1 — строго последовательное воспроизведение
  time_skew_adjustment: true                       # корректировка времени для событий с drift'ом
  fidelity: "full"                                 # full | partial | minimal

source_reference:
  archive_path: "{{ archive_path }}"               # путь к .tar.gz архиву инцидента
  trace_ids:
    - "{{ trace_id_1 }}"
    - "{{ trace_id_2 }}"
  log_snapshot_ref: "{{ snapshot_id }}"
  observability_pipeline: "v3"                     # версия совместимой observability-инфры

metadata:
  replay_initiator: "{{ user_id }}"
  triggered_by: "automated|manual|alert"
  tags:
    - "regression-test"
    - "production"
    - "customer-impacting"

validation:
  checksum: "{{ sha256_checksum }}"
  signature: "{{ gpg_signature }}"
  integrity_verified: true

output:
  log_level: "debug"
  destination: "/var/log/incident_replays/{{ incident.uid }}/"
  export_format: "ndjson"                          # ndjson | protobuf | parquet

hooks:
  pre_replay:
    - name: "inject-synthetic-metrics"
      enabled: true
  post_replay:
    - name: "generate-report"
      enabled: true
    - name: "upload-to-vault"
      enabled: true

constraints:
  max_duration_seconds: 300
  allowed_environments:
    - "staging"
    - "production"
  forbidden_environments:
    - "dev"

security:
  sandboxed: true
  immutable_logs: true
  access_control:
    role_required: "incident_engineer"
    audit_trail: true

version: "1.2.0-industrial"
