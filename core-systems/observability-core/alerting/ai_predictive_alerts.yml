# observability/alerting/ai_predictive_alerts.yml

groups:
  - name: ai-predictive.rules
    interval: 30s
    rules:
      - alert: PredictiveNodeFailure
        expr: ai_forecast_node_failure_probability > 0.85
        for: 2m
        labels:
          severity: critical
          category: predictive
          model: bayesian
          scope: infrastructure
        annotations:
          summary: "Предсказан отказ ноды: {{ $labels.instance }}"
          description: "AI-прогноз модели предсказал вероятность отказа > 85% для {{ $labels.instance }}."

      - alert: ForecastHighLoadRisk
        expr: ai_forecast_cpu_spike{risk="high"} > 0.8
        for: 90s
        labels:
          severity: warning
          category: predictive
          model: lstm
          target: cpu
        annotations:
          summary: "AI предсказал скачок загрузки CPU"
          description: "На основе исторических данных AI предсказывает CPU-нагрузку выше 90% в ближайшие 5 минут."

      - alert: MemoryDegradationForecast
        expr: ai_forecast_memory_dip{instance!=""} < 0.2
        for: 2m
        labels:
          severity: warning
          component: memory
          ai_model: prophet
        annotations:
          summary: "Ожидаемая деградация памяти на {{ $labels.instance }}"
          description: "AI-прогноз указывает снижение доступной памяти ниже 20%."

      - alert: PredictiveAnomalyBurst
        expr: increase(ai_risk_score_burst_total[10m]) > 5
        for: 1m
        labels:
          severity: high
          signal: behavioral
          origin: ai-anomaly-detector
        annotations:
          summary: "AI обнаружил нарастающую серию поведенческих аномалий"
          description: "Зафиксировано >5 скачков risk_score подряд в течение 10 минут. Возможно наступление цепочки сбоев."

      - alert: ForecastedPolicyDrift
        expr: ai_policy_drift_forecast > 0.75
        for: 45s
        labels:
          severity: warning
          zone: policy
          ai: true
        annotations:
          summary: "Прогноз отклонения политики от целевой нормы"
          description: "AI-модель выявила вероятную несогласованность политик доступа и поведения агентов."

      - alert: AgentDeactivationPredicted
        expr: ai_agent_failure_probability > 0.9
        for: 30s
        labels:
          severity: critical
          team: ai-core
          type: agent-health
        annotations:
          summary: "Предсказана деградация ИИ-агента"
          description: "AI-модель прогнозирует отключение или деградацию агента в ближайшее время."

      - alert: ForecastedLatencySpike
        expr: ai_forecast_latency_ms > 400
        for: 1m
        labels:
          severity: warning
          metric: latency
          category: ai-prediction
        annotations:
          summary: "Ожидается рост задержки в ответах"
          description: "AI предсказал увеличение задержки выше 400мс в ближайшем окне времени."

      - alert: EarlyWarningUnauthorizedAccess
        expr: ai_risk_score_unauthorized_access > 0.7
        for: 30s
        labels:
          severity: high
          scope: access
          ai_model: ensemble
        annotations:
          summary: "AI выявил ранний риск несанкционированного доступа"
          description: "AI-индикаторы показывают высокий риск возможного нарушения доступа к защищённым ресурсам."
