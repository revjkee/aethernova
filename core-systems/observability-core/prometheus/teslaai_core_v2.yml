global:
  scrape_interval: 10s
  scrape_timeout: 7s
  evaluation_interval: 10s
  external_labels:
    project: "TeslaAI"
    module: "core-v2"
    environment: "production"

rule_files:
  - rules/teslaai/general.rules.yml
  - rules/teslaai/latency.rules.yml
  - rules/teslaai/errors.rules.yml
  - rules/teslaai/infra.rules.yml
  - rules/teslaai/agents.rules.yml

alerting:
  alertmanagers:
    - static_configs:
        - targets: ["alertmanager:9093"]

scrape_configs:
  - job_name: "teslaai-core"
    static_configs:
      - targets: ["ai-core:8500"]
    metrics_path: /metrics
    relabel_configs:
      - source_labels: [__address__]
        target_label: service
        replacement: "ai-core"
      - target_label: team
        replacement: "genesis-core"

  - job_name: "teslaai-agents"
    static_configs:
      - targets: ["agent-manager:8510", "agent-pool:8511"]
    relabel_configs:
      - target_label: component
        replacement: "agent"
      - target_label: team
        replacement: "genesis-core"

  - job_name: "gpu-monitor"
    static_configs:
      - targets: ["nvidia-exporter:9445"]
    relabel_configs:
      - target_label: resource
        replacement: "gpu"

  - job_name: "queue-monitor"
    static_configs:
      - targets: ["rabbitmq-exporter:9419"]
    relabel_configs:
      - target_label: resource
        replacement: "queue"

  - job_name: "cache-monitor"
    static_configs:
      - targets: ["redis-exporter:9121"]
    relabel_configs:
      - target_label: resource
        replacement: "cache"

  - job_name: "api-endpoints"
    metrics_path: /metrics
    static_configs:
      - targets:
          - "fastapi-api:8080"
          - "auth-service:8079"
    relabel_configs:
      - source_labels: [__address__]
        target_label: component
        replacement: "api"
      - target_label: security
        replacement: "enabled"

  - job_name: "internal-blackbox"
    metrics_path: /probe
    params:
      module: [http_2xx]
    static_configs:
      - targets:
          - https://teslaai-core/api/v1/health
          - https://teslaai-core/agents/status
    relabel_configs:
      - source_labels: [__address__]
        target_label: __param_target
      - source_labels: [__param_target]
        target_label: instance
      - target_label: __address__
        replacement: blackbox-exporter:9115

  - job_name: "latency-core"
    static_configs:
      - targets: ["latency-tracker:9200"]
    relabel_configs:
      - target_label: module
        replacement: "latency"

  - job_name: "thanos-sidecar"
    static_configs:
      - targets: ["thanos-sidecar:19090"]

remote_write:
  - url: "http://thanos-receiver:19291/api/v1/receive"
    queue_config:
      max_samples_per_send: 10000
      batch_send_deadline: 5s
    write_relabel_configs:
      - source_labels: [job]
        regex: ".*"
        action: keep
