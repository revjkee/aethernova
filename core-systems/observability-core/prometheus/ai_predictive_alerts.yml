groups:
  - name: AI Predictive Alerts - Core Systems
    interval: 10s
    rules:
      - alert: HighLatencyPrediction
        expr: |
          predict_linear(http_request_duration_seconds_bucket{job="fastapi-api"}[5m], 60) > 1
        for: 2m
        labels:
          severity: warning
          team: ai-core
          category: latency
        annotations:
          summary: "Прогноз высокого латентного ответа API"
          description: "Предиктивный анализ показал, что время отклика API FastAPI может превысить 1 секунду в течение ближайшей минуты."

      - alert: AgentFailureRisk
        expr: |
          predict_linear(agent_failures_total[10m], 300) - rate(agent_failures_total[5m]) > 5
        for: 3m
        labels:
          severity: critical
          category: reliability
          component: agents
        annotations:
          summary: "Прогноз массового отказа AI-агентов"
          description: "Искусственный интеллект предсказывает потенциальную волну отказов агентов. Требуется вмешательство DevOps/AIOps команды."

      - alert: AbnormalQueueGrowth
        expr: |
          increase(queue_messages_ready{job="queue-monitor"}[10m]) > 500
        for: 1m
        labels:
          severity: warning
          category: performance
          service: message-broker
        annotations:
          summary: "Резкий рост очередей сообщений"
          description: "Обнаружено аномальное накопление сообщений в RabbitMQ за последние 10 минут. Возможна задержка обработки событий."

      - alert: CPUAnomalyAI
        expr: |
          ai_anomaly(cpu_usage_total{job=~".+"}) > 0.9
        for: 1m
        labels:
          severity: warning
          category: anomaly
          source: ai-detector
        annotations:
          summary: "Аномалия использования CPU"
          description: "AI-алгоритмы предсказывают нетипичное поведение CPU. Возможен перегруз ядра или скрытая утечка ресурсов."

      - alert: MemoryDriftDetected
        expr: |
          predict_linear(process_resident_memory_bytes{job="ai-core"}[10m], 300) > 3.5e+09
        for: 2m
        labels:
          severity: critical
          category: memory
          owner: core-platform
        annotations:
          summary: "Предсказание утечки памяти"
          description: "AI предсказывает рост потребления памяти выше 3.5ГБ в ядре TeslaAI. Возможна деградация производительности."

      - alert: DriftInAgentBehavior
        expr: |
          ai_behavior_drift_score{agent_type=~".+"} > 0.8
        for: 90s
        labels:
          severity: high
          category: ai-agent
          type: behavioral-drift
        annotations:
          summary: "Поведенческий дрейф AI-агента"
          description: "AI обнаружил значительное отклонение от нормального поведения одного или нескольких агентов. Проверь логи и действия агентов."

      - alert: LatencySpikeClusterWide
        expr: |
          avg_over_time(http_request_duration_seconds_sum[1m]) / avg_over_time(http_request_duration_seconds_count[1m]) > 1.2
        for: 1m
        labels:
          severity: warning
          category: latency
        annotations:
          summary: "Средняя латентность кластерного уровня превышена"
          description: "Среднее время ответа превышает 1.2 сек в течение последней минуты. Возможны задержки на клиенте."

      - alert: AIModelAnomalyDetected
        expr: |
          ai_model_anomaly_score{model=~".+"} > 0.75
        for: 2m
        labels:
          severity: critical
          category: ai-model
        annotations:
          summary: "Аномалия в поведении ИИ-модели"
          description: "Обнаружено отклонение в результатах работы модели. Возможна регрессия или атака на входные данные."

      - alert: GPUOverutilization
        expr: |
          avg_over_time(nvidia_smi_utilization_gpu[5m]) > 90
        for: 1m
        labels:
          severity: high
          category: gpu
        annotations:
          summary: "GPU загружен на 90%+"
          description: "Обнаружено устойчивое использование GPU выше 90%. Возможна деградация инференса."

      - alert: PersistentQueueBacklog
        expr: |
          avg_over_time(queue_messages_ready[10m]) > 1000
        for: 5m
        labels:
          severity: critical
          category: backlog
        annotations:
          summary: "Постоянный backlog очереди"
          description: "Очередь сообщений превышает безопасные значения. Возможна потеря событий или краш агентов."
