# observability/dashboards/siem/lateral_movement.yaml

rule_id: LATERAL_MOVE_005
description: >
  Detects potential lateral movement attempts by identifying unexpected internal-to-internal traffic patterns.

enabled: true
severity: critical
tags:
  - lateral-movement
  - siem
  - internal-threat
  - mitre_technique:T1021
  - mitre_technique:T1071

conditions:
  type: composite
  match:
    - field: source_ip_internal
      operator: equals
      value: true

    - field: destination_ip_internal
      operator: equals
      value: true

    - field: destination_port
      operator: in
      value:
        - 3389   # RDP
        - 5985   # WinRM
        - 445    # SMB
        - 22     # SSH

    - field: connection_volume
      operator: greater_than
      value: 10
      timeframe_minutes: 3

    - field: device_profile_baseline
      operator: not_equals
      value: expected_peer

exceptions:
  - service_accounts:
      - "svc_backup"
      - "svc_monitoring"

actions:
  - type: alert
    message: >
      Potential lateral movement detected: {{ source_ip }} connected to {{ destination_ip }} using port {{ destination_port }}.

  - type: correlate
    correlation_rules:
      - brute_force.yaml
      - exfiltration.yaml
      - dns_tunneling.yaml

  - type: threat_score
    increment: 30
    reason: Lateral Movement Pattern Observed
