# observability/dashboards/siem/dns_tunneling.yaml

rule_id: DNS_TUNNEL_002
description: >
  Detects potential DNS tunneling activity based on abnormal DNS query patterns and domain entropy.

enabled: true
severity: critical
tags:
  - dns
  - tunneling
  - data-exfiltration
  - anomaly
  - siem
  - security

conditions:
  type: complex
  match:
    - field: dns_query_length
      operator: greater_than
      value: 100
    - field: dns_query_entropy
      operator: greater_than
      value: 4.5
    - field: dns_query_count
      operator: greater_than
      value: 50
      timeframe_minutes: 10

exceptions:
  - known_safe_domains:
      - "*.google.com"
      - "*.cloudflare.com"

actions:
  - type: alert
    message: >
      DNS tunneling pattern detected: high entropy queries (avg entropy > 4.5) with excessive frequency from IP {{ source_ip }}.
  - type: throttle
    target: source_ip
    duration_minutes: 60
  - type: log
    level: critical
    detail: true
