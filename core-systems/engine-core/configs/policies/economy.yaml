version: 1
policy_id: economy.core
app:
  name: engine-core
  env: ${APP_ENV:production}
  base_currency: USD
  settlement_asset: "REVA"             # основной утилити/гвард-токен
  chain_id: ${CHAIN_ID:1}              # пример: EVM chain id

token:
  symbol: "REVA"
  name: "Reva Token"
  decimals: 18
  standard: "REV-1/REVA-20"            # совместим с ERC-20 + burn-hooks
  total_supply_cap: "1_000_000_000"    # жесткий верхний предел
  initial_mint:
    amount: "150_000_000"
    to_treasury: true
  burn_hooks:
    enabled: true
    modes:
      - name: tx_burn_percent
        percent_bps: 25                 # 0.25% от комиссий протокола
      - name: buyback_burn
        source: "treasury.buyback_fund"
        schedule: "cron: 0 12 * * 1"    # еженедельно по понедельникам 12:00 UTC
  transfer_restrictions:
    allowlist_enabled: false
    blacklist_enabled: true
    blacklisted_addresses: []           # управляется onchain-админкой
  governance_rights: "vote-delegate"    # голосование и делегирование

emissions:
  epochs:
    - id: "epoch_1_bootstrap"
      start: "2025-08-15T00:00:00Z"
      end:   "2026-02-15T00:00:00Z"
      emission_total: "120_000_000"
      distribution:
        staking_rewards: 60
        ecosystem_grants: 20
        liquidity_mining: 20
    - id: "epoch_2_growth"
      start: "2026-02-15T00:00:00Z"
      end:   "2027-02-15T00:00:00Z"
      emission_total: "100_000_000"
      halvings_per_year: 1
      distribution:
        staking_rewards: 50
        ecosystem_grants: 25
        liquidity_mining: 25
  emission_rule:
    type: "decay"
    annual_decay_percent: 15
    floor_per_year: "10_000_000"
  mint_guard:
    require_dao_vote: true
    quorum_percent: 15
    supermajority_percent: 66.7
    timelock_seconds: 172800

allocations:
  genesis:
    team:         { percent: 15, vesting: { cliff_months: 12, duration_months: 48, interval_months: 3 } }
    investors:    { percent: 12, vesting: { cliff_months: 6,  duration_months: 36, interval_months: 3 } }
    treasury:     { percent: 20, unlock: "linear_60m" }
    community:    { percent: 35, program: "rewards+airdrops" }
    ecosystem:    { percent: 18, program: "grants+partnerships" }
  anti_whale:
    max_wallet_percent: 2.0
    max_tx_percent: 0.5
    exemptions: ["treasury", "market_maker", "cex_custody"]

treasury:
  accounts:
    main:           ${TREASURY_MAIN_ADDR:0x0000000000000000000000000000000000000000}
    ops:            ${TREASURY_OPS_ADDR:0x0000000000000000000000000000000000000000}
    rewards:        ${TREASURY_REWARDS_ADDR:0x0000000000000000000000000000000000000000}
    buyback_fund:   ${TREASURY_BUYBACK_ADDR:0x0000000000000000000000000000000000000000}
    emergency:      ${TREASURY_EMERGENCY_ADDR:0x0000000000000000000000000000000000000000}
  spending_policies:
    ops_daily_cap_usd: 100000
    rewards_weekly_cap_usd: 500000
    buyback_weekly_cap_usd: 300000
    emergency_quorum_percent: 66.7
    dual_signature_required: true
    signers_min: 2
  reporting:
    frequency: monthly
    disclosures:
      - "treasury_balance"
      - "emissions_distributed"
      - "buyback_burn_executed"

liquidity_policy:
  venues:
    - name: "DEX_Main"
      chain: ${CHAIN_ID:1}
      type: "uni-v3"
      fee_tiers_bps: [5, 30, 100]
      pools:
        - base: "REVA"
          quote: "USDC"
          target_depth_usd: 1500000
          min_depth_usd: 500000
          mm_strategy: "range-rebalance"
          range_percent: { inner: 5, outer: 20 }
    - name: "CEX_Partner"
      type: "cex"
      custody_account: "treasury.market_maker"
  protections:
    circuit_breakers:
      price_drop_limit_pct_1h: 20
      price_drop_limit_pct_24h: 40
      liq_depth_min_usd: 400000
      action_on_breach: ["pause_mm", "increase_range", "notify_ops"]
  slippage_limits:
    swap_max_slippage_bps: 80
    add_liquidity_max_imbalance_pct: 10
  mm_providers:
    require_whitelist: true
    kpi:
      spread_bps_target: 30
      uptime_target_pct: 95

fees_matrix:
  # Комиссии продуктов, часть может идти в buyback_burn через burn_hooks
  api:
    public_read_bps: 0
    premium_read_bps: 10
    write_bps: 30
  storage:
    per_gb_month_usd: 0.09
    ingress_bps: 0
    egress_bps: 12
  ai_inference:
    per_1k_tokens_usd: 0.003
    priority_multiplier: { bronze: 1.0, silver: 1.3, gold: 1.8, platinum: 2.5 }
  payments:
    onchain_transfer_bps: 15
    offchain_settlement_bps: 8
  discount_rules:
    staking_tiers:
      - tier: "S1"
        min_locked_reva: "5_000"
        discount_pct: 5
      - tier: "S2"
        min_locked_reva: "25_000"
        discount_pct: 12
      - tier: "S3"
        min_locked_reva: "100_000"
        discount_pct: 20
    partner_plan_extra_pct: 5

staking:
  enabled: true
  model: "liquid_staking"              # liquid_staking | classic
  min_lock_days: 14
  max_lock_days: 720
  rewards_apr_target_pct: 12
  rewards_source: ["emissions", "protocol_fees"]
  penalties:
    early_unstake_fee_bps: 300
    slashing_on_misuse_bps: 500
  delegation:
    enabled: true
    validator_min_stake: "250_000"
    validator_commission_bps: 500
  auto_compound:
    enabled: true
    frequency_days: 7

buyback:
  strategy: "TWAP"
  venues: ["DEX_Main"]
  schedule: "cron: 0 */6 * * *"        # каждые 6 часов
  spend_limit_usd_per_window: 50000
  trigger_conditions:
    pnl_positive_days_min: 7
    treasury_liquid_usd_min: 1200000
  execution:
    slippage_bps_max: 60
    split_orders: true
    fragments: 5

oracle:
  pairs:
    - base: "REVA"
      quote: "USD"
      method: "median_weighted"
      deviation_threshold_pct: 2.5
      heartbeat_sec: 60
      sources:
        - name: "DEX_TWAP"
          weight: 0.5
        - name: "CEX_Mid"
          weight: 0.3
        - name: "Chainlink_Feed"
          weight: 0.2
  guards:
    stale_after_sec: 180
    max_deviation_pct_5min: 5
    action_on_breach: ["freeze_repricing", "notify_risk"]

mev_policy:
  pbm_enabled: true                    # private block builders / intents
  allow_sandwich_protection: true
  enforce_tx_ordering: "fair"          # fair | first-in-non-arb
  kickback_bps_max: 0
  relays_allowlist: ["flashbots", "bloxroute", "eden"]
  simulation_required: true
  revert_protection:
    max_gas_waste_usd: 50
    retry_backoff_ms: 500

rewards_programs:
  referrals:
    enabled: true
    levels:
      - level: 1
        reward_bps: 50
      - level: 2
        reward_bps: 20
    cooldown_days: 7
  grants:
    committee_required: true
    committee_min_members: 3
    payout_caps_usd:
      per_grant: 50000
      per_quarter: 300000

risk_limits:
  exposure:
    per_protocol_usd_max: 1500000
    per_cex_custodian_usd_max: 1000000
    stablecoin_diversification:
      min_assets: 3
      per_asset_pct_max: 50
  concentration:
    top_holder_pct_max: 6
    insiders_cumulative_pct_max: 25
  volatility_guards:
    realized_vol_30d_max_pct: 180
    action_on_breach: ["raise_spread", "reduce_liquidity", "pause_buyback"]

governance:
  dao:
    voting_token: "REVA"
    quorum_percent: 10
    proposal_threshold_pct: 0.2
    voting_period_days: 7
    timelock_seconds: 172800
    emergency_veto:
      council_required: 3
      window_hours: 24
  budgets:
    require_multisig: true
    multisig_threshold_of_m: "2-of-3"
    signers:
      - ${DAO_SIGNER_1:0x0000000000000000000000000000000000000000}
      - ${DAO_SIGNER_2:0x0000000000000000000000000000000000000000}
      - ${DAO_SIGNER_3:0x0000000000000000000000000000000000000000}

compliance:
  kyc_required_for:
    - "cex_withdrawals"
    - "fiat_settlements"
    - "enterprise_plans"
  sanctions_screening: true
  geofencing:
    blocked_countries: []
  disclosures_required:
    - "token_supply"
    - "treasury_positions"
    - "rewards_emissions"
    - "fees_distribution"

accounting:
  revenue_splits_pct:
    protocol_treasury: 50
    staking_rewards: 30
    r_and_d_fund: 10
    buyback_fund: 10
  recognition:
    principle: "accrual"
    report_frequency: "monthly"

safeguards:
  pause_switches:
    protocol_fees: { enabled: true, require_multisig: true }
    buyback_engine: { enabled: true, require_multisig: true }
    emissions_stream: { enabled: true, require_dao_vote: true }
  incident_actions:
    severity_map:
      sev1: ["pause_buyback","pause_mm","notify_all"]
      sev2: ["reduce_liquidity","raise_spread","notify_ops"]
      sev3: ["monitor","notify_ops"]
  notifications:
    emails: ["ops-duty@example.com","treasury@example.com","risk@example.com"]

telemetry:
  kpis:
    - "circulating_supply"
    - "treasury_liquid_usd"
    - "emissions_per_epoch"
    - "buyback_burn_total"
    - "staking_tvl"
    - "mm_spread_bps"
  publish:
    endpoint: ${ECONOMY_METRICS_ENDPOINT:http://otel-collector:4318}
    otlp: true
