# engine-core main configuration
environment: production
version: "1.7.2"
service:
  name: engine-core
  host: 0.0.0.0
  port: 8080
  grpc_port: 9090
  read_timeout: 10s
  write_timeout: 15s
  max_connections: 1000
  keepalive: true
  shutdown_grace_period: 15s
  cors:
    enabled: true
    allowed_origins:
      - "*"

logging:
  level: INFO
  format: json
  file: /var/log/engine-core/engine.log
  rotation:
    max_size_mb: 50
    max_backups: 5
    max_age_days: 7
    compress: true
  tracing:
    enabled: true
    exporter: otlp
    endpoint: http://otel-collector:4317

security:
  cors_strict: false
  content_security_policy: "default-src 'self'"
  rate_limit:
    enabled: true
    rps: 100
    burst: 200
  api_key_required: true
  api_keys:
    - "{{ engine_api_key | default('local-dev') }}"
  jwt:
    enabled: true
    secret_file: /app/secrets/jwt.key
    expiry_minutes: 60

ai_modules:
  inference:
    model: "gpt-4"
    provider: openai
    endpoint: https://api.openai.com/v1
    timeout: 5s
    max_tokens: 1024
  fallback:
    enabled: true
    local_model_path: /models/fallback.bin

metrics:
  enabled: true
  prometheus:
    path: /metrics
    buckets: [0.1, 0.25, 0.5, 1, 2.5, 5, 10]
    labels:
      service: engine-core
      env: production
  otel:
    enabled: true
    exporter_endpoint: http://otel-collector:4317

integrations:
  redis:
    host: redis-master
    port: 6379
    db: 0
    pool_size: 20
  postgres:
    dsn: "postgresql://engine:{{ engine_db_pass }}@pg-core:5432/engine_db"
  s3:
    enabled: true
    bucket: engine-objects
    endpoint: s3.amazonaws.com
    access_key: "{{ s3_access_key }}"
    secret_key: "{{ s3_secret_key }}"

feature_flags:
  enable_ads: false
  use_experimental_routing: true
  ai_failover: true
  audit_trail: true

healthcheck:
  path: /health
  interval: 10s
  timeout: 2s

alerts:
  slack_webhook: https://hooks.slack.com/services/XXX/YYY/ZZZ
  deadletter_queue: redis://localhost:6379/3
  on_error_retry: true
  max_retry: 3
  notify_on:
    - crashloop
    - latency
    - error_rate

