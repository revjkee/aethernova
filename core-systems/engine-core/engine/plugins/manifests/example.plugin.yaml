# engine-core/engine/plugins/manifests/example.plugin.yaml
# Промышленный образец манифеста плагина для engine-core.
# Совместим с PluginLoader: обязательные поля — name, version, main.
# Остальные поля документируют лучшие практики и могут игнорироваться загрузчиком, не ломая обратную совместимость.

schema: "engine-core.plugin/1.0"   # версия схемы манифеста (информативно)

# Идентификация и версии
name: "example_ai_tools"           # уникальное имя плагина
version: "1.4.2"                   # semver версии самого плагина
engine_abi: ">=1.0"                # требуемая версия ABI движка (совместимо с loader.py)

# Точка входа
main: "plugin.py"                  # относительный путь к модулю или dotted-путь
entry: "plugin"                    # атрибут внутри модуля, предоставляющий класс/инстанс плагина

# Метаданные (информативные)
description: "Набор AI-инструментов: генерация подсказок, асинхронные задачи и метрики."
author: "Aethernova Labs"
license: "Apache-2.0"
homepage: "https://example.invalid/plugins/example_ai_tools"

# Зависимости между плагинами (разрешаются загрузчиком по имени плагина)
requires:
  metrics: "^2.0.0"                # совместимо с 2.x
  physics: ">=1.4.0"               # 1.4.0 и выше

# Необязательные зависимости (если доступны — будут загружены раньше)
optional:
  chat_overlay: "~1.3.0"

# Декларируемые возможности (используется маршрутизацией событий/сервисов)
capabilities:
  - "ai"
  - "tools"
  - "telemetry"

# Переменные окружения для плагина (используются при изоляции и/или передаются в конфиг)
env:
  AI_TOOLS_REGION: "eu-central"
  AI_TOOLS_LOG_LEVEL: "info"

# Изоляция (false — исполняется в общем процессе; true — можно запускать подпроцессом)
isolated: false

# Политики и ограничения (расширения; загрузчик может игнорировать)
policies:
  permissions:
    filesystem: "read-only"        # "none" | "read-only" | "read-write"
    network: "egress"              # "none" | "egress" | "all"
  timeouts:
    start_ms: 3000                 # таймаут на старт плагина
    stop_ms: 3000                  # таймаут на останов
  hot_reload:
    enabled: true                  # позволять горячую перезагрузку
    backoff_s: 3.0                 # минимальный бэкофф после ошибки перезагрузки

# Конфигурация по умолчанию, доступная в PluginContext.config
config:
  prompt_cache_ttl_s: 60
  max_concurrency: 8
  rate_limit_rps: 10
  features:
    streaming: true
    wasm_sandbox: false

# Интеграция с телеметрией (теги по умолчанию)
telemetry:
  tags:
    plugin: "example_ai_tools"
    team: "ai"

# Параметры изоляции процесса (используются только если isolated: true)
isolation:
  cmd: ["python", "-u", "bin/example_ai_tools.py"]  # команда запуска подпроцесса
  cwd: "./"                         # рабочая директория плагина
  env:
    PYTHONUNBUFFERED: "1"

# Сигнатуры/целостность исходников (информативно; loader может вычислять сам)
integrity:
  # sha256 от "дерева" исходников (см. sha256_tree в loader.py)
  tree_sha256: "0000000000000000000000000000000000000000000000000000000000000000"

# Ресурсы плагина (для пакетирования/дистрибутива; опционально)
resources:
  include:
    - "assets/**/*"
    - "templates/**/*.j2"
  exclude:
    - "**/__pycache__/**"
    - "**/*.pyc"

# Событийные хуки (информативно; реальная реализация — метод on_event в плагине)
hooks:
  - "player.join"
  - "match.start"
  - "match.end"

# Пример специфичных для плагина параметров оружия/баланса (кастомная секция)
ai_tools:
  models:
    default: "gpt-4o-mini"
    fallbacks: ["gpt-4o", "local:echo"]
  budgets:
    max_output_tokens: 1024
    max_cost_usd: 0.10
