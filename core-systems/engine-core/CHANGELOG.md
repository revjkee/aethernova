# Changelog

Все значимые изменения в этом проекте фиксируются в этом файле.

Формат основан на:
- Keep a Changelog 1.1.0
- Semantic Versioning 2.0.0

## Политика поддержки

- Активная ветка: `main`.
- Теги релизов: `vMAJOR.MINOR.PATCH`.
- Поддержка: исправления безопасности для последней минорной версии. Патчи получают пометку `[security]`.
- Ветвление: фичи — через PR из `feature/*`, исправления — `fix/*`, релизы — `release/*`.

## Матрица совместимости

| Компонент          | Минимум          | Протестировано |
|--------------------|------------------|----------------|
| Python             | 3.11             | 3.11.x         |
| FastAPI            | 0.115            | 0.115.x        |
| Uvicorn            | 0.30             | 0.30.x         |
| Pydantic           | 2.8              | 2.8.x          |
| Docker base image  | debian-slim      | debian-slim    |

Если вы используете иные версии, поведение не гарантируется.

---

## [Unreleased]

### Added
- Шаблон интеграции с внешними экспортерми OpenTelemetry (отключено по умолчанию).
- Политики логирования для фоновых задач с разметкой trace_id и request_id.

### Changed
- Стандартизировано имя сервиса в метриках Prometheus: `engine_core_*`.

### Fixed
- Исправлена гонка при раннем чтении конфигурации в `engine_core.config`.

### Security
- Ужесточены заголовки ответа: `Server` скрыт, `X-Content-Type-Options: nosniff` добавлен.

### Deprecated
- Нет.

### Removed
- Нет.

### Performance
- Микрооптимизация роутинга health-проб (до 10% быстрее в синтетике).

### Docs
- Дополнен README разделом по observability.

### CI/CD
- Кеширование зависимостей Poetry в GitHub Actions, ускорение на 30–40%.

> При подготовке релиза перенесите соответствующие пункты в новый раздел версии.

---

## [0.1.0] - 2025-08-12

Первый публичный каркас `engine-core`.

### Added
- Базовое HTTP-приложение на FastAPI:
  - `/healthz` — liveness-проба.
  - `/readyz` — readiness-проба.
  - `/metrics` — Prometheus метрики.
- Структурированные логи на `structlog` с объединением контекста для `uvicorn`.
- Конфигурация через `pydantic-settings` и YAML (`configs/application.yaml`), поддержка `.env`.
- CLI на Typer:
  - `engine-core serve` — запуск HTTP.
  - `engine-core check` — валидация конфигурации.
  - `engine-core version` — вывод версии.
- Заготовка телеметрии (`engine_core.telemetry`) с безопасным no-op по умолчанию.
- Docker-образ и k8s-манифесты (`ops/docker`, `ops/k8s`).
- Makefile таргеты для локального запуска и проверки.
- Преднастройки качества: `ruff`, `mypy`, `pre-commit`, `.editorconfig`.
- GitHub Actions: `ci.yaml`, `security.yaml`, `release.yaml`, `provenance-slsa.yaml`.
- Скрипты:
  - `scripts/run_local.sh` — локальный запуск.
  - `scripts/bench_local.sh` — микробенчмарки.
  - `scripts/sbom.sh` — генерация SBOM.
- Тесты для health-проб (`tests/test_health.py`).
- Файлы лицензирования и уведомлений: `LICENSE`, `NOTICE`, `THIRD_PARTY_NOTICES.md`.
- Версионирование: файл `VERSION` и синхронизация с `pyproject.toml`.

### Changed
- Нет.

### Fixed
- Нет.

### Security
- Базовые безопасные заголовки ответа и минимизация утечек версии сервера в логах.
- Workflow `security.yaml`: SAST и зависимостные сканирования на PR.

### Deprecated
- Нет.

### Removed
- Нет.

### Performance
- Нагрузочные шаблоны (`scripts/bench_local.sh`) для контроля регрессий.

### Docs
- `README.md`: быстрый старт, точки входа, список эндпойнтов.

### CI/CD
- Автосборка образов при создании тега `v*`.
- Публикация артефактов билда и SBOM.
- SLSA provenance для релизных артефактов.

### Migration
- Первая версия. Миграций нет.

---

## Руководство по релизу

1. Обновить версию:
   - Правка `VERSION` и `pyproject.toml`.
2. Завершить раздел `[Unreleased]`, перенести пункты под новый `## [X.Y.Z] - YYYY-MM-DD`.
3. Обновить матрицу совместимости при изменении требований.
4. Сгенерировать SBOM: `scripts/sbom.sh`.
5. Подписать тег: `git tag -s vX.Y.Z -m "engine-core vX.Y.Z"`.
6. Запушить теги: `git push --tags`.
7. Убедиться, что прошли пайплайны `ci`, `security`, `release`.
8. Проверить, что артефакты релиза опубликованы и снабжены аттестацией.

## Правила сообщений коммитов

Используйте Conventional Commits:

- `feat:` новая функциональность.
- `fix:` исправление бага.
- `perf:` производительность.
- `refactor:` рефакторинг без изменения поведения.
- `docs:` документация.
- `test:` тесты.
- `build:` сборка, зависимости.
- `ci:` пайплайны.
- `chore:` прочее.
- `revert:` откат.

Скопируйте номер задачи и область: `feat(api): add /metrics label cardinality limits`.

## Состояние деприкаций

На текущий момент нет объявленных деприкаций. Любая деприкация будет сопровождаться сроком удаления и инструкцией по миграции.

## Безопасность

Уязвимости помечаются в разделе `[security]` соответствующего релиза. Для ответственного раскрытия используйте внутренний процесс triage и фикс через патч-релиз.

---
