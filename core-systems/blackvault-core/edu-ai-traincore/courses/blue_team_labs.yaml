# blue_team_labs.yaml — Industrial-Grade Cyber Defense Curriculum (x20 Enhanced)
# TeslaAI Genesis | Verified by 20 agents + 3 metagenerals

course_id: blue_team_labs
title: Практикум Blue Team — активная оборона инфраструктуры
description: |
  Продвинутый курс для специалистов по защите систем. Упор на обнаружение, анализ, реагирование и построение устойчивости в реальном времени. Интеграция с TeslaAI DefenseNet.

metadata:
  version: 2.0-industrial
  difficulty: intermediate
  tags: [blue_team, defense, detection, incident_response, SIEM, EDR]
  estimated_duration_minutes: 240
  prerequisites:
    - red_team_basics
    - intro_to_linux
    - netflow_analysis

modules:
  - id: detection_basics
    title: Базовые методы обнаружения угроз
    description: Использование `Suricata`, `Zeek`, базового лог-анализа
    objectives:
      - Развёртывание IDS на трафике
      - Настройка правил для HTTP/SSH
    tools: [Suricata, Zeek, Wireshark]
    actions:
      - type: config_edit
        file: /etc/suricata/rules/custom.rules
        insert: "alert http any -> any any (msg:\"Suspicious HTTP\"; content:\"/admin\"; sid:100001; rev:1;)"
      - type: packet_analysis
        instructions: "Проанализируйте PCAP с помощью Zeek + Wireshark"
    assessment:
      type: hands_on
      validate_script: validate_traffic_alerts.sh

  - id: log_correlation
    title: Корреляция логов и анализ инцидентов
    description: |
      Работа с `ELK Stack`, разметка логов, использование `Sigma` правил
    objectives:
      - Индексация логов из Suricata и sshd
      - Поиск IOC по времени
    tools: [Elasticsearch, Logstash, Kibana, Sigma]
    actions:
      - type: elastic_query
        query: "sshd AND failed"
        time_range: "last 24h"
      - type: manual
        instructions: "Разметьте подозрительное поведение через Kibana Lens"
    assessment:
      type: quiz
      questions:
        - id: q1
          type: true_false
          prompt: "Sigma — это язык описания сигнатур для SIEM-систем"
          correct: true

  - id: active_response
    title: Активное реагирование и обнуление инцидента
    description: |
      Использование `Wazuh`, `fail2ban`, `iptables` и утечек в реальном времени
    objectives:
      - Автоматическая блокировка по логам
      - Эскалация оповещений в Slack/Telegram
    tools: [Wazuh, fail2ban, iptables, webhook]
    actions:
      - type: script
        name: block_intrusion.py
        description: "Блокировка IP после 5 неудачных ssh"
      - type: webhook_push
        data_template: alert_notification.json
    assessment:
      type: simulated_attack
      parameters:
        attack_type: brute_force
        detect_within_seconds: 10

caplets:
  - id: defend_flag
    description: Защитить флаг в /etc/secure_flag.txt в течение 30 минут атаки
    type: red_vs_blue_simulation
    red_team_profile: "automated_breach_simulator"
    flag_file: /etc/secure_flag.txt
    defense_strategies:
      - network_segmentation
      - log_rate_limiting
      - honeypot_redirect

auto_grading:
  enabled: true
  weights:
    detection_basics: 30
    log_correlation: 30
    active_response: 40
  min_score_to_pass: 75

dependencies:
  - detection_basics -> log_correlation
  - log_correlation -> active_response

ai_hinting:
  enabled: true
  engine: "teslaai:defense-coach-core"
  strategies:
    - root_cause_explainer
    - elastic_query_generator
    - log_trend_analyzer
