#######################################################################
# Zero-Trust Core — .env.example (industrial-grade)
# Формат: KEY=VALUE (без кавычек, кроме случаев с пробелами/спецсимволами)
# Типы:
#   BOOL: "true"/"false" (строго строчными)
#   INT: десятичное число
#   LIST: значения через запятую без пробелов, например: a,b,c
# Никогда не коммитьте реальные секреты. Этот файл — только пример.
#######################################################################

############################
# 1) APP / RUNTIME
############################
APP_NAME=zero-trust-core
APP_ENV=prod               # dev|staging|prod
APP_DEBUG=false            # BOOL: в prod всегда false
APP_TIMEZONE=UTC
APP_LOCALE=en_US
APP_BIND_HOST=0.0.0.0
APP_BIND_PORT=8080         # INT
APP_BASE_URL=https://ztc.example.com
APP_ALLOWED_HOSTS=ztc.example.com,api.ztc.example.com # LIST

# Ограничение тела запроса (байты). Пример: 5242880 = 5 MiB
APP_MAX_REQUEST_BODY=5242880

# Безопасные заголовки (включены по умолчанию в коде)
SECURITY_HSTS_ENABLED=true
SECURITY_CONTENT_SECURITY_POLICY=default-src 'none'; frame-ancestors 'none'; base-uri 'none';
SECURITY_REFERRER_POLICY=no-referrer

############################
# 2) CRYPTO / KEYS / FIPS
############################
# Ключи/пеппер для KDF/подписей должны браться из Secret Manager.
# Здесь — только плейсхолдеры для локальной разработки.
CRYPTO_FIPS_MODE=true            # BOOL: при false включаются не-FIPS алгоритмы
CRYPTO_PEPPER_KMS_URI=kms://alias/ztc/pepper   # НЕ секрет; указывает на KMS alias
CRYPTO_RNG_SOURCE=system         # system|drbg
CRYPTO_DEFAULT_AEAD=AES-256-GCM
# Если приложение подписывает артефакты/токены собственным ключом (dev only)
CRYPTO_JWS_PRIVATE_PEM_BASE64=__BASE64_PEM_PLACEHOLDER__  # оставьте пустым в prod

############################
# 3) AUTHN / AUTHZ
############################
# JWT (первичная аутентификация между сервисами)
JWT_ISS=https://auth.ztc.example.com
JWT_AUD=zero-trust-core
JWT_ALLOWED_ALGS=ES256,PS256   # LIST
JWT_PUBLIC_JWKS_URL=https://auth.ztc.example.com/.well-known/jwks.json
JWT_LEEWAY_SECONDS=30          # INT

# OIDC (внешний IdP)
OIDC_ENABLED=true
OIDC_PROVIDER_URL=https://idp.example.com
OIDC_CLIENT_ID=__CHANGE_ME__
OIDC_CLIENT_SECRET=__CHANGE_ME__     # секрет — хранить вне репо
OIDC_SCOPES=openid,email,profile     # LIST
OIDC_REDIRECT_URI=https://ztc.example.com/oauth/callback

# mTLS (Zero-Trust принцип: взаимная аутентификация сервисов)
MTLS_REQUIRED=true
MTLS_TRUST_BUNDLE_PATH=/etc/ztc/mtls/ca-bundle.pem
MTLS_CERT_PATH=/etc/ztc/mtls/tls.crt
MTLS_KEY_PATH=/etc/ztc/mtls/tls.key

# Сессии/Куки/CSRF
SESSION_SECURE_COOKIES=true
SESSION_SAME_SITE=strict         # lax|strict|none
SESSION_COOKIE_NAME=ztc_session
CSRF_ENABLED=true
CSRF_HEADER_NAME=X-CSRF-Token

# RBAC
RBAC_DEFAULT_ROLE=user
RBAC_ADMIN_ROLES=admin,platform-security # LIST

############################
# 4) RATE LIMIT / QUOTAS
############################
RATE_LIMIT_GLOBAL_RPM=600              # INT requests per minute per IP
RATE_LIMIT_BURST=120                   # INT
RATE_LIMIT_TRUSTED_PROXIES=10.0.0.0/8,192.168.0.0/16,127.0.0.1/32 # LIST CIDRs

############################
# 5) DATA STORES
############################
# Postgres
DB_HOST=postgres
DB_PORT=5432
DB_NAME=ztc
DB_USER=ztc_app
DB_PASSWORD=__CHANGE_ME__             # секрет — хранить в Secret Manager
DB_SSLMODE=require                    # disable|require|verify-full
DB_MAX_CONN=20                        # INT
DB_MIN_CONN=2                         # INT

# Redis (кэш/квоты/сессии)
REDIS_URL=redis://redis:6379/0
REDIS_TLS=false                       # BOOL
REDIS_PASSWORD=                       # оставьте пустым, если нет

# Message Queue (опционально)
MQ_ENABLED=false
MQ_BROKER_URL=amqps://user:__CHANGE_ME__@rabbitmq:5671
MQ_TLS=true

############################
# 6) STORAGE / SECRETS
############################
# S3-совместимое хранилище
S3_ENABLED=true
S3_ENDPOINT=https://s3.eu-north-1.amazonaws.com
S3_BUCKET=ztc-artifacts
S3_REGION=eu-north-1
S3_ACCESS_KEY_ID=__CHANGE_ME__
S3_SECRET_ACCESS_KEY=__CHANGE_ME__
S3_SSE_MODE=aws:kms
S3_SSE_KMS_KEY_ARN=arn:aws:kms:eu-north-1:123456789012:key/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx

# Vault (Transit/KV) — рекомендуется для прод
VAULT_ENABLED=true
VAULT_ADDR=https://vault.internal:8200
VAULT_NAMESPACE=neurocity
VAULT_AUTH_METHOD=kubernetes        # kubernetes|token|approle
VAULT_K8S_ROLE=ztc-core
VAULT_TOKEN=                         # используйте переменную секретов рантайма
VAULT_TRANSIT_MOUNT=transit
VAULT_KV_MOUNT=kv

############################
# 7) LOGGING / AUDIT
############################
LOG_FORMAT=json
LOG_LEVEL=INFO                # DEBUG|INFO|WARN|ERROR
LOG_SAMPLING_ENABLED=true
AUDIT_ENABLED=true
AUDIT_SINK=stdout-jsonl       # stdout-jsonl|file|http
AUDIT_FIELDS=ts,actor,action,resource,result,request_id,ip # LIST
AUDIT_REDACT_SECRETS=true

############################
# 8) TELEMETRY / OBSERVABILITY
############################
# Prometheus
PROMETHEUS_ENABLED=true
PROMETHEUS_MULTIPROC_DIR=     # Указать при запуске через gunicorn с воркерами

# OpenTelemetry
OTEL_ENABLED=true
OTEL_EXPORTER_OTLP_ENDPOINT=http://otel-collector:4317
OTEL_SERVICE_NAME=zero-trust-core
OTEL_RESOURCE_ATTRIBUTES=deployment.environment=${APP_ENV}

# Sentry (опционально)
SENTRY_DSN=
SENTRY_TRACES_SAMPLE_RATE=0.1      # 0..1
SENTRY_ENV=${APP_ENV}

############################
# 9) NETWORK / CORS / PROXY
############################
CORS_ENABLED=true
CORS_ALLOW_ORIGINS=https://ztc.example.com,https://console.ztc.example.com # LIST URLs
CORS_ALLOW_METHODS=GET,POST,PUT,PATCH,DELETE,OPTIONS
CORS_ALLOW_HEADERS=*,Authorization,Content-Type
CORS_MAX_AGE=600

PROXY_TRUST=true
PROXY_TRUSTED_CIDRS=10.0.0.0/8,192.168.0.0/16,127.0.0.1/32

# DNS для egress‑разрешений (если применяете sidecar‑VPN)
EGRESS_DNS_IP=10.96.0.10

############################
# 10) FEATURE FLAGS
############################
FEATURE_AUDIT_CHAINING=true     # криптографическая цепочка логов
FEATURE_PASSWORDLESS=true       # WebAuthn
FEATURE_PQ_HYBRID_TLS=false     # предварительный просмотр постквантового гибрида

############################
# 11) SECURITY HEADERS / COOKIES
############################
COOKIE_PREFIX=__Host-
COOKIE_TTL_SECONDS=86400
XFRAME_OPTIONS=DENY
XCONTENTTYPE_OPTIONS=nosniff

############################
# 12) PASSWORD POLICY (если валидируется на уровне сервиса)
############################
PWD_MIN_LENGTH=12
PWD_REQUIRE_SETS=upper,lower,digits,symbols
PWD_ZXCVBN_MIN_SCORE=3
PWD_BREACH_CHECK_ENABLED=true
PWD_MAX_AGE_DAYS=365
PWD_HISTORY_COUNT=10

############################
# 13) SMTP / NOTIFICATIONS
############################
SMTP_ENABLED=false
SMTP_HOST=smtp.example.com
SMTP_PORT=587
SMTP_STARTTLS=true
SMTP_USER=__CHANGE_ME__
SMTP_PASSWORD=__CHANGE_ME__
SMTP_FROM=noreply@ztc.example.com

############################
# 14) API / THROTTLING / PAGINATION
############################
API_DEFAULT_PAGE_SIZE=50
API_MAX_PAGE_SIZE=200
API_ENABLE_ETAGS=true
API_GLOBAL_THROTTLE_RPS=50            # INT RPS на инстанс
API_IDEMPOTENCY_ENABLED=true

############################
# 15) FILE UPLOADS
############################
UPLOADS_MAX_SIZE_BYTES=10485760       # 10 MiB
UPLOADS_ALLOWED_MIME=application/json,text/plain # LIST
UPLOADS_SCAN_ANTIVIRUS=false          # включайте только при наличии AV

############################
# 16) INTEGRATIONS (пример)
############################
INTEGRATION_KAFKA_ENABLED=false
KAFKA_BROKERS=broker1:9093,broker2:9093
KAFKA_TLS=true
KAFKA_SASL_MECHANISM=SCRAM-SHA-512
KAFKA_SASL_USERNAME=__CHANGE_ME__
KAFKA_SASL_PASSWORD=__CHANGE_ME__

############################
# 17) FALLBACK / SAFETY
############################
FAIL_CLOSED_ON_CONFIG_ERROR=true  # Если конфиг некорректен — не стартовать
SHUTDOWN_GRACE_SECONDS=20
HEALTH_PROBE_DELAY=5
READY_PROBE_DELAY=10

#######################################################################
# Конвенции безопасности:
# - Любые переменные *_SECRET_*, *_PASSWORD, *_TOKEN, *_KEY не должны
#   появляться в репозитории или логах. Подставляйте через Secret Manager.
# - В prod CRYPTO_FIPS_MODE=true, APP_DEBUG=false, SESSION_SECURE_COOKIES=true.
# - Для Kubernetes храните секреты в Secret, а .env.example используйте
#   как документацию по конфигурации.
#######################################################################
