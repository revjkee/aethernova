# Changelog - zero-trust-core

Формат основан на Keep a Changelog 1.1.0 и версионировании SemVer 2.0.0.
Типы изменений:
- Added: новая функциональность
- Changed: изменения совместимого поведения
- Deprecated: объявлено устаревшим (с указанием срока удаления)
- Removed: удалено (major или по завершении срока)
- Fixed: исправления
- Security: изменения безопасности или устранение уязвимостей

## [Unreleased]
### Added
- Конфигурация строгого mTLS профиля по умолчанию для внутренних RPC.
- Экспорт технических метрик в Prometheus с метками проекта/тенанта.
- Включен флаг строгой идемпотентности для POST операций API.

### Changed
- Политика ретраев HTTP: уменьшены таймауты по умолчанию для внешних вызовов.

### Deprecated
- Переменная окружения `ZTC_TLS12_FALLBACK` помечена как deprecated; срок удаления: 2026-03-31.

### Removed
- Пусто.

### Fixed
- Пусто.

### Security
- Усилен парсер конфигурации: запрещены небезопасные префиксы путей в include (#1421).

## [1.1.0] - 2025-08-19
### Added
- Поддержка hot-reload для ротации сертификатов без простоя (watcher на Secret/файлы).
- Политика key pinning (SPKI) на входящих соединениях, включаемая через конфиг.
- Политика audit-log rotation: ротация по размеру и по времени, хранилище tamper-evident.
- API: идемпотентность POST через заголовок Idempotency-Key с TTL 24h.
- Профили конфигурации dev/stage/prod с безопасными дефолтами для prod.

### Changed
- Минимальная версия TLS повышена до 1.3, TLS 1.2 только как явный fallback в dev/stage.
- Обновлен формат ошибок API на RFC 7807 (Problem Details).
- Улучшена совместимость с Kubernetes: ConfigMap и Secret монтируются с immutable=true.

### Deprecated
- Поле `jwt.issuers[].jwks_inline` устарело. Используйте `jwks_url`. Снятие поддержки в 1.3.0.

### Removed
- Удален старый экспорт метрик в StatsD (замена Prometheus).

### Fixed
- Исправлена гонка при одновременной проверке ETag и If-Match на PATCH.
- Исправлен парсинг OCSP stapling для некоторых цепочек сертификатов.

### Security
- Включена проверка must-staple для OCSP в prod профиле.
- Обновлены криптопрофили: запрет RSA-2048 и ниже, запрет SHA-1, RC4, 3DES.

## [1.0.0] - 2025-07-01
Первый стабильный релиз (baseline).
### Added
- Базовая реализация Zero Trust контуров: mTLS, RBAC/ABAC, журнал аудита.
- Конфиги приложений и сервисов, интеграция с Prometheus и OpenTelemetry.
- Политика версионирования и выпусков.

---

## Политика поддержки и совместимости

- Поддерживаются две последние minor-ветки (например, 1.1.x и 1.0.x).
- Патч-релизы (x.y.z) не должны ломать обратную совместимость публичных API.
- Снятие поддержки deprecated опций: минимум через один полноценно выпущенный minor после объявления и не ранее 90 дней.

## Матрица минимальной совместимости

- Kubernetes: >= 1.26
- Python рантайм: >= 3.11
- OpenSSL/BoringSSL: TLS 1.3 обязателен в prod
- Prometheus scrape: формат exposition 0.0.4

## Подписание релизов и теги

- Все теги вида `vX.Y.Z` подписываются GPG ключом проекта.
- Пример выпуска:
  1) Обновить `VERSION`, `CHANGELOG.md`.
  2) Создать тег: `git tag -s vX.Y.Z -m "zero-trust-core X.Y.Z"`.
  3) Проверить подпись: `git tag -v vX.Y.Z`.
  4) Пуш тега и артефактов.

## Ссылки сравнения версий

Замените `<REPO_URL>` на URL вашего репозитория (например, https://git.example.com/org/zero-trust-core).

- [Unreleased]: <REPO_URL>/compare/v1.1.0...HEAD
- [1.1.0]: <REPO_URL>/compare/v1.0.0...v1.1.0
- [1.0.0]: <REPO_URL>/releases/tag/v1.0.0
