# OblivionVault Core — DSAR Request (Example)
# Schema version for validator
version: "1.0"

# Locale for correspondence with the data subject
locale: "ru-RU"

# Unique idempotency key to prevent duplicate intake
idempotency_key: "DSAR-REQ-EXAMPLE-0001"

environment:
  # production | staging | dev
  context: "production"
  timezone: "Europe/Stockholm"

jurisdiction:
  # Examples: "EU/GDPR", "UK/UK-GDPR", "US/CCPA-CA", "BR/LGPD"
  regime: "EU/GDPR"
  residency_country: "SE"
  # Optional state/province for non-EU regimes
  subregion: null

data_subject:
  # natural_person (GDPR) | legal_entity_rep | minor_guardian | deceased_estate_rep
  subject_type: "natural_person"
  # Person the request is about (the data subject)
  identity:
    given_name: "Иван"
    family_name: "Иванов"
    middle_name: null
    date_of_birth: "1992-04-15"
    # At least one stable identifier should be present
    identifiers:
      emails: ["ivan.ivanov@example.com"]
      phones: ["+46701234567"]
      usernames: ["ivanov92"]
      # Optional national IDs (store hashed or tokenized server-side)
      national_ids:
        - type: "SE-PID"
          value_hash: "sha256:xxxx..."   # never store raw here
      addresses:
        - line1: "Sveavägen 10"
          line2: null
          city: "Stockholm"
          postal_code: "11157"
          country: "SE"
  # Optional authorized representative (power of attorney)
  representative:
    present: false
    details:
      name: null
      relation: null
      contact_email: null
      contact_phone: null
    authorization_docs:
      - description: null
        file_ref: null             # refer to attachments[]

request:
  # One or more rights. Allowed values:
  # access, copy, rectification, erasure, restriction, portability, objection,
  # marketing_opt_out, sale_opt_out, sensitive_data_limit, automated_decisioning_explanation,
  # consent_withdrawal, profiling_opt_out
  rights:
    - "access"
    - "copy"
  # Human-readable description from the requester
  description: "Прошу предоставить копию всех персональных данных и информацию по их обработке."
  # Preferred response formats (machine-readable first)
  preferred_formats: ["json", "csv", "pdf"]
  # Language for response content
  preferred_language: "ru"
  # Delivery method: secure_portal | encrypted_email | registered_mail
  delivery_method: "secure_portal"
  delivery_security:
    encryption:
      # pgp | smime | zip_password | tls_only
      method: "pgp"
      recipient_key_fingerprint: "ABCD 1234 EFGH 5678 IJKL 90MN OPQR STUV WXYZ 0001"
    zip_password_delivery: "out_of_band" # same_channel | out_of_band | not_applicable
  accessibility_requirements:
    # e.g. large_print, screen_reader_ready, plain_language
    - "screen_reader_ready"

time_range:
  # If unknown, set approximate=true and provide hints
  from: "2023-01-01T00:00:00Z"
  to: "2025-08-01T00:00:00Z"
  approximate: false
  # Narrow down using usage windows to reduce noise/cost if known
  hints:
    last_login_at: "2025-07-30T21:15:00Z"
    typical_regions: ["SE", "FI"]

scope:
  # Data categories of interest (helps routing)
  categories:
    - "account_profile"
    - "authentication_logs"
    - "product_telemetry"
    - "support_tickets"
    - "marketing_communications"
    - "payments_billing"
    - "device_identifiers"
    - "cookies_tracking"
    - "geolocation"
  include_derived_inferences: true
  include_third_parties: true
  include_processors_subprocessors: true
  include_backups_archives: "policy_driven"  # policy_driven | include | exclude
  # Explicit systems to include/exclude by internal registry slug
  systems_include: ["idp-core", "billing-core", "support-desk", "telemetry-pipeline"]
  systems_exclude: ["experimental-lab"]
  # Known identifiers to help pinpoint records
  linkage_identifiers:
    ip_addresses: ["85.228.00.10"]
    device_ids: ["a1b2c3d4e5f6-iphone14"]
    cookie_ids: ["cid-7f1e..."]
    ad_ids: ["idfa-XXXX-YYYY"]
  # Attach controller references shown to the data subject (plain language)
  controller_names:
    - "OblivionVault AB"

verification:
  # Status: pending | verified | failed
  status: "pending"
  # LOA: loa1 | loa2 | loa3
  assurance_level: "loa2"
  # Supported methods: bankid_se | eid_se | passport_ocr | kyc_provider | email_magic_link | sms_otp
  requested_methods: ["bankid_se", "email_magic_link"]
  completed_methods: []
  # Evidence references (stored as attachments)
  evidence_refs: []
  # Basic telemetry at intake to assist fraud screening
  intake_context:
    ip: "85.228.00.200"
    user_agent: "Mozilla/5.0 ..."
    submitted_at: "2025-08-25T09:15:00Z"

deadlines:
  # When controller received the request (start of SLA clock)
  received_at: "2025-08-25T09:15:00Z"
  # GDPR baseline: 1 month; set by policy engine
  due_at: "2025-09-24T23:59:59Z"
  extension:
    requested: false
    reason: null
    approved_by: null
    extended_due_at: null

legal:
  # Legal hold blocks erasure until cleared
  legal_hold:
    active: false
    reason: null
    ticket_ref: null
  # If refusal/partial compliance applies (set after review). Allowed:
  # manifestly_unfounded | excessive | cannot_identify | conflicts_rights_freedoms | abusive_pattern
  refusal_ground: null
  refusal_details: null
  # Special handling for minors
  minor_handling:
    is_minor: false
    guardian_verified: false
  # Automated decision-making flags (Art. 22 GDPR)
  automated_decisioning:
    present: false
    explanation_requested: false

consents:
  # Withdraw specific consents by ID or label (if rights include consent_withdrawal/marketing_opt_out)
  withdraw:
    - id: "CONSENT-MKT-EMAIL"
      label: "email_marketing"
  # Preferences toggles (controller-specific)
  preferences:
    marketing_email_opt_in: false
    marketing_sms_opt_in: false
    profiling_opt_in: false

delivery:
  contacts:
    email: "ivan.ivanov@example.com"
    phone: "+46701234567"
    # For registered mail, provide address
    address:
      line1: "Sveavägen 10"
      city: "Stockholm"
      postal_code: "11157"
      country: "SE"
  # Portal account id if using secure portal
  portal_account_id: "user-000123"

audit:
  ticket_id: "DSAR-2025-000123"
  source: "web_form"           # web_form | email | phone | mail | dpa_forwarded
  assigned_team: "privacy-ops"
  assigned_to: null
  priority: "P2"               # P1..P4
  events:
    - at: "2025-08-25T09:15:05Z"
      actor: "system"
      action: "intake_recorded"
      details: "Request stored and SLA started"
    - at: "2025-08-25T09:15:10Z"
      actor: "system"
      action: "verification_challenge_sent"
      details: "BankID_SE + email magic link"
  # Hash of request payload captured for integrity chain
  payload_checksum: "sha256:REQUEST-BODY-HASH"

notifications:
  # Notify subject at milestones (receipt, verification, ready, delivered, closed)
  subject_updates: true
  # Internal channels for on-call escalation
  internal_channels:
    - type: "slack"
      channel: "#privacy-ops"
    - type: "pagerduty"
      service: "privacy-oncall"

attachments:
  # Binary artifacts referenced above; system stores them in secure blob
  - id: "POA-001"
    description: "Power of attorney (if representative)"
    media_type: "application/pdf"
    size_bytes: 124567
    sha256: "xxxx..."
    storage_ref: "secure://vault/attachments/POA-001.pdf"
  - id: "ID-PHOTO-1"
    description: "Masked passport page (last 4 digits only)"
    media_type: "image/jpeg"
    size_bytes: 245678
    sha256: "yyyy..."
    storage_ref: "secure://vault/attachments/ID-PHOTO-1.jpg"

controller_processing_instructions:
  # Redaction rules to apply before disclosure
  redaction:
    pii_levels_exclude: ["third_party_personal_data", "trade_secrets"]
    mask_patterns:
      - name: "iban"
        regex: "[A-Z]{2}[0-9]{2}[A-Z0-9]{1,30}"
        replacement: "****REDACTED****"
  # Chunk size and format for large disclosures
  packaging:
    max_archive_size_mb: 500
    split_archives: true
    archive_format: "zip"
    include_index_manifest: true
  # Manifest fields to include with disclosure
  disclosure_manifest:
    include_processing_purposes: true
    include_data_sources: true
    include_recipients: true
    include_retention_policies: true

declarations:
  # Statements affirmed by the requester
  accuracy_confirmed: true
  authorized_to_request: true
  # Date/time of signature by data subject
  signed_at: "2025-08-25T09:14:59Z"

signatures:
  data_subject_signature:
    type: "esig"                  # esig | wet
    value: "BASE64-ECDSA..."      # controller verifies separately
  representative_signature:
    present: false
    type: null
    value: null
