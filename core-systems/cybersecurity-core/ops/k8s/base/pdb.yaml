apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: cybersecurity-core-pdb
  labels:
    app.kubernetes.io/name: cybersecurity-core
    app.kubernetes.io/instance: core
    app.kubernetes.io/part-of: neurocity
    app.kubernetes.io/component: service
    app.kubernetes.io/version: "1.0.0"
    app.kubernetes.io/managed-by: kustomize
  annotations:
    description: "Prevent voluntary disruptions from reducing cybersecurity-core below SLO."
    slo/availability: ">=99.9%"
    docs: "https://kubernetes.io/docs/concepts/workloads/pods/disruptions/"
spec:
  # Для высокодоступных сервисов выбирайте процент (округляется вверх).
  # Пример: при 3 репликах 60% => требуются минимум 2 реплики в работе.
  minAvailable: "60%"

  # ВАЖНО: метки в selector должны совпадать с метками у Pod шаблонов ваших
  # Deployment/StatefulSet, иначе бюджет не применится.
  selector:
    matchLabels:
      app.kubernetes.io/name: cybersecurity-core
      app.kubernetes.io/component: service

  # ПРИМЕЧАНИЯ ПО ЭКСПЛУАТАЦИИ:
  # - PDB ограничивает ТОЛЬКО добровольные эвакуации (drain/upgrade), а не аварии.
  # - На DaemonSet PDB не влияет; eviction DaemonSet-подов регулируется иначе.
  # - Для одиночных критичных pod (1 реплика) используйте minAvailable: "100%"
  #   в отдельном PDB ресурсе, чтобы полностью запретить добровольные эвакуации.
  #
  # АЛЬТЕРНАТИВА (раскомментировать и заменить minAvailable при необходимости):
  # maxUnavailable: 1
