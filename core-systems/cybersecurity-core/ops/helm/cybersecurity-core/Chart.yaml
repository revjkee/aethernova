apiVersion: v2
name: cybersecurity-core
description: >
  Meta-chart для развёртывания ядра безопасности кластера: политики (Kyverno/Gatekeeper),
  уязвимости (Trivy Operator), рантайм-мониторинг (Falco), а также опциональная телеметрия логов (Loki)
  и Ingress-контур. Все компоненты управляются флагами в values.yaml, что исключает конфликты и
  позволяет собирать минимально необходимый стек.

type: application

# Версия самого чарта (SemVer). Обновляйте при изменениях шаблонов/зависимостей.
version: 1.0.0

# Версия приложения/стека, произвольная строка (можно совпадающую с Git-тегом релиза).
appVersion: "1.0.0"

# Поддерживаемые версии Kubernetes (пример: 1.26+).
kubeVersion: ">=1.26.0-0"

keywords:
  - security
  - devsecops
  - policies
  - opa
  - kyverno
  - gatekeeper
  - trivy
  - falco
  - loki

annotations:
  artifacthub.io/category: security

# Зависимости заданы как опциональные через condition. Включаются из values.yaml.
dependencies:
  # Политики на основе Kyverno (включайте ИЛИ Kyverno, ИЛИ Gatekeeper).
  - name: kyverno
    repository: https://kyverno.github.io/kyverno/
    version: ">=2.0.0-0"
    condition: kyverno.enabled
    tags: ["policies", "admission", "security"]

  # Альтернативный механизм политик на базе OPA Gatekeeper (взаимоисключимо с Kyverno).
  - name: gatekeeper
    repository: https://open-policy-agent.github.io/gatekeeper/charts
    version: ">=3.10.0-0"
    condition: gatekeeper.enabled
    tags: ["policies", "admission", "security"]

  # Оператор уязвимостей (скан образов, kube-ресурсов и т.п.).
  - name: trivy-operator
    repository: https://aquasecurity.github.io/helm-charts
    version: ">=0.0.0"
    condition: trivyOperator.enabled
    tags: ["vulnerability", "scanner", "security"]

  # Рантайм-мониторинг ядра/системных вызовов (Falco).
  - name: falco
    repository: https://falcosecurity.github.io/charts
    version: ">=0.0.0"
    condition: falco.enabled
    tags: ["runtime", "ids", "security"]

  # Логирование/телеметрия безопасности (опционально).
  - name: loki
    repository: https://grafana.github.io/helm-charts
    version: ">=0.0.0"
    condition: loki.enabled
    tags: ["logging", "observability"]

  # Ingress-контур (если нужен внешний вход для дашбордов/веб-панелей безопасности).
  - name: ingress-nginx
    repository: https://kubernetes.github.io/ingress-nginx
    version: ">=4.0.0-0"
    condition: ingress.enabled
    tags: ["ingress", "networking"]

maintainers:
  - name: SecOps Team
    email: secops@example.com
