title: Windows Suspicious Process Creation — Enterprise Baseline (High-Signal)
id: 5f3b2ae2-9a0f-4d73-b1a1-3de2cfb2a6e0
status: stable
description: >
  Высокосигнальный детект подозрительных процесс-созданий в Windows: LOLBins (mshta, rundll32, regsvr32, certutil, bitsadmin),
  опасные флаги PowerShell, сетевые загрузки из утилит, выполнение скриптов и EXE из пользовательских директорий,
  а также аномальные цепочки родитель→потомок (Office → интерпретаторы).
references:
  - https://learn.microsoft.com/windows/security/threat-protection/auditing/event-4688
  - https://learn.microsoft.com/sysinternals/downloads/sysmon#event-id-1-process-create
  - https://attack.mitre.org/techniques/T1059/
  - https://attack.mitre.org/techniques/T1059/001/
  - https://attack.mitre.org/techniques/T1059/003/
  - https://attack.mitre.org/techniques/T1218/
  - https://attack.mitre.org/techniques/T1218/005/
  - https://attack.mitre.org/techniques/T1218/010/
  - https://attack.mitre.org/techniques/T1218/011/
  - https://attack.mitre.org/techniques/T1105/
  - https://attack.mitre.org/techniques/T1204/
author: cybersecurity-core (NeuroCity SecOps)
date: 2025/09/02
modified: 2025/09/02
logsource:
  product: windows
  category: process_creation
  # Для Sysmon это EventID 1; для Security — EventID 4688, поля должны быть промапплены преобразователем Sigma → ваш SIEM
detection:
  selection_script_interpreters:
    Image|endswith:
      - '\powershell.exe'
      - '\cmd.exe'
      - '\wscript.exe'
      - '\cscript.exe'
      - '\mshta.exe'
      - '\rundll32.exe'
      - '\regsvr32.exe'
      - '\msbuild.exe'
      - '\installutil.exe'
      - '\wmic.exe'
      - '\forfiles.exe'
      - '\bitsadmin.exe'
      - '\certutil.exe'

  selection_powershell_flags:
    CommandLine|contains:
      - ' -enc '
      - ' -EncodedCommand '
      - ' -nop '
      - ' -noni '
      - ' -w hidden'
      - ' -ExecutionPolicy Bypass'
      - ' Invoke-Expression'
      - ' FromBase64String'
      - ' DownloadString'
      - ' Net.WebClient'

  selection_mshta_remote:
    Image|endswith: '\mshta.exe'
    CommandLine|contains:
      - 'http://'
      - 'https://'
      - 'javascript:'

  selection_rundll32_susp:
    Image|endswith: '\rundll32.exe'
    CommandLine|contains:
      - 'javascript:'
      - 'url.dll,FileProtocolHandler'
      - 'shell32.dll,ShellExec_RunDLL'
      - 'http://'
      - 'https://'

  selection_regsvr32_susp:
    Image|endswith: '\regsvr32.exe'
    CommandLine|contains:
      - ' /i:'
      - ' scrobj.dll'
      - 'http://'
      - 'https://'

  selection_bitsadmin_remote:
    Image|endswith: '\bitsadmin.exe'
    CommandLine|contains:
      - '/transfer'
      - 'http://'
      - 'https://'

  selection_certutil_remote:
    Image|endswith: '\certutil.exe'
    CommandLine|contains:
      - '-urlcache'
      - '-decode'
      - 'http://'
      - 'https://'

  selection_office_parent_to_interpreter:
    ParentImage|endswith:
      - '\winword.exe'
      - '\excel.exe'
      - '\powerpnt.exe'
      - '\outlook.exe'
      - '\onenote.exe'
      - '\visio.exe'
    Image|endswith:
      - '\cmd.exe'
      - '\powershell.exe'
      - '\wscript.exe'
      - '\cscript.exe'
      - '\mshta.exe'
      - '\rundll32.exe'

  selection_user_writable_paths:
    Image|contains:
      - '\AppData\Local\Temp\'
      - '\AppData\Roaming\'
      - '\Users\Public\'
      - '\Downloads\'

  selection_script_extensions_in_cmdline:
    CommandLine|contains:
      - '.ps1'
      - '.js'
      - '.jse'
      - '.vbs'
      - '.vbe'
      - '.hta'

  selection_wmic_exec:
    Image|endswith: '\wmic.exe'
    CommandLine|contains:
      - 'process call create'
      - ' /node:'

  selection_obfuscation_markers:
    CommandLine|contains:
      - '^^'
      - '`'
      - '""+""'
      - '^>^'
      - '$env:'
      - 'set /p '
      - 'Start-Process -WindowStyle Hidden'

  # Исключения — аккуратно уменьшить шум, не снимая критичных детектов
  exclusion_clicktorun_office:
    ParentImage|contains: '\OfficeClickToRun.exe'

  exclusion_dev_build_msbuild:
    Image|endswith: '\msbuild.exe'
    ParentImage|endswith: '\devenv.exe'

  exclusion_legit_certutil:
    Image|endswith: '\certutil.exe'
    CommandLine|contains:
      - '-verifyCTL'
      - '-f -importpfx'

  exclusion_sccm_wmic:
    Image|endswith: '\wmic.exe'
    ParentImage|contains: '\ccmexec.exe'

  exclusion_program_files_microsoft:
    Image|startswith:
      - 'C:\Program Files\Microsoft\'
      - 'C:\Program Files (x86)\Microsoft\Edge\'

  condition: >
    1 of selection_* and not 1 of exclusion_*
fields:
  - UtcTime
  - Image
  - CommandLine
  - ParentImage
  - ParentCommandLine
  - User
  - IntegrityLevel
  - Hashes
  - CurrentDirectory
  - ProcessGuid
  - ParentProcessGuid
falsepositives:
  - Администрирование и автоматизация (скрипты DevOps, автодеплои)
  - Среды разработки (msbuild под управлением Visual Studio)
  - Корпоративные агенты (SCCM/Intune) при запуске служебных задач
level: high
tags:
  - attack.t1059
  - attack.t1059.001
  - attack.t1059.003
  - attack.t1218
  - attack.t1218.005
  - attack.t1218.010
  - attack.t1218.011
  - attack.t1105
  - attack.t1204
  - cybersecurity-core
  - windows
