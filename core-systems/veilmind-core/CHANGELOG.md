# Changelog — veilmind-core

Этот документ описывает все значимые изменения проекта. Формат основан на принципах «Keep a Changelog» и семантического версионирования (SemVer 2.0.0). Категории изменений: `Added`, `Changed`, `Deprecated`, `Removed`, `Fixed`, `Security`.

> Нотация совместимости:
> - MINOR релизы не ломают обратную совместимость публичного API и миграций.
> - MAJOR релизы могут содержать существенные изменения и требовать миграций.
> - Патч‑релизы содержат только исправления и изменения, не влияющие на API.

---

## [Unreleased]
### Added
- Экспорт метрик в формате Prometheus для подсистемы политики приватности.
- Флаги запуска `--strict-privacy` и `--audit-level` с уровнями `none|normal|verbose`.
- Черновая поддержка профилей конфигурации `dev|staging|prod` через переменную окружения `VEILMIND_PROFILE`.

### Changed
- Уточнены правила деградации функций при отсутствии внешних зависимостей: теперь модуль корректно переходит в режим «graceful‑degradation» с предупредительным логом.
- Улучшена стабильность загрузки конфигурации: валидация schema v1, понятные сообщения об ошибках.

### Fixed
- Исправлена гонка при одновременном чтении/записи кэша политик.
- Устранены редкие тайм‑ауты при инициализации подсистемы токенов доступа.

### Security
- Ужесточён набор заголовков безопасности по умолчанию (включая `X-Content-Type-Options: nosniff` и строгие правила сериализации).
- Добавлена проверка целостности артефактов при старте (проверка сигнатуры и SHA256).

---

## [1.2.0] — 2025-08-21
### Added
- Поддержка подписания релизных артефактов (GPG или эквивалентный механизм) и публикации файла `checksums.txt` (SHA256) в составе релиза.
- Механизм «policy sandbox» для безопасного выполнения пользовательских правил с ограничениями времени и памяти.
- Конфигурационный ключ `privacy.anonymization.mode` с режимами `none|basic|enhanced`.

### Changed
- Обновлена схема конфигурации до `configSchema: v1` с обязательными полями для секции `privacy`.
- Улучшена трассировка: единый корелляционный контекст для RPC‑вызовов.

### Fixed
- Исправлена утечка дескрипторов в длинноживущих фоновых задачах.
- Корректно обрабатывается ситуация «пустой источник данных» при холодном старте.

### Security
- Строже проверяется формирование JWT‑клеймов, введена валидация `aud` и `exp`.
- Поддержка списков блокировки слабых алгоритмов хеширования.

### Migration
- Переименован конфигурационный ключ `privacy.mode` → `privacy.anonymization.mode`. Для обратной совместимости старый ключ читается как алиас, но считается устаревшим.

---

## [1.1.0] — 2025-07-10
### Added
- Встроенный аудитор событий приватности с настраиваемыми ретеншн‑периодами.
- Экспорт технического состояния в `/healthz` и `/readyz`.

### Changed
- Ускорена загрузка правил за счёт ленивого парсинга и кэширования AST.

### Fixed
- Исправлены крайние случаи сериализации конфигурации с пустыми разделами.

### Security
- Добавлен «fail‑closed» режим при ошибках политики: в случае критической ошибки доступ блокируется, событие логируется.

### Migration
- Никаких обязательных миграций.

---

## [1.0.0] — 2025-06-01
Первый стабильный релиз veilmind-core.

### Added
- Базовый движок политик приватности с поддержкой статических и динамических правил.
- Профили логирования, структурированные JSON‑логи.
- Начальная интеграция с системой метрик.

### Changed
- Набор безопасных значений по умолчанию для продакшн‑профиля.

### Fixed
- Минорные дефекты инициализации.

### Security
- Базовые проверки целостности конфигурации и секретов.

---

## Политика совместимости и устареваний

- Публичный API отмечается в документации. Изменение сигнатур публичных методов или контрактов конфигурации допускается только в MAJOR‑релизах.
- Устаревшие элементы помечаются как `Deprecated` минимум на один MINOR‑цикл перед удалением.
- Конфигурационные алиасы поддерживаются не менее одного MINOR‑цикла.

---

## LTS и поддержка версий

- Ветвь `1.x` — активная (feature + security).
- Последние два MINOR‑релиза получают патч‑обновления безопасности.
- EOL объявляется в CHANGELOG минимум за один MINOR до снятия с поддержки.

---

## Матрица совместимости (ориентиры)

| veilmind-core | Схема конфигурации | Минимальная версия рантайма | Статус |
|---|---|---|---|
| 1.2.x | v1 | совместим с текущими зависимостями проекта | Active |
| 1.1.x | v1 | совместим с текущими зависимостями проекта | Maintenance |
| 1.0.x | v1 | совместим с текущими зависимостями проекта | Security‑only |

> Примечание: точные версии внешних компонентов фиксируются в документации сборки проекта. При отсутствии конкретики применяется политика «graceful‑degradation».

---

## Процесс выпуска и проверяемость поставок

1. Обновить `VERSION` и секцию соответствующего релиза в этом CHANGELOG.
2. Собрать артефакты и сформировать `checksums.txt` (SHA256) для каждого файла.
3. Подписать артефакты и файл сумм с помощью системы подписания, принятой в проекте.
4. Верифицировать подписи и хеши на CI перед публикацией.
5. Опубликовать релиз с приложенными `CHANGELOG.md`, `VERSION`, `checksums.txt` и сигнатурами.

---

## Формат записей в CHANGELOG

- Используйте глаголы в повелительном наклонении и краткие, предметные описания.
- Группируйте изменения по категориям; безопасность выделяйте в `Security`.
- Фиксируйте обязательные миграции в `Migration`.

---

[Unreleased]: (зарезервировано для будущих изменений)
[1.2.0]: (релиз от 2025‑08‑21)
[1.1.0]: (релиз от 2025‑07‑10)
[1.0.0]: (релиз от 2025‑06‑01)
