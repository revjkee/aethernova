# PodDisruptionBudgets for veilmind-core
# Covers both multi-replica and singleton workloads via labels.
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: veilmind-core-pdb
  labels:
    app.kubernetes.io/name: veilmind-core
    app.kubernetes.io/instance: default
    app.kubernetes.io/part-of: veilmind
    app.kubernetes.io/component: backend
    app.kubernetes.io/version: "0.0.0" # may be overridden by CI/CD
  annotations:
    description: "Protects veilmind-core from voluntary disruptions >50% of replicas."
spec:
  # For multi-replica Deployments/StatefulSets: keep at least 50% available during voluntary disruptions.
  # With 1 replica, eviction will be denied (round-up), with N>=2 at least half remain available.
  minAvailable: "50%"
  selector:
    matchLabels:
      app.kubernetes.io/name: veilmind-core
      app.kubernetes.io/instance: default
---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: veilmind-core-singleton-pdb
  labels:
    app.kubernetes.io/name: veilmind-core
    app.kubernetes.io/instance: default
    app.kubernetes.io/part-of: veilmind
    app.kubernetes.io/component: backend
    app.kubernetes.io/version: "0.0.0"
  annotations:
    description: "Hard-protect singleton pods (minAvailable=1). Applies only if pods are labeled workload-type=singleton."
spec:
  # For explicitly labeled singleton workloads, deny any voluntary disruption.
  minAvailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: veilmind-core
      app.kubernetes.io/instance: default
      workload-type: singleton
