# ==============================================================================
# veilmind-core/.env.example
# Production-grade environment template
# Do not put real secrets here. Copy to .env and fill CHANGE_ME values securely.
# For secrets prefer one of:
#   - HashiCorp Vault (VAULT_*), AWS/GCP/Azure KMS (KMS_*), or container secrets.
#   - Overriding via OS env vars at runtime.
# ==============================================================================

# ------------------------------------------------------------------------------
# 1) APPLICATION CORE
# ------------------------------------------------------------------------------
APP_NAME=veilmind-core
APP_ENV=dev                 # local | dev | staging | prod
APP_VERSION=0.1.0           # informational
TZ=UTC                      # e.g. Europe/Stockholm
LOCALE=en_US
DEBUG=false                 # never true in prod
LOG_LEVEL=INFO              # DEBUG|INFO|WARN|ERROR
LOG_JSON=true               # true for structured logs
HTTP_HOST=0.0.0.0
HTTP_PORT=8080
EXTERNAL_URL=https://api.example.com
PUBLIC_URL=https://example.com
BEHIND_PROXY=true
PROXY_TRUSTED_IPS=10.0.0.0/8,172.16.0.0/12,192.168.0.0/16

# ------------------------------------------------------------------------------
# 2) SECURITY BASELINES
# ------------------------------------------------------------------------------
SECRET_KEY=CHANGE_ME_LONG_RANDOM_BASE64
SESSION_COOKIE_SECURE=true
SESSION_COOKIE_SAMESITE=Strict   # Strict|Lax|None
CSRF_ENABLED=true
CSRF_COOKIE_SECURE=true
CORS_ENABLED=true
CORS_ALLOW_ORIGINS=https://example.com
CORS_ALLOW_METHODS=GET,POST,PUT,DELETE,OPTIONS
CORS_ALLOW_HEADERS=Authorization,Content-Type,Accept
CORS_EXPOSE_HEADERS=Content-Length,Content-Disposition
CORS_ALLOW_CREDENTIALS=false

# Password policy
PWD_MIN_LENGTH=12
PWD_REQUIRE_UPPER=true
PWD_REQUIRE_LOWER=true
PWD_REQUIRE_DIGIT=true
PWD_REQUIRE_SYMBOL=true

# JWT / Tokens
JWT_ENABLED=true
JWT_ACCESS_TTL_MIN=15
JWT_REFRESH_TTL_MIN=43200       # 30 days
JWT_ALG=HS256                   # or RS256/ES256 with KMS-managed keys
JWT_SECRET=CHANGE_ME_LONG_RANDOM_BASE64

# mTLS / TLS
TLS_ENABLED=true
TLS_CERT_FILE=/etc/ssl/certs/server.crt
TLS_KEY_FILE=/etc/ssl/private/server.key
TLS_CLIENT_AUTH=none            # none|optional|require
TLS_TRUSTED_CAS=/etc/ssl/certs/ca-bundle.crt
TLS_MIN_VERSION=TLSv1.2
HSTS_ENABLED=true
HSTS_MAX_AGE=31536000
HSTS_INCLUDE_SUBDOMAINS=true
HSTS_PRELOAD=false

# ------------------------------------------------------------------------------
# 3) KEY MANAGEMENT / VAULT / KMS
# ------------------------------------------------------------------------------
KMS_PROVIDER=local              # local|aws|gcp|azure|vault
KMS_ENVELOPE_MODE=true
KMS_KEY_ID=CHANGE_ME_KEY_ID

# HashiCorp Vault (prefer AppRole over token in prod)
VAULT_ADDR=https://vault.example.com
VAULT_NAMESPACE=
VAULT_AUTH=approle              # token|approle|kubernetes
VAULT_TOKEN=
VAULT_ROLE_ID=
VAULT_SECRET_ID=
VAULT_MOUNT=kv
VAULT_PATH_APP=veilmind-core/

# ------------------------------------------------------------------------------
# 4) ZERO TRUST INTEGRATION
# ------------------------------------------------------------------------------
ZT_ENABLED=true
ZT_POLICY_ENGINE_URL=http://localhost:8181/v1/data/veilmind/allow   # OPA endpoint
ZT_PEP_CACHE_TTL_SEC=300
ZT_PEP_CACHE_CAPACITY=50000
ZT_NEGATIVE_CACHE=true

# Risk scoring
ZT_RISK_SCORE_MODE=cli          # cli|http|off
ZT_RISK_SCORE_CLI_BIN=python3
ZT_RISK_SCORE_CLI_SCRIPT=cli/tools/risk_score.py
ZT_RISK_SCORE_STATE_PATH=/var/lib/veilmind/risk_state.sqlite
ZT_RISK_THRESH_ALLOW=40
ZT_RISK_THRESH_MFA=70
ZT_RISK_THRESH_DENY=85
ZT_RISK_THRESH_QUARANTINE=95

# ------------------------------------------------------------------------------
# 5) DATABASE (PostgreSQL)
# ------------------------------------------------------------------------------
DB_DRIVER=postgres
DB_HOST=127.0.0.1
DB_PORT=5432
DB_NAME=veilmind
DB_USER=veilmind_rw
DB_PASSWORD=CHANGE_ME_DB_PASSWORD
DB_SSL_MODE=require            # disable|require|verify-ca|verify-full
DB_SSL_ROOT_CERT=/etc/ssl/certs/ca-bundle.crt
DB_POOL_MIN=5
DB_POOL_MAX=50
DB_POOL_TIMEOUT_SEC=30
DB_STATEMENT_TIMEOUT_MS=30000
DB_READ_REPLICAS=               # host1:5432,host2:5432

# ------------------------------------------------------------------------------
# 6) CACHE / REDIS / RATE LIMITS
# ------------------------------------------------------------------------------
REDIS_URL=rediss://localhost:6380/0
REDIS_PASSWORD=CHANGE_ME_REDIS_PASSWORD
REDIS_TLS=true
CACHE_DEFAULT_TTL_SEC=300
RATE_LIMIT_ENABLED=true
RATE_LIMIT_REDIS_PREFIX=ratelimit
RATE_LIMIT_DEFAULT=100r/m       # 100 requests per minute
RATE_LIMIT_BURST=50
CIRCUIT_BREAKER_ENABLED=true
CIRCUIT_BREAKER_ERROR_RATE=0.5
CIRCUIT_BREAKER_MIN_SAMPLES=50
CIRCUIT_BREAKER_RESET_SEC=60

# ------------------------------------------------------------------------------
# 7) MESSAGE BROKER
# ------------------------------------------------------------------------------
BROKER=kafka                    # kafka|rabbit|none

# Kafka
KAFKA_BOOTSTRAP_SERVERS=localhost:9093
KAFKA_CLIENT_ID=veilmind-core
KAFKA_SECURITY_PROTOCOL=SASL_SSL
KAFKA_SASL_MECHANISM=PLAIN
KAFKA_SASL_USERNAME=CHANGE_ME
KAFKA_SASL_PASSWORD=CHANGE_ME
KAFKA_ACKS=all
KAFKA_COMPRESSION=lz4

# RabbitMQ
RABBIT_URL=amqps://user:CHANGE_ME@localhost:5671/vhost
RABBIT_HEARTBEAT=30
RABBIT_PREFETCH=100

# ------------------------------------------------------------------------------
# 8) OBJECT STORAGE (S3/MinIO)
# ------------------------------------------------------------------------------
S3_ENDPOINT=https://s3.example.com
S3_REGION=eu-north-1
S3_BUCKET=veilmind-data
S3_ACCESS_KEY=CHANGE_ME
S3_SECRET_KEY=CHANGE_ME
S3_FORCE_PATH_STYLE=false
S3_SSE=SSE-S3                  # none|SSE-S3|SSE-KMS
S3_KMS_KEY_ID=

# ------------------------------------------------------------------------------
# 9) OBSERVABILITY / TELEMETRY
# ------------------------------------------------------------------------------
OTEL_SERVICE_NAME=veilmind-core
OTEL_EXPORTER_OTLP_ENDPOINT=http://otel-collector:4317
OTEL_EXPORTER_OTLP_PROTOCOL=grpc
OTEL_TRACES_SAMPLER=parentbased_traceidratio
OTEL_TRACES_SAMPLER_ARG=0.10
OTEL_RESOURCE_ATTRIBUTES=deployment.environment=${APP_ENV},service.version=${APP_VERSION}
METRICS_ENABLED=true
PROMETHEUS_PORT=9090
HEALTH_PORT=8081
SENTRY_DSN=
SENTRY_ENVIRONMENT=${APP_ENV}
SENTRY_TRACES_SAMPLE_RATE=0.1

# ------------------------------------------------------------------------------
# 10) AUTHN/AUTHZ (OIDC/OAuth2/SAML)
# ------------------------------------------------------------------------------
AUTH_MODE=oidc                 # local|oidc|saml
OIDC_ISSUER_URL=https://auth.example.com/realms/main
OIDC_CLIENT_ID=veilmind-core
OIDC_CLIENT_SECRET=CHANGE_ME
OIDC_REDIRECT_URI=${EXTERNAL_URL}/auth/callback
OIDC_SCOPES=openid,profile,email,offline_access
PKCE_ENFORCE=true
SESSION_TTL_MIN=60

# Optional social providers (OAuth2)
OAUTH_GOOGLE_CLIENT_ID=
OAUTH_GOOGLE_CLIENT_SECRET=
OAUTH_GITHUB_CLIENT_ID=
OAUTH_GITHUB_CLIENT_SECRET=

# ------------------------------------------------------------------------------
# 11) EMAIL (SMTP)
# ------------------------------------------------------------------------------
SMTP_HOST=smtp.example.com
SMTP_PORT=587
SMTP_USER=apikey
SMTP_PASSWORD=CHANGE_ME
SMTP_USE_TLS=true
SMTP_FROM=VeilMind <no-reply@example.com>

# ------------------------------------------------------------------------------
# 12) FEATURE FLAGS
# ------------------------------------------------------------------------------
FF_ZERO_TRUST_STRICT=true
FF_API_READONLY=false
FF_SIGNUP_ENABLED=false
FF_ENABLE_AUDIT_EXPORT=true
FF_PII_REDACTION_DEFAULT=true
FF_RATE_LIMIT_PER_IDENTITY=true
FF_BACKGROUND_JOBS=true

# ------------------------------------------------------------------------------
# 13) AI MODELS / LLM
# ------------------------------------------------------------------------------
MODEL_PROVIDER=local           # local|openai|anthropic|azure|custom
MODEL_NAME=llama3-70b-instruct
MODEL_BASE_URL=http://localhost:8001
MODEL_API_KEY=
MODEL_TIMEOUT_SEC=60
MODEL_MAX_TOKENS=2048
MODEL_TEMPERATURE=0.2
MODEL_SAFETY_MODE=strict       # strict|standard|off
EMBEDDINGS_MODEL=all-minilm

# ------------------------------------------------------------------------------
# 14) DATA RETENTION / PRIVACY
# ------------------------------------------------------------------------------
RETENTION_AUDIT_DAYS=365
RETENTION_LOG_DAYS=14
RETENTION_TMP_DAYS=7
PRIVACY_MODE=strict            # strict|standard
PII_REDACTION_ENABLED=true
PII_REDACTION_STRATEGY=hash    # mask|hash|null
DLP_SCAN_UPLOADS=true
DLP_MAX_FILE_MB=50

# ------------------------------------------------------------------------------
# 15) JOB WORKER / SCHEDULER
# ------------------------------------------------------------------------------
WORKER_ENABLED=true
WORKER_CONCURRENCY=8
WORKER_SCHEDULE_TZ=UTC
WORKER_HEARTBEAT_SEC=15
CRON_EXAMPLE=*/5 * * * *      # sample cron for periodic tasks

# ------------------------------------------------------------------------------
# 16) FILE PATHS
# ------------------------------------------------------------------------------
RUNTIME_DIR=/var/run/veilmind
DATA_DIR=/var/lib/veilmind
TMP_DIR=/tmp/veilmind

# ------------------------------------------------------------------------------
# 17) ADMIN SEED (only for initial bootstrap in non-prod)
# ------------------------------------------------------------------------------
ADMIN_SEED_ENABLE=false
ADMIN_EMAIL=admin@example.com
ADMIN_PASSWORD=CHANGE_ME_STRONG

# ------------------------------------------------------------------------------
# 18) COMPLIANCE
# ------------------------------------------------------------------------------
GDPR_MODE=true
AUDIT_LOG_ENABLED=true
AUDIT_LOG_SINK=stdout          # stdout|file|kafka
AUDIT_LOG_FILE=/var/log/veilmind/audit.log
AUDIT_LOG_INCLUDE_PAYLOAD=false

# ------------------------------------------------------------------------------
# 19) BUILD INFO (optional)
# ------------------------------------------------------------------------------
GIT_SHA=
BUILD_NUMBER=
