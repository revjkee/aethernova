<!doctype html>
<html lang="ru" class="h-full">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <title>VeilMind Admin</title>
  <meta name="description" content="VeilMind Admin — безопасная панель управления редактированием и приватностью.">
  <!-- Строгая политика CSP. В продакшене продублируйте HTTP-заголовком. -->
  <meta http-equiv="Content-Security-Policy"
        content="
          default-src 'none';
          base-uri 'none';
          object-src 'none';
          frame-ancestors 'none';
          img-src 'self' data:;
          font-src 'self';
          style-src 'self' 'nonce-{{CSP_NONCE}}';
          script-src 'self' 'nonce-{{CSP_NONCE}}' 'strict-dynamic';
          connect-src 'self' https: wss:;
          manifest-src 'self';
          form-action 'self';
          upgrade-insecure-requests;
          block-all-mixed-content">
  <meta name="referrer" content="no-referrer">
  <meta name="color-scheme" content="light dark">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#0b0f17">

  <!-- Производительность и сетевые подсказки (при необходимости укажите конкретный хост API): -->
  <!-- <link rel="preconnect" href="https://api.example.com" crossorigin> -->

  <!-- Предзагрузка основного модуля (опционально, если известны чанки): -->
  <!-- <link rel="modulepreload" href="./main.js"> -->

  <!-- Базовые стили без внешних CDN; inline со strict CSP nonce. -->
  <style nonce="{{CSP_NONCE}}">
    :root{
      --bg: #0b0f17; --fg: #e6eaf2; --muted:#9aa5b1; --border:#1b2230; --acc:#4c8bf5;
      --bg-l: #ffffff; --fg-l: #0b0f17; --muted-l:#4b5563; --border-l:#e5e7eb; --acc-l:#1d4ed8;
      --radius: 12px; --shadow: 0 1px 2px rgba(0,0,0,.06),0 12px 24px -12px rgba(0,0,0,.2);
      --focus: 0 0 0 3px rgba(76,139,245,.35);
    }
    @media (prefers-color-scheme: light){
      :root{ --bg:var(--bg-l); --fg:var(--fg-l); --muted:var(--muted-l); --border:var(--border-l); --acc:var(--acc-l); }
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Noto Sans",Arial;
      background:var(--bg); color:var(--fg);
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    a{color:var(--acc); text-decoration:none}
    a:focus,button:focus,[role="button"]:focus{outline:none; box-shadow:var(--focus)}
    header{
      position:sticky; top:0; z-index:50; backdrop-filter:saturate(180%) blur(6px);
      background:color-mix(in oklab, var(--bg) 86%, transparent); border-bottom:1px solid var(--border);
    }
    .shell{display:grid; grid-template-columns: 240px 1fr; min-height:100%}
    nav{border-right:1px solid var(--border); padding:16px}
    nav .brand{display:flex; align-items:center; gap:10px; margin-bottom:16px; font-weight:700}
    nav .brand .dot{width:10px;height:10px;border-radius:50%;background:var(--acc)}
    .navlist{list-style:none; margin:0; padding:0}
    .navlist li{margin:6px 0}
    .navlink{
      display:flex; align-items:center; gap:10px; width:100%; padding:10px 12px; border-radius:10px;
      color:var(--fg); background:transparent; border:1px solid transparent; cursor:pointer;
    }
    .navlink[aria-current="page"]{background:rgba(76,139,245,.12); border-color:rgba(76,139,245,.35)}
    .navlink:hover{background:rgba(128,128,128,.08)}
    main{padding:20px 24px}
    .card{
      background:color-mix(in oklab, var(--bg) 96%, #0000);
      border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow); padding:16px;
    }
    .toolbar{display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between; margin-bottom:16px}
    .toolbar .group{display:flex; gap:8px; align-items:center}
    .input{
      height:34px; padding:6px 10px; border-radius:10px; border:1px solid var(--border); background:transparent; color:inherit;
    }
    .btn{
      height:34px; padding:0 12px; border-radius:10px; border:1px solid var(--border); background:transparent; color:inherit; cursor:pointer;
    }
    .btn.primary{background:var(--acc); color:#fff; border-color:transparent}
    .grid{display:grid; gap:16px}
    @media(min-width:960px){ .grid.cols-2{grid-template-columns:1fr 1fr} }
    .hidden{display:none !important}
    /* таблица */
    table{width:100%; border-collapse:separate; border-spacing:0}
    th,td{padding:10px 12px; border-bottom:1px solid var(--border)}
    th{text-align:left; font-weight:600; color:var(--muted)}
    /* тосты */
    .toasts{position:fixed; right:16px; bottom:16px; display:flex; flex-direction:column; gap:10px; z-index:100}
    .toast{min-width:280px; max-width:420px; padding:12px 14px; border-radius:12px; border:1px solid var(--border); background:color-mix(in oklab, var(--bg) 94%, #0000)}
    .toast.ok{border-color:#198754}
    .toast.err{border-color:#dc3545}
    /* модалка */
    .modal-backdrop{position:fixed; inset:0; background:rgba(0,0,0,.45); display:flex; align-items:center; justify-content:center; z-index:90}
    .modal{width:min(720px, 92vw); background:var(--bg); color:var(--fg); border:1px solid var(--border); border-radius:16px; box-shadow:var(--shadow); padding:16px}
    /* прелоадер */
    .skeleton{background:linear-gradient(90deg, rgba(128,128,128,.08), rgba(128,128,128,.16), rgba(128,128,128,.08)); background-size:200% 100%; animation:sh 1.2s infinite}
    @keyframes sh{0%{background-position:200% 0}100%{background-position:-200% 0}}
  </style>
</head>
<body class="h-full">
  <header role="banner">
    <div style="display:flex;align-items:center;justify-content:space-between;padding:10px 16px;">
      <div style="display:flex;align-items:center;gap:10px">
        <strong>VeilMind Admin</strong>
        <span id="app-version" aria-label="Версия приложения" style="color:var(--muted);font-variant-numeric:tabular-nums">v0.0.0</span>
      </div>
      <div class="group" aria-label="Статус подключения" style="display:flex;align-items:center;gap:12px">
        <span id="ws-status" class="input" style="padding:4px 8px;border-radius:999px;border-color:var(--border)">WS: offline</span>
      </div>
    </div>
  </header>

  <div class="shell" role="application">
    <nav aria-label="Основная навигация">
      <div class="brand"><span class="dot" aria-hidden="true"></span><span>VeilMind</span></div>
      <ul class="navlist" role="list">
        <li><button class="navlink" data-route="dashboard" aria-current="page">Панель</button></li>
        <li><button class="navlink" data-route="events">События редактирования</button></li>
        <li><button class="navlink" data-route="profiles">Профили</button></li>
        <li><button class="navlink" data-route="health">Состояние</button></li>
      </ul>
    </nav>

    <main id="app" tabindex="-1">
      <!-- Панель -->
      <section id="view-dashboard" class="grid cols-2" data-view>
        <div class="card">
          <h2 style="margin:0 0 8px">Обзор</h2>
          <div id="stats-overview" class="skeleton" style="height:120px;border-radius:12px"></div>
        </div>
        <div class="card">
          <h2 style="margin:0 0 8px">Поток событий</h2>
          <div id="live-stream" class="skeleton" style="height:120px;border-radius:12px"></div>
        </div>
      </section>

      <!-- События -->
      <section id="view-events" class="hidden" data-view>
        <div class="toolbar">
          <div class="group">
            <input id="filter-q" class="input" type="search" placeholder="Поиск по детектору/категории...">
            <input id="filter-date-from" class="input" type="datetime-local" aria-label="Дата от">
            <input id="filter-date-to" class="input" type="datetime-local" aria-label="Дата до">
          </div>
          <div class="group">
            <button id="btn-refresh" class="btn">Обновить</button>
            <button id="btn-export" class="btn">Экспорт CSV</button>
          </div>
        </div>
        <div class="card" role="region" aria-labelledby="events-table-caption">
          <div id="events-table-caption" class="hidden">Таблица событий редактирования</div>
          <table id="events-table">
            <thead>
              <tr>
                <th>Время</th>
                <th>Категория</th>
                <th>Детектор</th>
                <th>Путь</th>
                <th>Профиль</th>
                <th>Сэмпл</th>
              </tr>
            </thead>
            <tbody id="events-tbody">
              <tr><td colspan="6" class="skeleton">Загрузка…</td></tr>
            </tbody>
          </table>
          <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px">
            <button id="page-prev" class="btn" disabled>Назад</button>
            <button id="page-next" class="btn">Вперед</button>
          </div>
        </div>
      </section>

      <!-- Профили -->
      <section id="view-profiles" class="hidden" data-view>
        <div class="toolbar">
          <div class="group">
            <input id="profile-filter" class="input" placeholder="Фильтр по имени профиля">
          </div>
          <div class="group">
            <button id="btn-create-profile" class="btn primary">Новый профиль</button>
          </div>
        </div>
        <div id="profiles-list" class="card">
          <table>
            <thead>
              <tr><th>Имя</th><th>Версия</th><th>Активен</th><th>Описание</th><th></th></tr>
            </thead>
            <tbody id="profiles-tbody">
              <tr><td colspan="5" class="skeleton">Загрузка…</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Здоровье -->
      <section id="view-health" class="hidden" data-view>
        <div class="card">
          <h2 style="margin:0 0 8px">Состояние сервисов</h2>
          <div id="health-container">
            <div class="skeleton" style="height:90px;border-radius:12px"></div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <div class="toasts" aria-live="polite" aria-atomic="true" id="toasts"></div>
  <div id="modal-root" class="hidden" aria-hidden="true"></div>

  <noscript>
    Для работы VeilMind Admin требуется включенный JavaScript.
  </noscript>

  <!-- Конфигурация приложения. Читается в main.js (type=application/json безопасен под CSP). -->
  <script id="app-config" type="application/json" nonce="{{CSP_NONCE}}">
  {
    "appName": "VeilMind Admin",
    "version": "0.0.0",
    "apiBase": "/api",
    "wsUrl": "",
    "telemetry": { "prometheus": true, "otel": false },
    "features": { "eventsLive": true, "profiles": true }
  }
  </script>

  <!-- Основной модуль приложения. -->
  <script type="module" src="./main.js" defer></script>
</body>
</html>
